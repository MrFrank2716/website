<!DOCTYPE html>
<html>
    <head>

        <meta charset='utf-8'>
        <title>Armorstand Model Generator</title>

        <link rel="stylesheet" href="https://mrfrank.art/css/font-awesome.min.css">

        <link rel="icon" href="../images/icon.png" type="image/x-icon">
        <link rel="shortcut icon" href="../images/icon.png" type="image/x-icon">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">



        <!-- Load fonts -->
        <style>
            body {margin: 0; overflow: hidden}
            #canvas {width: 100%; height: 100%}
            #animate-canvas {width: 100%; height: 64px; margin-left: 1px;}
            @font-face {
                font-family: OpenSans;
                src: url(https://mrfrank.art/fonts/open-sans/OpenSans-Regular.ttf);
            }
            #canvas3d {
                background: radial-gradient(circle, #E4E4E4, #AEAEAE);
            }
            #itemloader {
                position:fixed;
                display:none;
            }
            .sidepanel {
                position: fixed;
                display: inline;
                left: 2%;
                top: 50%;
                margin-top: -250px;
                height: 500px;
                width: 300px;
                background-color: #E6E6E6;
                border: 1px solid #C5C5C5;
                border-radius: 3px;
                box-shadow: inset 1px 1px #FFF, 0px 0px 16px #9C9C9C;
            }
            .sidepanel-right {
                right: 2%;
                left: auto;
            }
            .cptop {
                height:90%;
                width: 100%;
                overflow-y: hidden;
            }
            .cpbottom {
                height:10%;
                width:100%;
            }
            .cppane {
                padding-top:8px;
                padding-bottom:8px;
                text-align: center;
                width:100%;
                border-bottom:1px solid #C5C5C5;
                font-family: 'OpenSans';
            }
            #createblock-text {
                text-align: left;
            }
            .cppane-topborder {
                border-top:1px solid #C5C5C5;
            }
            .cppane input[type='text'], #public-list-searchbar {
                padding:3px;
                padding: 3px;
                text-align: center;
                border: 1px solid #C5C5C5;
                border-radius: 3px;
                font-family: 'OpenSans';
            }
            .cppane button:hover {
                cursor: pointer;
            }
            .cppane button {
                font-family: 'OpenSans';
            }
            .smalltextinput {
                width: 50px
            }
            .disguised-textbox {
                display: block;
                margin: 2px auto 8px auto;
                text-align: center;
                background-color: transparent;
                border: none;
                font-family: 'OpenSans';
                font-size: 15px;
            }
            .dialogbox {
                display: none;
                position: absolute;
                width: 600px;
                height: 400px;
                top: 50%;
                left: 50%;
                margin-left: -300px;
                margin-top: -200px;
                background-color: #E6E6E6;
                border: 1px solid #C5C5C5;
                border-radius: 3px;
                box-shadow: inset 1px 1px #FFF, 0px 0px 16px #9C9C9C;
            }
            .dialogbox-titlebar {
                background: linear-gradient(#E6E6E6, gainsboro);
                border-bottom: 1px solid #C5C5C5;
            }
            .dialogbox-title {
                display: inline-block;
                width: 90%;
                font-family: 'OpenSans';
                font-size: 20px;
                color: #6F6F6F;
                height: 30px;
                padding-top: 5px;
                padding-left: 10px;
            }
            .dialogbox-close {
                display: inline-block;
                float: right;
                margin-top: 8px;
                margin-right: 12px;
                color: #888888;
                transition: 0.5s;
            }
            .dialogbox-close:hover {
                color: #AD7676;
                cursor: pointer;
            }
            .dialogbox-section {
                width: 49%;
                height: 100%;
                display: inline-block;
                border: 1px solid #ADADAD;
                box-shadow: 0px 0px 3px darkgrey;
                border-radius: 2px;
                vertical-align: top;
            }
            .dialogbox-body {
                width: 590px;
                height: 350px;
                margin-left: auto;
                margin-right: auto;
                text-align: center;
                margin-top: 5px;
            }
            #generate-categories {
                margin: 6px;
            }
            .generate-category {
                display: inline-block;
                width: 45%;
                border: 1px solid #ABABAB;
                border-radius: 3px;
                padding: 2px;
                background-color: #DEDEDE;
                font-family: 'OpenSans';
                font-size: 14px;
            }
            .generate-category:hover {
                background-color: #C1D9EA;
                cursor: pointer;
            }
            #output-text {
                width: 260px;
                max-width: 260px;
                height: 95%;
                margin-left: auto;
                margin-right: auto;
                margin-top: 2.4%;
                border-radius: 3px;
                background-color: whitesmoke;
                color: #3D506D;
            }
            .output-text {
                width: 95%;
                max-width: 95%;
                height: 15%;
                margin-left: auto;
                margin-right: auto;
                margin-top: 2.4%;
                border-radius: 3px;
                background-color: whitesmoke;
                color: #3D506D;
                overflow:hidden;
            }
            #generate-section-output {
                overflow-y: auto;
                overflow-x: hidden;
            }
            .selectedobj-pos-changer, #selectedobj-armorstand-bodyrotation{
                border: 1px solid #B5B5B5;
                border-radius: 3px;
                padding: 3px;
                width: 65px;
                margin-left: 3px;
                margin-right: 3px;
            }
            #selectedobj-size {
                margin-top: 8px;
            }
            #generate-settings-reusable {
                margin: 8px;
                border: 1px solid darkgrey;
                border-radius: 3px;
                background: linear-gradient(#E2E2E2, #D6D6D6);
                height: 275px;
                overflow: hidden;
            }
            .setting {
                width: 100%;
                text-align: left;
                font-family: 'OpenSans';
                font-size: 14px;
                border-bottom: 1px solid darkgrey;
                padding: 5px 0px 8px 0px;
            }
            .setting-cell {
                width: 100%;
                text-align: left;
                font-family: 'OpenSans';
                font-size: 14px;
                border: 1px solid darkgrey;
                padding: 5px 0px 8px 0px;
                background-color: #dadada;
                border-radius:3px;
            }
            .setting input {
                padding: 2px;
                border: 1px solid #C5C5C5;
                border-radius: 3px;
                font-family: 'OpenSans';
            }
            .setting-padding {
                padding-left:10px;
            }
            .selectedobj-properties-rotation input[type='number'] {
                width: 42px;
                padding: 2px;
                border: 1px solid #C5C5C5;
                border-radius: 3px;
                font-family: 'OpenSans';
            }
            .selectedobj-subcategory {
                width:100%;
                text-align: center;
                font-family: 'OpenSans';
                font-size: 15px;
                margin-top:-4px;
                margin-bottom:3px;
            }
            .spaced-out-horizontal {
                margin-left: 5px;
                margin-right: 5px;
            }
            .dialogbox-section {
                background-color: #E1E1E1;
                overflow-y: auto;
                overflow-x: hidden;
            }
            #animate {
                width: 60%;
                height: 100px;
                position: fixed;
                transform: translate(-50%, -50%);
                bottom: -150px;
                left: 50%;
                background-color: #9A9A9A;
                border: 1px solid #676767;
                border-radius: 3px;
                box-shadow: inset 1px 1px #D0D0D0, 0px 0px 16px #9C9C9C;
                display: none;
                opacity:0;
            }
            #animate:active {
                cursor: default;
            }
            #animate-canvas:active {
                cursor: pointer;
            }
            #animate-titlebar {
                background: linear-gradient(#A9A9A9, #888888);
                border-bottom: 1px solid #676767;
            }
            #animate-title {
                color: #4A4A4A;
                width: 120px;
            }
            #animate-close {
                color: #5F5F5F;
                z-index:2;
                position:relative;
            }
            #animate-close:hover {
                color: #3C3C3C;
            }
            .title-center {
                width: 100%;
                text-align: center;
                position: absolute;
                margin-top: -33px;
                height: 30px;
                z-index:1;
            }
            .animate-keyframe-button {
                margin-top: 3px;
                padding: 2px 4px 2px 4px;
                background-color: #737373;
                border: 1px solid #505050;
                font-family: 'OpenSans';
                border-radius: 3px;
                color: #D6D6D6;
                margin-left: 5px;
                margin-right: 5px;
            }
            .animate-keyframe-button.animate-keyframe-button-enabled:hover {
                background-color: #5F5F5F;
                cursor: pointer;
            }
            #generate-settings-under {
                position: absolute;
                bottom: 115px;
                left: 24px;
                font-family: 'OpenSans';
                font-size: 13px;
            }
            .alert-yellow {
                background-color: #E6E677;
                border: 1px solid #ADAD5A;
                border-radius: 3px;
                margin: 10px;
                padding: 6px;
                font-family: 'OpenSans';
                font-size: 14px;
                box-shadow: inset 1px 1px #F3F3B8, 0px 0px 8px #9C9C9C;
            }
            .alert-red {
                background-color: #E09898;
                border: 1px solid #9E5C5C;
                border-radius: 3px;
                margin: 10px;
                padding: 6px;
                font-family: 'OpenSans';
                font-size: 14px;
                box-shadow: inset 1px 1px #F3B8B8, 0px 0px 8px #9C9C9C;
            }
            .alert-blue {
                background-color: #98A8E0;
                border: 1px solid #5C6D9E;
                border-radius: 3px;
                margin: 10px;
                padding: 6px;
                font-family: 'OpenSans';
                font-size: 14px;
                box-shadow: inset 1px 1px #B8BDF3, 0px 0px 8px #9C9C9C;
            }
            .alert-green {
                background-color: #99E098;
                border: 1px solid #5C9E5E;
                border-radius: 3px;
                margin: 10px;
                padding: 6px;
                font-family: 'OpenSans';
                font-size: 14px;
                box-shadow: inset 1px 1px #B9F3B8, 0px 0px 8px #9C9C9C;
            }
            #output-raw-info {
                font-family: 'OpenSans';
                font-size: 13px;
                padding: 5px;
            }
            a:hover {
                text-decoration: underline;
            }
            a {
                text-decoration: none;
            }
            a:visited {
                color: #0018C5;
                text-decoration: none;
            }

            .tooltip {
                position:fixed;
                background-color: #757575;
                border: 1px solid #424242;
                color: white;
                border-radius: 4px;
                padding: 2px 4px 2px 4px;
                font-family: 'OpenSans';
                font-size: 14px;
                text-align: center;
                display: none;
            }

            #rightclick-keyframe-menu {
                background-color: white;
                position:fixed;
                display:none;
                background-color: white;
                border: 1px solid #A0A0A0;
                border-radius: 3px;
                opacity: 0.8;
                box-shadow: 2px 2px 7px rgba(0, 0, 0, 0.3);
            }

            .rightclick-keyframe-menu-button {
                margin: 5px;
                font-family: 'OpenSans';
                font-size: 14px;
                border: 1px solid #BDBDBD;
                padding: 2px;
                background-color: #F3F3F3;
            }

            .rightclick-keyframe-menu-button.clickable:hover {
                cursor: pointer;
                background-color: #E8E7E7;
            }

            #interpolate-amount {
                width: 30px;
            }

            .messagebox {
                position:fixed;
                top: 50%;
                left: 50%;
                margin-top: -100px;
                margin-left: -200px;
                width: 400px;
                height: 200px;
                display: none;
            }

            .messagebox-text {
                margin-top: 50px;
                width: 100%;
                text-align: center;
                font-family: 'OpenSans';
                font-size: 16px;
            }

            .messagebox-close {
                float: right;
                font-size: 22px;
                margin-right: 3px;
                color: #3C3C3C;
            }

            .messagebox-close:hover {
                cursor: pointer;
                color: #272727;
            }

            #rp-image-storage {
                position:fixed;
                top:0;
                left:0;
                display: none;
            }

            .textbox-regular {
                width: 386px;
                max-width: 386px;
                min-width: 386px;
                height: 30px;
                border-radius: 3px;
                color: rgb(61, 80, 109);
                background-color: whitesmoke;
            }

            .button-right {
                clear: right;
            }

            #project-list {
                height: 188px;
                display: none;
                border-bottom: 0px;
                overflow-x: hidden;
                overflow-y: auto;
            }

            /*signing in and out for projects*/

            .sign-in-out-toggle{display:none;margin:0 auto}
            #sign-in-button{display:inline-block;vertical-align:middle;margin-top:10px;margin-bottom:5px;}
            #sign-in-image{vertical-align:middle;padding:3px;z-index:10;position:relative;background-color:#ECECEC;border:1px solid #C5C5C5;border-radius:5px;overflow:hidden}
            #sign-out-container{width:110px;vertical-align:middle;margin-left:-20px;padding-left:25px;padding-top:3px;padding-bottom:3px;border:1px solid #C7C7C7;border-radius:4px;background-color:#F5F5F5;z-index:0;font-size: 15px;}
            .sign-out-element{display:none}
            #signed-in{vertical-align:middle;display:none;width:180px;text-align:left;margin:12px 0 12px 15px}
            #sign-in-text{margin-top:6px;display:inline-block;vertical-align:middle;margin-left:15px;width:40%;background: linear-gradient(#E4E4E4, #D4D4D4);width: 200px;padding: 2px 4px 2px 4px;border: 1px solid #C3C3C3;}
            #sign-in-container{margin-top:12px}
            #sign-out-button {display: block;}
            #sign-in-username {
                height: 20px;
                overflow-y: hidden;
                display: inline-block;
            }

            #project-save-container, #project-rename-container {display: none;}

            /*Project list items*/

            .project-item-publicity {
                float: right;
                margin-right: 8px;
                display: inline-block;
                width: 16px;
            }

            .project-item-publicity:hover {
                color: #2B7D2B;
            }

            .project-item-delete {
                float: right;
                margin-top: 3px;
                margin-right: 6px;
            }

            .project-item-delete:hover {
                color: #9A4646;
            }

            .project-item-child {
                display: inline-block;
            }

            .project-item-date {
                color: #525252;
                float: left;
                margin-left: 20px;
            }

            .project-item {
                width: 100%;
                background-color: #F3F3F3;
                border-top: 1px solid #BFBFBF;
                height: 28px;
                font-size: 17px;
                padding-top: 3px;
                font-family: 'OpenSans';
            }

            .project-item:hover {
                background-color: #E0E5E6;
                cursor: pointer;
            }

            .project-item-name {
                float: left;
                margin-left: 14px;
                width: 260px;
                text-align: left;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .project-item-name-small {
                float: left;
                margin-left: 14px;
                width: 125px;
                text-align: left;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            #questionbox-body {
                height: 100px;
                margin-top: 18px;
            }

            #questionbox {
                height: 200px;
            }

            /*Public project list items*/

            .public-item {
                height: 55px;
            }

            .project-item-favorite {
                float: right;
                margin-right: 20px;
                margin-top: 11px;
                font-size: 20px;
            }

            .project-item-favorites-amount {
                float: right;
            }

            .project-item-favorite-button {
                float: right;
                margin-right: 10px;
                font-size: 20px;
                margin-top: 4px;
            }

            .project-item-favorite-button:hover {
                color: #e6b800;
                font-weight:bold;
                cursor: pointer;
            }

            .project-item-favorite-button-full {
                color: #cca300;
            }

            .project-item-favorite-button-full:hover {
                color: #e6b800;
            }

            .project-item-share {
                margin-right: -5px;
                margin-top: 2px;
                color: #333390;
            }
            .project-item-share:hover {
                cursor: pointer;
                color: #793DA7;
            }

            .public-item-name {
                font-size: 18px;
                border-bottom: 1px solid #BDBDBD;
            }

            .public-item-creator {
                font-size: 15px;
                clear: left;
            }

            .public-item-top-section {
                width: 100%;
                height: 50%;
            }

            .abcRioButton {
                transition: 0.2s;
            }

            #customcommands-add {
                right: 20px;
                display: inline-block;
                position: absolute;
                margin-top: 10px;
                font-family: 'OpenSans';
                background-color: #CECECE;
                padding: 1px 4px 1px 4px;
                border: 1px solid #B7B7B7;
                border-radius: 3px;
            }

            #customcommands-add:hover {
                background-color: #CADCC8;
                cursor: pointer;
            }

            .cc-textbox {
                width: 80%;
                height: 25px;
                padding-left: 8px;
                padding-right: 8px;
                border: 1px solid #BBBBBB;
                border-radius: 3px;
                box-shadow: 0px 0px 12px #A5A5A5;
            }

            .cc-item {
                margin-top: 10px;
            }

            .cc-delete, .cc-pos {
                margin-left: 8px;
            }

            .cc-delete:hover {
                color: #9A4646;
                cursor: pointer;
            }

            .cc-pos:hover {
                color: #426FC1;
                cursor: pointer;
            }

            .customcommands-selectobj-btn:hover {
                cursor: pointer;
            }

            .icon-button {
                margin-right: 5px;
                color: #6B6B6B;
            }

            .icon-button:hover {
                color: #3060CE;
                cursor: pointer;
            }

            .welcome-padded {
                padding: 0px;
                text-align: center;
                margin-top:5px;
                font-size:17px;
            }

            .dialogbox-ad-under {
                background-color: #E1E1E1;
                border: 1px solid #C5C5C5;
                border-radius: 3px;
                width: 740px;
                height: 95px;
                padding-top: 5px;
                margin-left: -70px;
                margin-top: 20px;
            }

            .dialogbox-ad-over {
                background-color: #E1E1E1;
                border: 1px solid #C5C5C5;
                border-radius: 3px;
                width: 740px;
                height: 95px;
                padding-top: 5px;
                margin-left: -70px;
                position: absolute;
                top: -110px;
            }

            .public-pagechanger {
                position: absolute;
                bottom: 20px;
                font-size: 24px;
            }

            .public-pagechanger:hover {
                color: #417CC5;
                cursor: pointer;
            }

            #public-page-left {
                left: 40px;
            }
            #public-page-right {
                right: 40px;
            }

            #menu-button {
                position:fixed;
                top:15px;
                right:20px;
                font-size:25px;
                opacity: 0.6;
            }

            #menu-button:hover {
                cursor: pointer;
                opacity:1;
                color: #296FC5;
            }

            #report-blockid-error {
                margin-top: 10px;
                color: #11116F;
            }

            #report-blockid-error:hover {
                cursor: pointer;
                color: #1B406F;
            }

            .project-item-share-disabled {
                opacity: 0.3;
                cursor: default;
            }

            .object-browser-item {
                width: 100%;
                border-bottom: 1px solid #ADADAD;
                background: linear-gradient(#FFFFFF, gainsboro);
            }

            .object-browser-item:hover {
                cursor: pointer;
                background: linear-gradient(#B9D8FF, #C5D4E4);
            }

            .object-browser-item-text {
                font-family: 'Open Sans';
                padding: 2px 5px 2px 5px;
            }

            #object-browser-list {
                max-height: 464px;
                overflow-y: scroll;
            }

            #blankarmorstand-equipment-showadvanced {
                margin-top: 7px;
                margin-left: 10px;
                color: #1f1f1f;
            }

            #blankarmorstand-equipment-advanced {
                text-align: center;
                margin-top: 7px;
            }

            #blankarmorstand-equipment {
                text-align: center;
            }

            .blankarmorstand-equipment-slot {
                display: inline-block;
                border: 1px solid #b5b5b5;
                padding: 2px;
                background-color: #ececec;
                margin-top: 3px;
            }

            .blankarmorstand-equipment-advanced-slot {
                display: inline-block;
                border: 1px solid #b5b5b5;
                padding: 3px;
                background-color: #d2d2d2;
                margin: 2px;
            }

            #skyscraper-right {
                height: 618px;
                width: 300px;
                padding: 5px;
                margin-top: -309px;
                right: 10px;
                text-align: center;
            }

            #skyscraper-right-close {
                color: gray;
                font-size: 16px;
                font-family: Helvetica;
                margin-right: 8px;
            }

            #skyscraper-right-close:hover {
                cursor: pointer;
            }

            #cmdcombinerimportform {
                display: none;
            }

            #command-combiner-auto-button {
                background: linear-gradient(#c3cdf3, #9da6ca);
                padding: 5px;
                border: 1px solid #616b8e;
                border-radius: 5px;
            }

            #command-combiner-auto-button:hover {
                background: linear-gradient(#9da6ca, #9da6ca);
                cursor: pointer;
            }

            #public-list-search {
                width: 430px;
                margin-left: auto;
                margin-right: auto;
                margin-top: 10px;
                margin-bottom: 10px;
                border: 1px solid #adadad;
                background-color: #dddddd;
                padding: 5px;
                box-shadow: 1px 1px 4px #c3c3c3;
                border-radius: 4px;
            }

            #public-list-searchbar-button {
                font-family: 'Open Sans';
            }

            #public-list-searchbar-button:hover {
                cursor: pointer;
            }

            #public-list-searchbar {
                text-align: left;
            }

            #public-list-sort {
                border: 1px solid #adadad;
                padding: 2px;
                background-color: #f1f1f1;
                border-radius: 4px;
            }

            #public-project-info {
                display: none;
                position: fixed;
                background-color: #e6e6e6;
                border-radius: 4px;
                border: 1px solid #aaaaaa;
                top: 30px;
                left: 30px;
                font-size: 18px;
                font-family: 'Open Sans';
                box-shadow: inset 1px 1px #FFF, 0px 0px 16px #9C9C9C;
                padding: 10px;
            }

            #public-project-info-name {
                font-weight: bold;
            }

            #public-project-info-favorite {
                text-align: right;
                border-top: 1px solid #aaaaaa;
                margin-top: 5px;
                padding-top: 4px;
                font-weight: bold;
            }

            #public-project-info-favorite-amount {
                margin-right: 8px;
            }

            #animate-selected-tick {
                font-family: 'Open Sans';
                font-size: 16px;
                color: #4a4a4a;
                position: absolute;
                top: 5px;
                right: 40px;
            }

        </style>
        
    </head>
    <body>

        <script type="text/javascript">
            window._pt_lt = new Date().getTime();
            window._pt_sp_2 = [];
            _pt_sp_2.push('setAccount,511ff281');
            var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
            (function() {
                var atag = document.createElement('script'); atag.type = 'text/javascript'; atag.async = true;
                atag.src = _protocol + 'cjs.ptengine.com/pta_en.js';
                var s = document.getElementsByTagName('script')[0]; 
                s.parentNode.insertBefore(atag, s);
            })();
        </script>
                        
        <script src="https://mrfrank.art/js/three.js"></script>
        <script src="https://mrfrank.art/js/orbitcontrols.js"></script>
        <script src="https://mrfrank.art/js/projector.js"></script>
        <script src="https://mrfrank.art/js/jquery.min.js"></script>
        <script src="https://mrfrank.art/js/jquery.hotkeys.js"></script>
        <script src="models.js"></script>
        <script src="blockids.js"></script>

        <div id='nav-container'></div>
        <script src='https://mrfrank.art/js/navbar.js' invisible='true'></script>

        <i class="fa fa-bars" id='menu-button'></i>

        <div id='controlpanel' class='sidepanel'>
            <div class='cptop'>
                <div class='cppane' style='border-bottom: 3px double #C5C5C5;'>
                    <i class="fa fa-list icon-button" id='object-list'></i>
                    <i class="fa fa-question-circle icon-button" id='help-button'></i>
                    <input type='text' id='createblock-text' placeholder='Block/item id'>
                    <button id='createblock-button'>Add</button>
                </div>
                <div class='cppane selectedobj-properties' style='display:none'>
                    <input id='selectedobj-name' class='disguised-textbox' contenteditable='true' onclick='this.setSelectionRange(0, this.value.length)'>
                    <input type='number' id='selectedobj-x' class='smalltextinput selectedobj-pos-changer update-object-mover-lines animate-changes' value='0' step='1' step='any'>
                    <input type='number' id='selectedobj-y' class='smalltextinput selectedobj-pos-changer update-object-mover-lines animate-changes' value='0' step='1' step='any'>
                    <input type='number' id='selectedobj-z' class='smalltextinput selectedobj-pos-changer update-object-mover-lines animate-changes' value='0' step='1' step='any'>
                </div>
                <div class='cppane selectedobj-properties' id='armorstand-bodyrotation-container' style='display:none'>
                    <label for='selectedobj-armorstand-bodyrotation'>Armorstand Rotation:</label> <input type='number' id='selectedobj-armorstand-bodyrotation' class='smalltextinput update-object-mover-lines animate-changes-force' value='0' step='5' step='any'>
                </div>
                <div class='cppane selectedobj-properties' style='display:none'>
                    <input type='text' id='selectedobj-changeid' style='width:120px' placeholder='Change ID'>
                </div>
                <div class='cppane selectedobj-properties' style='display:none'>
                    <button id='selectedobj-duplicate' title='Duplicate (Ctrl + d)'><i class="fa fa-clone"></i> Duplicate</button>
                    <button id='selectedobj-remove' title='Remove (Del)'><i class="fa fa-trash-o"></i> Remove</button>

                    <div id='selectedobj-size'>
                        <button id="selectedobj-small" class="selectedobj-sizechange update-object-mover-lines"><!-- <i class="fa fa-compress"></i>  -->Small (Not Fixed)</button>
                        <button id="selectedobj-medium" class="selectedobj-sizechange update-object-mover-lines"><!-- <i class="fa fa-expand"></i>  -->Medium</button>
                        <button id="selectedobj-large" class="selectedobj-sizechange update-object-mover-lines"><!-- <i class="fa fa-arrows-alt"></i>  -->Large</button>
                        <button id="selectedobj-armorstand-options">Armorstand Options</button>
                    </div>
                </div>
                <div class='cppane selectedobj-properties selectedobj-properties-rotation' style='display:none'>
                    <div class='selectedobj-subcategory'>Rotation:</div>

                    <input type='number' id='selectedobj-rotation-number-x' class='selectedobj-rotation-x selectedobj-rotation-change animate-changes' title='X Rotation' step='5'>
                    <input type='range' class='selectedobj-rotation-x selectedobj-rotation-change animate-changes' min='-180' max='180' step='5'><br>

                    <input type='number' id='selectedobj-rotation-number-y' class='selectedobj-rotation-y selectedobj-rotation-change animate-changes' title='Y Rotation' step='5'>
                    <input type='range' class='selectedobj-rotation-y selectedobj-rotation-change animate-changes' min='-180' max='180' step='5'>

                    <div id='z-rotation-input'>
                        <input type='number' id='selectedobj-rotation-number-z' class='selectedobj-rotation-z selectedobj-rotation-change animate-changes' title='Z Rotation' step='5'>
                        <input type='range' class='selectedobj-rotation-z selectedobj-rotation-change animate-changes' min='-180' max='180' step='5'>
                    </div>
                </div>
                <div class='cppane selectedobj-properties selectedobj-properties-animations' style='display:none'>
                    <!-- <div class='selectedobj-subcategory'>Title:</div> -->

                    <button id="selectedobj-visible"><i class="fa fa-eye"></i> Visible</button>
                    <button id="selectedobj-invisible" style='display: none'><i class="fa fa-eye-slash"></i> Invisible</button>

                    <button id="selectedobj-animation-manipulation"><i class="fa fa-terminal"></i> Manipulation</button>

                </div>

                <!-- Project saving -->

                <div id='project' class='cppane'>

                    <div class='selectedobj-subcategory'>Projects:</div>

                    <div id='project-import-export' style='margin-top: 8px'>

                        <button id='project-import'>Import Project</button>
                        <button id='project-export'>Export Project</button>

                    </div>

                    

                    <div id='project-save-container'>
                        <input type='text' placeholder='Project Name' id='project-save-name' size='14'>
                        <button id='project-save' style='margin-left: 4px'>Save Project</button>
                    </div>

                    <div id='project-rename-container'>
                        <input type='text' placeholder='Project Name' id='project-rename-name' size='14'>
                        <!-- (update / rename) -->
                        <button id='project-update' class='button-connected' style='margin-left: 4px'><i class="fa fa-floppy-o" aria-hidden="true"></i> Save</button>
                     
                    </div>



                </div>

                <div id="project-list" class="cppane">

                    <div class="selectedobj-subcategory">Current Bugs:<br><br> 'Small' Doesn't currently generate <br><br> Message MrFrank2716#9155 or frankie@mrfrank.art if you encounter any bugs</div>

                    <div id='projects-list'></div>

                </div>

            </div>

            <div class='cpbottom'>
                <div class='cppane cppane-topborder'>
                    <button id='options-button' class='spaced-out-horizontal'>Options</button>
                    <!-- <button id='animate-button' class='spaced-out-horizontal'>Animations</button> -->
                    <button id='generate-button' class='spaced-out-horizontal'>Generate</button>
                </div>
            </div>
        </div>

        <div id='animate'>
            <div id='animate-titlebar' class='dialogbox-titlebar'>
                <div id='animate-title' class='dialogbox-title'>Animations</div><div class='title-center'>
                    <button id='animate-add-keyframe' class='animate-keyframe-button'>Add Keyframe</button>
                    <button id='animate-delete-keyframe' class='animate-keyframe-button'>Delete Keyframe</button>
                    <button id='animate-add-tweening' class='animate-keyframe-button hastooltip'>Add Interpolation</button>
                    <button id='animate-delete-tweening' class='animate-keyframe-button hastooltip'>Remove Interpolation</button>
                    <button id='animate-settings-button' class='animate-keyframe-button animate-keyframe-button-enabled'>Animation Settings</button>
                    <button id='animate-view-customcommands' class='animate-keyframe-button animate-keyframe-button-enabled hastooltip' tooltip='View all custom commands for this keyframe'>Custom Commands</button>
                    <span id='animate-selected-tick' class='hastooltip' tooltip='Your current selected keyframe'>0</span>
                </div>
                <div id='animate-close' class='dialogbox-close' style='z-index: 10'><i class="fa fa-times" style='font-size:1.3em'></i></div>
            </div>
            <canvas id='animate-canvas'></canvas>
        </div>

        <div id='generate' class='dialogbox' style='height: 500px; margin-top: -250px'>
            <div id='generate-titlebar' class='dialogbox-titlebar'>
                <div id='generate-title' class='dialogbox-title'>Generate</div>
                <div id='generate-close' class='dialogbox-close'><i class="fa fa-times" style='font-size:1.3em'></i></div>
            </div>
            <div id='generate-body' class='dialogbox-body'>
                <div class='generate-section dialogbox-section'>
                    <div id='generate-categories'>
                        <div class='generate-category generate-cat-single hastooltip' id='generate-cat-single'>
                            <div class='generate-cat-text'>Single</div>
                        </div>

                    </div>

                    <!-- Single settings -->
                    <div id='generate-settings-single'><!--  Doesn't need display: none becuase it should be visible by default unlike the reusable settings -->
                        <div class='setting'>

                        </div>
                    </div>
					
					
                    <!-- Reusable settings -->
                    <div id='generate-settings-reusable' style='display:none'>
                        <div class='setting'>
                            <div class='setting-padding'>
                                <label for='generate-settings-reusable-entity' class='hastooltip' tooltip='This is the entity that must be spawned in order to<br>place this model into your world'>Entity to place at</label><br>
                                <input type='text' id='generate-settings-reusable-entity' class='settings-inputchange' placeholder='@e[...]' value='@e[type=Squid]' />
                            </div>
                        </div>
                        <div class='setting'>
                            <div class='setting-padding'>
                                <input type='checkbox' id='generate-settings-reusable-spawnegg' class='settings-inputchange' checked> <label for='generate-settings-reusable-spawnegg'>Give entity spawn egg initially</label>
                            </div>
                        </div>
                        <div class='setting'>
                            <div class='setting-padding'>
                                <label for='generate-settings-reusable-attach' class='hastooltip' tooltip='If an entity is specified here, the model will become<br>"attached" to that entity, by following it'>Entity to attach to</label><br>
                                <input type='text' id='generate-settings-reusable-attach' class='settings-inputchange' placeholder='@e[...]' value=''>
                            </div>
                        </div>

                        <div class='setting' id='generate-settings-reusable-multidirectional-container'>
                            <div class='setting-padding'>
                                <input type='checkbox' id='generate-settings-reusable-multidirectional' /> <label for='generate-settings-reusable-multidirectional' class='hastooltip' tooltip='Multi-directional placement allows a creation to be placed with different<br>orientations depending on the direction that the player is looking when<br>the "Entity to place at" (specified above) is spawned in'>Multi-directional placement</label>

                                <div id='generate-settings-reusable-multidirectional-amount-container'>
                                    <label for='generate-settings-reusable-multidirectional-amount'>Number of possible directions</label>
                                    <input type='number' id='generate-settings-reusable-multidirectional-amount' style='width: 30px; margin-left:4px' value='4' />

                                    <br>

                                    <input type='checkbox' id='generate-settings-reusable-multidirectional-autodirection' style='margin-left:10px' value='4' /> <label for='generate-settings-reusable-multidirectional-autodirection' class='hastooltip' tooltip='Enabling this setting will allow you to easily place your creation with different<br>orientations since it will be spawned in facing the direction that the player is looking.'>Spawn with auto-direction</label>
                                </div>
                            </div>
                        </div>

                        <div class='setting' id='generate-settings-reusable-animations' style='display: none'>
                            <div class='setting-padding'>
                                <label for='generate-settings-reusable-trigger-animation' class='hastooltip' tooltip='You can run this command at any time to<br>play all animations for this project'>Trigger entire animation command</label>
                                <textarea class='textbox-regular' id='generate-settings-reusable-trigger-animation' onclick="this.focus();this.select()" readonly style='width: 245px;min-width: 245px;max-width: 245px;'></textarea>
                            </div>

                        </div>
                    </div>
                    <div id='generate-settings-under'>
                        <input type='checkbox' style="opacity:0" checked id='generate-settings-raw-commands'> <label for='generate-settings-raw-commands'></label>

                    </div>

                   
                </div>
                <div class='generate-section dialogbox-section' id='generate-section-output'>
                    <textarea id='output-text' onclick="this.focus();this.select()" readonly></textarea>
                </div>


                </div>
            </div>
        </div>

        <div id='options' class='dialogbox'>
            <div id='options-titlebar' class='dialogbox-titlebar'>
                <div id='options-title' class='dialogbox-title'>Options</div>
                <div id='options-close' class='dialogbox-close'><i class="fa fa-times" style='font-size:1.3em'></i></div>
            </div>
            <div id='options-body' class='dialogbox-body'>
                <div class='options-section dialogbox-section' style='width: 55%'>
                    <div class='setting'>
                        <div class='setting-padding'>
                            <input type='checkbox' id='options-showaxislines' class='settings-inputchange'> <label for='options-showaxislines'>Show axis lines</label>
                        </div>
                        <div class='setting-padding'>
                            <input type='checkbox' id='options-showobjectlines' class='settings-inputchange' checked> <label for='options-showobjectlines'>Object position movers</label>
                        </div>
                    </div>
                    <div class='setting'>
                        <div class='setting-padding'>
                            <label for='options-load-rp-button'>Load resource pack</label>
                            <input type="file" id="options-load-rp-button" name="rpfiles[]" webkitdirectory directory multiple style='margin-top: 5px' />
                        </div>
                    </div>

                    </div>
                    <div class='setting'>
                        <div class='setting-padding' style='text-align: center'>
                            <label>Entire Model Rotation</label><br>
                            <input type='checkbox' id='options-rotation-only-current-frame' class='settings-inputchange' checked> <label for='options-rotation-only-current-frame'>Rotates the Entire model</label><br>
                            <label for='options-rotation-x'>x:</label> <input type='number' id='options-rotation-x' class='options-rotation' style='width: 50px' maxlength="16" value='0' /> 
                            <label for='options-rotation-y'>y:</label> <input type='number' id='options-rotation-y' class='options-rotation' style='width: 50px' maxlength="16" value='0' /> 
                            <label for='options-rotation-z'>z:</label> <input type='number' id='options-rotation-z' class='options-rotation' style='width: 50px' maxlength="16" value='0' /> 
                        </div>
                    </div>
                    <div class='setting'>
                        <div class='setting-padding' style='text-align: center'>
                            <label>Relative Block/Command Block Position where the creation will summon</label><br>
                            <input type='checkbox' id='options-offset-absolute' class='settings-inputchange'> <label for='options-offset-absolute' class='hastooltip' tooltip='ONLY UNCHECK IF EXECUTING SINGLE COMMANDS "~0.0", IF EXECUTING A SHOWFILE CHECK BOX "0.0"<br> If this is checked, then the coordinates specified below will<br>be the absolute world where the command block coordinates are that the creation will be placed at.<br>If it is not checked, the coordinates below will be used as a relative position.'>Set Relative/Summon Coordinates</label><br>
                            <label for='options-offset-x'>x:</label> <input type='number' id='options-offset-x' class='options-offset' style='width: 50px' maxlength="16" value='0' /> 
                            <label for='options-offset-y'>y:</label> <input type='number' id='options-offset-y' class='options-offset' style='width: 50px' maxlength="16" value='0' /> 
                            <label for='options-offset-z'>z:</label> <input type='number' id='options-offset-z' class='options-offset' style='width: 50px' maxlength="16" value='0' />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id='animate-settings' class='dialogbox'>
            <div id='animate-settings-titlebar' class='dialogbox-titlebar'>
                <div id='animate-settings-title' class='dialogbox-title'>Animation Settings</div>
                <div id='animate-settings-close' class='dialogbox-close'><i class="fa fa-times" style='font-size:1.3em'></i></div>
            </div>
            <div id='animate-settings-body' class='dialogbox-body'>
                <div class='animate-settings-section dialogbox-section' style='width: 55%'>
                    <!-- Enable animation -->
                    <div class='setting'>
                        <div class='setting-padding'>
                            <input type='checkbox' class='animate-settings-enable' id='animate-settings-enable'> <label for='animate-settings-enable' class='hastooltip' tooltip='If this is not checked, the final product<br>will not be animated. It will use the<br>first keyframe for everything instead.'>Enable animation</label>
                        </div>
                    </div>
                    <!-- Loop animation -->
                    <div class='setting'>
                        <div class='setting-padding'>
                            <input type='checkbox' id='animate-settings-loop' checked> <label for='animate-settings-loop' class='hastooltip' tooltip='Makes the animation play again after finishing'>Loop animation</label>
                        </div>
                    </div>
                    <!-- Play animation once -->
                    <div class='setting' id='animate-settings-play-once-container' style='display: none'>
                        <div class='setting-padding'>
                            <input type='checkbox' id='animate-settings-play-once' checked> <label for='animate-settings-play-once' class='hastooltip' tooltip='If this is not checked, the animation will not play once initially'>Play animation once</label>
                        </div>
                    </div>
                    <!-- Enable interpolation -->
                    <div class='setting'>
                        <div class='setting-padding'>
                            <input type='checkbox' id='animate-settings-tweening' class='animate-settings-inputchange' checked> <label for='animate-settings-tweening' class='hastooltip' tooltip='Enables keyframe interpolation:<br>User-specified areas on the timeline will<br>generate interpolated keyframes'>Enable interpolation</label>
                        </div>
                        <!-- <div class='setting-padding'>
                            <label for='animate-settings-tweening-accuracy' class='hastooltip' tooltip='The interval to generate interpolated frames at<br>For example, if set to 1, a frame would be interpolated for every tick in between each '>Tweening Accuracy:</label> <input type='number' id='animate-settings-tweening-accuracy' style='width:35px' class='animate-settings-inputchange' value='2' step='1' min='1'>
                        </div> -->
                    </div>
                    <!-- Length: # ticks (# seconds) -->
                    <div class='setting'>
                        <div class='setting-padding'>
                            Length: <input type='number' id='animate-settings-length' style='width:40px' class='animate-settings-inputchange' value='20'> ticks (<span id='animate-settings-seconds-display'>1 second</span>)
                        </div>
                    </div>
                    <!-- Strict movement -->
                    <div class='setting'>
                        <div class='setting-padding'>
                            <input type='checkbox' id='animate-settings-hardtp' class='animate-settings-inputchange'> <label for='animate-settings-hardtp' class='hastooltip' tooltip='Removes interpolation between single ticks by removing and<br>re-summoning each armorstand in each keyframe<br>(Works best when you need rapid rotation on an object)<br><strong>ONLY check this if you know what you are doing!</strong>'>Strict movement</label>
                        </div>
                    </div>
                    <!-- Arm swaying -->
                    <div class='setting'>
                        <div class='setting-padding'>
                            <input type='checkbox' id='animate-settings-arm-sway' class='animate-settings-inputchange'> <label for='animate-settings-arm-sway' class='hastooltip' tooltip='Automatically make arms sway on armor stands'>Arm sway</label>
                        </div>
                        <div class='setting-padding'>
                            X: <input type='number' id='animate-settings-arm-sway-x' style='width:40px' class='animate-settings-inputchange' value='1'> 
                            Y: <input type='number' id='animate-settings-arm-sway-y' style='width:40px' class='animate-settings-inputchange' value='1'> 
                            Z: <input type='number' id='animate-settings-arm-sway-z' style='width:40px' class='animate-settings-inputchange' value='1'> 
                            every <input type='number' id='animate-settings-arm-sway-ticks' style='width:40px' class='animate-settings-inputchange' value='40'> ticks
                        </div>
                    </div>


                </div>
            </div>
        </div>

        <div id='manipulate' class='dialogbox'>
            <div id='manipulate-titlebar' class='dialogbox-titlebar'>
                <div id='manipulate-title' class='dialogbox-title'>Object Manipulation</div>
                <div id='manipulate-close' class='dialogbox-close'><i class="fa fa-times" style='font-size:1.3em'></i></div>
            </div>
            <div id='manipulate-body' class='dialogbox-body'>
                <div class='manipulate-section dialogbox-section' style='width: 70%'>
                    <div class='setting'>
                        <div class='setting-padding'>
                            <label for='manipulate-input-nbt' class='hastooltip' tooltip='Additional NBT that should be added to<br>the currently selected armor stand'>Custom NBT (Armor Stand)</label><br>
                            <textarea id='manipulate-input-nbt' class='textbox-regular' placeholder='Type some NBT values here!'></textarea>
                        </div>
                    </div>
                    <div class='setting'>
                        <div class='setting-padding'>
                            <label for='manipulate-input-item-nbt' class='hastooltip' tooltip='Additional NBT that should be added to<br>item on the currently selected armor stand'>Custom NBT (Item)</label><br>
                            <textarea id='manipulate-input-item-nbt' class='textbox-regular' placeholder='Type some item NBT values here!'></textarea>
                        </div>
                    </div>
                    <div class='setting'>
                        <div class='setting-padding'>
                            <input type='checkbox' id='manipulate-toggle-rotationcenter'> <label for='manipulate-toggle-rotationcenter' class='hastooltip' tooltip='Toggles whether this object shall be rotated by its center and automatically have its position calculated'>Enable center rotation</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Armorstand options -->
        <div id='armorstand-options' class='dialogbox'>
            <div id='armorstand-options-titlebar' class='dialogbox-titlebar'>
                <div id='armorstand-options-title' class='dialogbox-title'>Armorstand Options</div>
                <div id='armorstand-options-close' class='dialogbox-close'><i class="fa fa-times" style='font-size:1.3em'></i></div>
            </div>
            <div id='armorstand-options-body' class='dialogbox-body'>
                <div class='armorstand-options-section dialogbox-section' style='width: 70%'>
                    <div class='setting'>
                        <!-- Armorstand armor and hand slots input boxes -->
                        <div id='blankarmorstand-equipment'>

                            <div class='blankarmorstand-equipment-slot'>
                                <div id='blankarmorstand-equipment-slot-name'>Head Slot</div>
                                <input type='text' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder='Item id' class='blankarmorstand-equipment-input blankarmorstand-equipment' id='blankarmorstand-equipment-head' size='10' />
                            </div>

                            <div class='blankarmorstand-equipment-slot'>
                                <div id='blankarmorstand-equipment-slot-name'>Chest Slot</div>
                                <input type='text' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder='Item id' class='blankarmorstand-equipment-input blankarmorstand-equipment' id='blankarmorstand-equipment-chest' size='10' />
                            </div>

                            <div class='blankarmorstand-equipment-slot'>
                                <div id='blankarmorstand-equipment-slot-name'>Legs Slot</div>
                                <input type='text' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder='Item id' class='blankarmorstand-equipment-input blankarmorstand-equipment' id='blankarmorstand-equipment-legs' size='10' />
                            </div>

                            <div class='blankarmorstand-equipment-slot'>
                                <div id='blankarmorstand-equipment-slot-name'>Feet Slot</div>
                                <input type='text' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder='Item id' class='blankarmorstand-equipment-input blankarmorstand-equipment' id='blankarmorstand-equipment-feet' size='10' />
                            </div>

                            <div class='blankarmorstand-equipment-slot'>
                                <div id='blankarmorstand-equipment-slot-name'>Left Hand</div>
                                <input type='text' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder='Item id' class='blankarmorstand-equipment-input blankarmorstand-equipment' id='blankarmorstand-equipment-lefthand' size='10' />
                            </div>

                            <div class='blankarmorstand-equipment-slot'>
                                <div id='blankarmorstand-equipment-slot-name'>Right Hand</div>
                                <input type='text' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder='Item id' class='blankarmorstand-equipment-input blankarmorstand-equipment' id='blankarmorstand-equipment-righthand' size='10' />
                            </div>
                        </div>

                        <button id='blankarmorstand-equipment-showadvanced'><i class="fa fa-caret-down" aria-hidden="true"></i> Edit NBT data</button>

                        <div id='blankarmorstand-equipment-advanced' style='display: none'>

                            <div class='blankarmorstand-equipment-advanced-slot'>
                                <div id='blankarmorstand-equipment-advanced-slot-name'>Head Slot NBT</div>
                                <input type='text' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder='Head Slot NBT' class='blankarmorstand-equipment-input-advanced blankarmorstand-equipment' id='blankarmorstand-equipment-head-advanced' size='20' />
                            </div>

                            <div class='blankarmorstand-equipment-advanced-slot'>
                                <div id='blankarmorstand-equipment-advanced-slot-name'>Chest Slot NBT</div>
                                <input type='text' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder='Chest Slot NBT' class='blankarmorstand-equipment-input-advanced blankarmorstand-equipment' id='blankarmorstand-equipment-chest-advanced' size='20' />
                            </div>

                            <div class='blankarmorstand-equipment-advanced-slot'>
                                <div id='blankarmorstand-equipment-advanced-slot-name'>Legs Slot NBT</div>
                                <input type='text' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder='Legs Slot NBT' class='blankarmorstand-equipment-input-advanced blankarmorstand-equipment' id='blankarmorstand-equipment-legs-advanced' size='20' />
                            </div>

                            <div class='blankarmorstand-equipment-advanced-slot'>
                                <div id='blankarmorstand-equipment-advanced-slot-name'>Feet Slot NBT</div>
                                <input type='text' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder='Feet Slot NBT' class='blankarmorstand-equipment-input-advanced blankarmorstand-equipment' id='blankarmorstand-equipment-feet-advanced' size='20' />
                            </div>

                            <div class='blankarmorstand-equipment-advanced-slot'>
                                <div id='blankarmorstand-equipment-advanced-slot-name'>Left Hand Slot NBT</div>
                                <input type='text' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder='Left Hand Slot NBT' class='blankarmorstand-equipment-input-advanced blankarmorstand-equipment' id='blankarmorstand-equipment-lefthand-advanced' size='20' />
                            </div>

                            <div class='blankarmorstand-equipment-advanced-slot'>
                                <div id='blankarmorstand-equipment-advanced-slot-name'>Right Hand Slot NBT</div>
                                <input type='text' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder='Right Hand Slot NBT' class='blankarmorstand-equipment-input-advanced blankarmorstand-equipment' id='blankarmorstand-equipment-righthand-advanced' size='20' />
                            </div>
                        </div>
                    </div>

                    <table style='width: 411px'>
                        <tr>
                            <td>
                                <div class='setting-cell'>
                                    <div class='setting-padding'>
                                        <input type='checkbox' id='armorstand-options-invisible'> <label for='armorstand-options-invisible'>Invisible</label><br>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class='setting-cell'>
                                    <div class='setting-padding'>
                                        <input type='checkbox' id='armorstand-options-showarms' checked> <label for='armorstand-options-showarms'>Show Arms</label><br>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class='setting-cell'>
                                    <div class='setting-padding'>
                                        <input type='checkbox' id='armorstand-options-small'> <label for='armorstand-options-small'>Small</label><br>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class='setting-cell'>
                                    <div class='setting-padding'>
                                        <input type='checkbox' id='armorstand-options-nobaseplate' checked> <label for='armorstand-options-nobaseplate'>No Base Plate</label><br>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class='setting-cell'>
                                    <div class='setting-padding'>
                                        <input type='checkbox' id='armorstand-options-nogravity' checked> <label for='armorstand-options-nogravity'>No Gravity</label><br>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class='setting-cell'>
                                    <div class='setting-padding'>
                                        <input type='checkbox' id='armorstand-options-invulnerable'> <label for='armorstand-options-invulnerable'>Invulnerable</label><br>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                    
                    
                </div>
            </div>
        </div>

        <div id='rightclick-keyframe-menu' class='rightclick-keyframe-menu-part'>
            <div class='rightclick-keyframe-menu-button clickable rightclick-keyframe-menu-part rightclick-keyframe-btn' id='rightclick-keyframe-btn-easeremove' btn='none'>Remove Easing</div>
            <div class='rightclick-keyframe-menu-button clickable rightclick-keyframe-menu-part rightclick-keyframe-btn' id='rightclick-keyframe-btn-easein' btn='in'>Ease In</div>
            <div class='rightclick-keyframe-menu-button clickable rightclick-keyframe-menu-part rightclick-keyframe-btn' id='rightclick-keyframe-btn-easeout' btn='out'>Ease Out</div>
            <div class='rightclick-keyframe-menu-button clickable rightclick-keyframe-menu-part rightclick-keyframe-btn' id='rightclick-keyframe-btn-easeboth' btn='both'>Ease In-Out</div>
            <div class='rightclick-keyframe-menu-button rightclick-keyframe-menu-part'>
                <label for='interpolate-amount' class='rightclick-keyframe-menu-part'>Interpolate 1 frame every </label>
                <input type='number' id='interpolate-amount' class='rightclick-keyframe-menu-part' value='2'>
                <label for='interpolate-amount' id='interpolate-amount-label-after' class='rightclick-keyframe-menu-part'>ticks</label>
            </div>
        </div>

        <canvas id='canvas3d' style='width: 0px; height: 0px'>Your browser doesn't support HTML5 canvases! You must update to a browser that does in order to use this tool.</canvas>

        <canvas id='itemloader' width='16' height='16'></canvas>

        <!-- This holds any images that were part of a resource pack uploaded by the user -->
        <div id='rp-image-storage'></div>

        <div class='alert-red messagebox'>
            <i class="fa fa-times messagebox-close"></i>
            <div id='messagebox-red' class='messagebox-text'></div>
        </div>

        <div class='alert-green messagebox'>
            <i class="fa fa-times messagebox-close"></i>
            <div id='messagebox-green' class='messagebox-text'></div>
        </div>

        <div class='alert-yellow messagebox'>
            <i class="fa fa-times messagebox-close"></i>
            <div id='messagebox-yellow' class='messagebox-text'></div>
        </div>

        <div class='alert-blue messagebox'>
            <i class="fa fa-times messagebox-close"></i>
            <div id='messagebox-blue' class='messagebox-text'></div>
        </div>



        <div id='export' class='dialogbox'>
            <div id='export-titlebar' class='dialogbox-titlebar'>
                <div id='export-title' class='dialogbox-title'>Export</div>
                <div id='export-close' class='dialogbox-close'><i class="fa fa-times" style='font-size:1.3em'></i></div>
            </div>
            <div id='export-body' class='dialogbox-body'>
                <div class='export-section dialogbox-section' style='width: 410px'>

                    <div class='setting'>
                        <div class='setting-padding'>
                            <label for='export-output' class='hastooltip' tooltip='Copy this text into a safe location!<br>You can load the current project by importing<br>this text at any time'>Export text</label><br>
                            <textarea id='export-output' onclick="this.focus();this.select()" style='margin-top: 10px' class='textbox-regular' readonly></textarea>
                        </div>
                    </div>

                    <div class='setting'>
                        <div class='setting-padding'>
                            <label for='export-custom' class='hastooltip' tooltip='Here, you can export a list of all rotations and/or<br>positions from an animation or a static structure!'>Export positions or rotations</label><br>

                            <input type='checkbox' id='export-custom-ids' checked /> <label for='export-custom-ids'>Include Block/Item IDs</label><br>
                            <input type='checkbox' id='export-custom-armorstandslots' checked /> <label for='export-custom-armorstandslots'>Include Armorstand slot items</label><br>
                            <input type='checkbox' id='export-custom-positions' checked /> <label for='export-custom-positions'>Include positions</label><br>
                            <input type='checkbox' id='export-custom-rotations' checked /> <label for='export-custom-rotations'>Include rotations</label><br>


                            <textarea id='export-custom' onclick="this.focus();this.select()" style='margin-top: 10px' class='textbox-regular' readonly></textarea>
                        </div>
                    </div>

                    <div class='setting'>
                        <div class='setting-padding'>
                            <label>To generate to use in-game, click the 'Generate' button instead!</label>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>

        <div id='import' class='dialogbox'>
            <div id='import-titlebar' class='dialogbox-titlebar'>
                <div id='import-title' class='dialogbox-title'>Import</div>
                <div id='import-close' class='dialogbox-close'><i class="fa fa-times" style='font-size:1.3em'></i></div>
            </div>
            <div id='import-body' class='dialogbox-body'>
                <div class='import-section dialogbox-section' style='width: 410px'>

                    <div class='setting'>
                        <div class='setting-padding'>

                            <label for='import-input' class='hastooltip' tooltip='Paste an exported project text into<br>the box below to load it!'>Load by text</label><br>
                            <textarea id='import-input' class='textbox-regular' style='margin-top: 10px' placeholder='Paste project text here!'></textarea>

                            <div style='width: 100%; text-align: right'>
                                <button id='import-input-button' style='margin-right: 10px'>Load</button>
                            </div>

                        </div>
                    </div>

                    <div class='setting'>
                        <div class='setting-padding'>
                            <label>Make sure to save your exported text files if you want to edit them in the future!</label>
                        </div>
                    </div>

                </div>

            </div>
        </div>



        <!-- Question box -->

        <div id='questionbox' class='dialogbox'>
            <div id='questionbox-titlebar' class='dialogbox-titlebar'>
                <div id='questionbox-title' class='dialogbox-title'></div>
                <div id='questionbox-close' class='dialogbox-close'><i class="fa fa-times" style='font-size:1.3em'></i></div>
            </div>
            <div id='questionbox-body' class='dialogbox-body'>
                <div class='questionbox-section dialogbox-section'>

                    <div class='setting'>
                        <div class='setting-padding' id='questionbox-text'>

                        </div>
                    </div>

                    <div class='setting-padding' id='questionbox-buttons' style='margin-top:8px'>

                        <button id='questionbox-button-1'></button>

                        <button id='questionbox-button-2'></button>

                    </div>

                </div>

            </div>
        </div>



        <!-- Welcome dialog box -->
        <div id='welcome' class='dialogbox' style='display: block; height: 660px; margin-top: -247px'>
            <div id='welcome-titlebar' class='dialogbox-titlebar'>
                <div id='welcome-title' class='dialogbox-title'>Welcome Foolish Mortals!</div>
                <div id='welcome-close' class='dialogbox-close'><i class="fa fa-times" style='font-size:1.3em'></i></div>
            </div>
            <div id='welcome-body' class='dialogbox-body' style='height: 580px'>

                <div class='welcome-section dialogbox-section' id='welcome-section' style='width: 565px; overflow: hidden;text-align: center'>

                    <div class='setting'>
                        <div class='setting-padding welcome-padded'>

                            Welcome to the armorstand modeller for<br><strong>Minecraft 1.12<strong>

                        </div>

                        <div class='setting-padding welcome-padded'>

                            This tool is a fork of <a href='https://mrgarretto.com/' target='_blank'>MrGarretto</a><br>

                        </div>

                        <div class='setting-padding welcome-padded'>

                            Click here for the <a href='https://wiki.mcparks.us/en/Technicians/AST_Models'>Instructions</a>
						
                        </div>

                        <div class='setting-padding welcome-padded'>

						<iframe src="https://scribehow.com/embed/How_to_use_the_Generator__beLBij9oTA-uOv9WLzMIyA" width="340" height="340" allowfullscreen frameborder="0"></iframe>
                        </div>
                    </div>

                    <div class='welcome-section dialogbox-section' id='welcome-section' style='width: 440px; height: 450px'>

                        <div class='setting'>
                            <div class='setting-padding welcome-padded'>

                                Current Bugs: <br>'Small' Doesn't currently generate <br>Message MrFrank2716#9155 or frankie@mrfrank.art if you encounter any bugs <br>


                            </div>
                        </div>

                    </div>

                </div>

            </div>
        </div>

        <div id='object-browser' class='sidepanel sidepanel-right' style='display: none'>

            <div class='dialogbox-titlebar'>
                <div class='dialogbox-title' style='width: 60%'>Object Browser</div>
                <button id="select-all-objects" style='right: 15px;position: relative'>Select All</button>
                <div class='dialogbox-close'><i class="fa fa-times" style='font-size:1.3em'></i></div>
            </div>

            <div id='object-browser-list'>

            </div>

        </div>



        <script>

            settings = {
                selected: {
                    mode: 'single'
                },
                animate: {
                    ticks: 20,
                    loop: true
                },
                publicPage: 0,
                publicSearchTerm: '',
                selectingCCpos: false,
                showobjectlines: true,
                formatforcmdcombiner: false,
                uniquestring: "AM_" + randomString(6),
                exportCustom: {
                    rotations: true,
                    positions: true,
                    ids: true,
                    armorstandslots: true,
                    cc: true
                },
                multiDirEnabled: false,
                offset: {
                    x: 0,
                    y: 0,
                    z: 0
                },
				//relative position
                relPos: '~',
                importing: false,
                dontSelect: false
            };

            function escapeQuotes(string, times) {
				// times = How many times to escape (defaults to 1 if not set)
				if (times === undefined) {
					times = 1;
				}

				for (var i = 0; i < times; i++) {
					string = string.replace(/\\/g, '\\\\');
					string = string.replace(/"/g, '\\"');
				}

				return string;
			}


            // Opening a command in the command combiner

            function openInCommandCombiner() {

                var rawCommandsInitial = $('#generate-settings-raw-commands').is(':checked');
                var formatForCmdCombinerInitial = $('#output-raw-single-box').is(':checked');

                $('#generate-settings-raw-commands').prop('checked', true).change();

                $('#output-raw-single-box').prop('checked', true).change();

                generateOutput();

                $('#cmdcombinerimportjson').val($('#output-text').val());
                $('#cmdcombinerimportform').submit();

                // Restore checkboxes to their intial settings
                $('#generate-settings-raw-commands').prop('checked', rawCommandsInitial).change();
                $('#output-raw-single-box').prop('checked', formatForCmdCombinerInitial).change();
            }

            blankArmorstands = [];


            $('#skyscraper-right-close').click(function() {
                $('#skyscraper-right').fadeOut(250);
            });

            // Object list

            // Select all button
            $('#select-all-objects').click(function() {

            	if (objects.length === 0)
            		return;

            	for (var i = 0; i < objects.length; i++) {

            		objects[i].userData.selected = (objects[i].userData.rawid !== 'armorstand_torso' && objects[i].userData.rawid !== 'armorstand_arm' && objects[i].userData.rawid !== 'armorstand_leg'); // only set to true for regular objects and necks of armorstands (that is the part that they are moved by)

            	}

            	selectedobjects = [];
            	for (var i = 0; i < objects.length; i++) {

            		if ($.inArray(objects[i], selectedobjects) === -1 && (objects[i].userData.rawid !== 'armorstand_torso' && objects[i].userData.rawid !== 'armorstand_arm' && objects[i].userData.rawid !== 'armorstand_leg')) {
            			selectedobjects.push(objects[i]);
            		}

            	}
            	
            	selectedobject = objects[0];
            	editObject(objects[0]);

            	$('.selectedobj-properties').hide();
                $('#project').show();
                $('#project-list').show();

                window.requestAnimationFrame(render);

            });

            function updateObjectBrowser() {

                $('#object-browser-list').empty();

                for (var i = 0; i < objects.length; i++) {

                    $('#object-browser-list').append("<div class='object-browser-item' objindex='" + i + "'><div class='object-browser-item-text'>" + objects[i].userData.name + " (" + objects[i].userData.rawid + ")</div></div>");

                    $('.object-browser-item').last().click(function() {

                        // Select the object for this item in the list if the user clicks on the list item

                        var objIndex = parseInt($(this).attr('objindex'));


                        if (pressingCtrl) {
                            // Add to array of selected objects

                            if (selectedobjects.length === 0) {

                                selectedobject = null;
                                for (var i = 0; i < objects.length; i++)
                                    objects[i].userData.selected = false;

                                if (selectedobjects.length > 0) {
                                    for (var i = 0; i < selectedobjects.length; i++)
                                        selectedobjects[i].userData.selected = false;
                                    selectedobjects = [];
                                }

                                selectedobject = objects[objIndex];
                                objects[objIndex].userData.selected = true;
                                editObject(objects[objIndex]);

                            }


                            selectedobject = null;

                            $('.selectedobj-properties').hide();
                            $('#project').show();
                            $('#project-list').show();

                            // if (intersectsobj.length === 0) {
                            //     // Reset selected objects and the regular single selected object

                            //     for (var i = 0; i < selectedobjects.length; i++) {

                            //         selectedobjects[i].userData.selected = false;

                            //     }

                            //     selectedobjects = [];

                            // } else {
                                // Otherwise, add to the array if clicking one

                            if ($.inArray(objects[objIndex], selectedobjects) == -1) {
		            			selectedobjects[selectedobjects.length] = objects[objIndex];
		            		}

                            objects[objIndex].userData.selected = true;

                            selectedobject = objects[objIndex];

                            // }

                        } else {

                            // Not holding control key. Only select this single object

                            // Remove old selection

                            selectedobject = null;
                            for (var i = 0; i < objects.length; i++)
                                objects[i].userData.selected = false;

                            if (selectedobjects.length > 0) {
                                for (var i = 0; i < selectedobjects.length; i++)
                                    selectedobjects[i].userData.selected = false;
                                selectedobjects = [];
                            }

                            selectedobject = objects[objIndex];
                            objects[objIndex].userData.selected = true;
                            editObject(objects[objIndex]);

                        }


                        // Blank armorstand item slot preview selections (If a slot preview item is clicked in the object browser, select the parent which is the armorstand part)
                        if (selectedobject !== null && selectedobject.parent !== null && selectedobject.parent.parent.parent.parent.userData.blankArmorstandPreviewSlot === true) {
                            selectedobject = selectedobject.parent.parent.parent.parent.parent.parent.children[0].children[0];

                            // Unselect all objects
                            for (var i = 0; i < objects.length; i++) {
                                objects[i].userData.selected = false;
                            }
                            // Select the blank armorstand part connected to the slot preview object
                            selectedobject.userData.selected = true;

                            editObject(selectedobject);
                        }
                        if (selectedobject === null) {
                            $('#armorstand-options').hide();
                        }


                        window.requestAnimationFrame(render);
                    });

                    $('.object-browser-item').last().mouseenter(function() {

                        // Highlight the object if the user hovers over the item in the list

                        var objIndex = parseInt($(this).attr('objindex'));

                        if (objects[objIndex].userData.selected === false) {

                            objects[objIndex].userData.highlight = true;
                            render();

                        }

                    });

                    $('.object-browser-item').last().mouseleave(function() {

                        // Un-highlight the object if the user's mouse leaves the item in the list

                        var objIndex = parseInt($(this).attr('objindex'));

                        objects[objIndex].userData.highlight = false;

                        render();

                    });

                }

            }

            // Blank armorstand options

            $('#selectedobj-armorstand-options').click(function() {
                $('#armorstand-options').fadeIn(200);
            });

            $('#armorstand-options-invisible').change(function() {
                changeBlankArmorstandInvisible($(this).is(':checked'), 0.5);
            });

            $('#armorstand-options-small').change(function() {
                changeBlankArmorstandSmall($(this).is(':checked'));
            });

            function changeBlankArmorstandInvisible(isInvisible, invisibleOpacity) {
                // Makes the selected blank armorstand invisible or regular depending on the isInvisible argument
                // invisibleOpacity is the opacity the object should have when "invisible"

                var selectedBlankArmorstand = selectedObject().parent.parent.parent.parent.parent;

                if (isInvisible) {

                    for (var i = 0; i < selectedBlankArmorstand.children.length; i++) {
                        for (var j = 0; j < selectedBlankArmorstand.children[i].children[0].children[0].children[0].children[0].children.length; j++) {
                            for (var k = 0; k < selectedBlankArmorstand.children[i].children[0].children[0].children[0].children[0].children[j].material.materials.length; k++) {
                                selectedBlankArmorstand.children[i].children[0].children[0].children[0].children[0].children[j].material.materials[k].transparent = true;
                                selectedBlankArmorstand.children[i].children[0].children[0].children[0].children[0].children[j].material.materials[k].opacity = invisibleOpacity;
                            }
                        }
                    }

                } else {

                    for (var i = 0; i < selectedBlankArmorstand.children.length; i++) {
                        for (var j = 0; j < selectedBlankArmorstand.children[i].children[0].children[0].children[0].children[0].children.length; j++) {
                            for (var k = 0; k < selectedBlankArmorstand.children[i].children[0].children[0].children[0].children[0].children[j].material.materials.length; k++) {
                                selectedBlankArmorstand.children[i].children[0].children[0].children[0].children[0].children[j].material.materials[k].transparent = false;
                                selectedBlankArmorstand.children[i].children[0].children[0].children[0].children[0].children[j].material.materials[k].opacity = 1;
                            }
                        }
                    }

                }

                window.requestAnimationFrame(render);
            }

            function changeBlankArmorstandSmall(isSmall) {
                // Makes the selected blank armorstand small or regular depending on the isSmall argument

                var selectedBlankArmorstand = selectedObject().parent.parent.parent.parent.parent;

                if (isSmall) {

                    // A small armorstand is 0.6x the size of regular. The blank armorstands are 2.37x scale when created
                    selectedBlankArmorstand.scale.set(1.15, 1.15, 1.15);

                    // Make the neck bigger in proportion to the rest of the armorstand
                    selectedBlankArmorstand.children[0].scale.set(1.5, 1.5, 1.5);

                    // Make the hand items positioned correctly for the small armorstand
                    positionHandItems(selectedBlankArmorstand, true);

                } else {

                    selectedBlankArmorstand.scale.set(2.37, 2.37, 2.37);

                    // Make the neck regular in proportion to the rest of the armorstand
                    selectedBlankArmorstand.children[0].scale.set(1, 1, 1);

                    // Make the hand items positioned correctly for the regular sized armorstand
                    positionHandItems(selectedBlankArmorstand, false);

                }

                window.requestAnimationFrame(render);
            }

            function positionHandItems(targetBlankArmorstand, isSmall) {
                // Positions the hand items correctly for small armorstands, or resets the positions to regular if isSmall is false
                // This function now also adjusts the head item since it was slightly off before

                var curArm;

                for (var i = 0; i < targetBlankArmorstand.children.length; i++) {

                    curArm = targetBlankArmorstand.children[i].children[0].children[0].children[0].children[0]

                    if (curArm.userData.rawid === 'armorstand_arm' && targetBlankArmorstand.children[i].children[0].children[0].children[0].children.length >= 3) {

                        var curSlotItem = targetBlankArmorstand.children[i].children[0].children[0].children[0].children[2].children[0].children[0].children[0].children[0];
                        var curSlotItemTopParent = targetBlankArmorstand.children[i].children[0].children[0].children[0].children[2];

                        if (isSmall) {

                            curSlotItem.rotation.x = 35 * (pi / 180);
                            curSlotItem.rotation.y = 45 * (pi / 180);
                            curSlotItemTopParent.position.y = -0.42;
                            curSlotItem.position.z = 0;
                            curSlotItem.parent.scale.set(0.375, 0.375, 0.375);

                        } else {

                            curSlotItem.rotation.x = 15 * (pi / 180);
                            curSlotItem.rotation.y = 45 * (pi / 180);
                            curSlotItemTopParent.position.y = -0.625;
                            curSlotItem.position.z = 0.75;
                            curSlotItem.parent.scale.set(0.375, 0.375, 0.375);

                        }

                    }

                    if (curArm.userData.rawid === 'armorstand_neck' && targetBlankArmorstand.children[i].children[0].children[0].children[0].children.length >= 3) {

                        var curSlotItemTopParent = targetBlankArmorstand.children[i].children[0].children[0].children[0].children[2];

                        if (isSmall) {

                            curSlotItemTopParent.scale.set(0.932, 0.932, 0.932);

                        } else {

                            curSlotItemTopParent.scale.set(1, 1, 1);

                        }

                    }
                }
            }

            $('#armorstand-options-showarms').change(function() {
                changeShowArms($(this).is(':checked'));
            })

            function changeShowArms(showArms) {
                // Makes the arms of the selected blank armorstand either visible or invisible, depending on the showArms parameter

                for (var i = 0; i < selectedobject.parent.parent.parent.parent.parent.children.length; i++) {
                    if (selectedobject.parent.parent.parent.parent.parent.children[i].children[0].children[0].children[0].children[0].userData.rawid === 'armorstand_arm') {
                        selectedobject.parent.parent.parent.parent.parent.children[i].visible = showArms;
                    }
                }

                window.requestAnimationFrame(render);

            }

            // NBT changing for blank armorstands

            $('#armorstand-options-invisible').change(function() {
                selectedObject().parent.parent.parent.parent.parent.userData.nbt.Invisible = $(this).is(':checked');
            });

            $('#armorstand-options-showarms').change(function() {
                selectedObject().parent.parent.parent.parent.parent.userData.nbt.ShowArms = $(this).is(':checked');
            });

            $('#armorstand-options-small').change(function() {
                selectedObject().parent.parent.parent.parent.parent.userData.nbt.Small = $(this).is(':checked');
            });

            $('#armorstand-options-invulnerable').change(function() {
                selectedObject().parent.parent.parent.parent.parent.userData.nbt.Invulnerable = $(this).is(':checked');
            });

            $('#armorstand-options-nobaseplate').change(function() {
                selectedObject().parent.parent.parent.parent.parent.userData.nbt.NoBasePlate = $(this).is(':checked');
            });

            $('#armorstand-options-nogravity').change(function() {
                selectedObject().parent.parent.parent.parent.parent.userData.nbt.NoGravity = $(this).is(':checked');
            });

            // Equipment inputs

            $('#blankarmorstand-equipment-head').change(function() {
                adjustBlankArmorstandSlotNBT('head', $(this).val());

                // Display a preview of the block on the blank armorstand's head
                displayBlankArmorstandSlotPreview(0, $(this).val());

                updateObjectBrowser();
            });
            $('#blankarmorstand-equipment-chest').change(function() {
                adjustBlankArmorstandSlotNBT('chest', $(this).val());
            });
            $('#blankarmorstand-equipment-legs').change(function() {
                adjustBlankArmorstandSlotNBT('legs', $(this).val());
            });
            $('#blankarmorstand-equipment-feet').change(function() {
                adjustBlankArmorstandSlotNBT('feet', $(this).val());
            });
            $('#blankarmorstand-equipment-lefthand').change(function() {
                adjustBlankArmorstandSlotNBT('lefthand', $(this).val());

                // Index = 3 in children of the blankArmorstand object
                // Display a preview of the block on the blank armorstand's head
                displayBlankArmorstandSlotPreview(3, $(this).val());

                updateObjectBrowser();

            });
            $('#blankarmorstand-equipment-righthand').change(function() {
                adjustBlankArmorstandSlotNBT('righthand', $(this).val());

                // Index = 2 in children of the blankArmorstand object
                // Display a preview of the block on the blank armorstand's head
                displayBlankArmorstandSlotPreview(2, $(this).val());

                updateObjectBrowser();
            });

            function displayBlankArmorstandSlotPreview(slot, newItem, callback) {

                newItem = newItem.replace(' ', ':');

                try {
                    var selectedObjBefore = selectedObject();

                    // Remove old previewed block on the head slot
                    for (var i = 0; i < selectedObjBefore.parent.parent.parent.parent.parent.children[slot].children[0].children[0].children[0].children.length; i++) {
                        if (selectedObjBefore.parent.parent.parent.parent.parent.children[slot].children[0].children[0].children[0].children[i].userData.blankArmorstandPreviewSlot === true) {

                            // Remove the old object from the objects[] array too
                            for (var j = objects.length - 1; j >= 0; j--) {
                                if (objects[j].userData.customname === selectedObjBefore.parent.parent.parent.parent.parent.children[slot].children[0].children[0].children[0].children[i].children[0].children[0].children[0].children[0].userData.customname) {
                                    objects.splice(j, 1);
                                }
                            }

                            selectedObjBefore.parent.parent.parent.parent.parent.children[slot].children[0].children[0].children[0].remove(selectedObjBefore.parent.parent.parent.parent.parent.children[slot].children[0].children[0].children[0].children[i]);
                        }
                    }


                    if (newItem.length === 0) {

                        if (callback !== undefined) {
                            callback();
                        }

                        if (selectedObjBefore.parent.parent.parent.parent.parent.userData.nbt.Small === true)
                            changeBlankArmorstandSmall(selectedObjBefore.parent.parent.parent.parent.parent, true);

                        return;
                    }


                    var armorstandOptionsWasVisible = false;
                    if ($('#armorstand-options').is(':visible')) {
                        armorstandOptionsWasVisible = true;
                    }

                    models.createObj(newItem, {selectedObjBefore: selectedObjBefore, armorstandOptionsWasVisible: armorstandOptionsWasVisible, callback: callback, displaySlot: slot}, function(data) {

                        $('.alert-red').hide();

                        if (data.success === false) {

                            if (selectedObjBefore.parent.parent.parent.parent.parent.userData.nbt.Small === true)
                            changeBlankArmorstandSmall(selectedObjBefore.parent.parent.parent.parent.parent, true);

                            if (data.retain.callback !== undefined) {
                                data.retain.callback();
                            }

                            window.requestAnimationFrame(render);
                            return;
                        }

                        data.obj.userData.justAdded = true;

                        // data.obj.scale.set(1, 1, 1); why was this even here? ...

                        if (slot === 0) {
                            data.topparent.scale.set(1, 1, 1);
                            data.obj.parent.scale.set(0.62, 0.62, 0.62);
                            data.topparent.position.y = 0.24;

                            if (data.obj.userData.isItem === true) {
                                data.obj.position.y = (1/16) * 12;
                                data.obj.position.z = (1/16) * -7;
                            }
                        } else {

                            // In a hand slot

                            if (data.retain.isCustomModel === undefined) {
                                // Default position for items in hand when it is not a custom model

                                // Eventually, make it different for items so they display correctly in the hand
                                data.obj.rotation.x = 15 * (pi / 180);
                                data.obj.rotation.y = 45 * (pi / 180);
                                data.topparent.position.y = -0.625;
                                data.obj.position.z = 0.75;
                                data.obj.parent.scale.set(0.375, 0.375, 0.375);
                            } else {

                                data.obj.parent.scale.set(1, 1, 1);

                                // This x rotation might have to eventually be applied to a separate parent object if this doesn't always work because of eulers
                                data.obj.rotation.x += 90 * (pi / 180);

                                data.obj.parent.parent.parent.parent.position.set(0, -0.625, 0.122);

                                // The translation is applied sideways here (by using the normal one to swap the z and y axis)
                                var startTranslation = {
                                    x: data.obj.position.x,
                                    y: data.obj.position.y,
                                    z: data.obj.position.z
                                };

                                data.obj.position.set(startTranslation.x, startTranslation.z, startTranslation.y);

                            }
                            
                        }

                        data.topparent.scale.set(1, 1, 1);

                        var blankArmorstandObj = data.retain.selectedObjBefore.parent.parent.parent.parent.parent;

                        // Add the new block preview to the left arm child of the blank armorstand
                        blankArmorstandObj.children[slot].children[0].children[0].children[0].add(data.topparent);

                        data.topparent.userData.blankArmorstandPreviewSlot = true;

                        editObject(data.retain.selectedObjBefore);

                        selectedobject = data.retain.selectedObjBefore;
                        for (var i = 0; i < objects.length; i++) {
                            objects[i].userData.selected = false;
                        }
                        data.retain.selectedObjBefore.userData.selected = true;

                        updateObjectMoverLines();

                        if (data.retain.armorstandOptionsWasVisible === true)
                            $('#armorstand-options').show();

                        if (selectedObjBefore.parent.parent.parent.parent.parent.userData.nbt.Small === true)
                            changeBlankArmorstandSmall(selectedObjBefore.parent.parent.parent.parent.parent, true);

                        if (data.retain.callback !== undefined) {

                            data.retain.callback();
                        }

                    });

                } catch (error) {

                    console.log('Error adding blank armorstand\'s head slot preview to the scene: ' + error);
                    
                }

            }

            $('.blankarmorstand-equipment-input-advanced').change(function() {

                updateBlankArmorstandNBT();

            });

            function adjustBlankArmorstandSlotNBT(slot, newItem) {

                var currentNBT = $('#blankarmorstand-equipment-' + slot + '-advanced').val();

                newItem = newItem.replace(/:/, ' ');

                if (newItem.length === 0) {
                    $('#blankarmorstand-equipment-' + slot + '-advanced').val('{}');
                    return;
                }

                var itemDamage = '';

                if (newItem.indexOf(' ') > -1) {
                    var itemInputParts = newItem.split(' ');
                    itemDamage = ',Damage:' + itemInputParts[1];
                    newItem = itemInputParts[0];
                }

                if (currentNBT === '{}' || currentNBT === '') {
                    // NBT is currently blank
                    $('#blankarmorstand-equipment-' + slot + '-advanced').val('{id:' + newItem + itemDamage + ',Count:1b}');
                } else {
                    // NBT has already been changed
                    if (currentNBT.indexOf('id:') > -1) {
                        // Found an item id in the NBT; it should be replaced

                        // Fix empty damage tags
                        if (currentNBT.match(/Damage:[0-9a-zA-Z ]+/) === null) {
                            currentNBT = currentNBT.replace(',Damage:', '').replace('Damage:,', '');
                        }

                        if (currentNBT.indexOf('Damage:') > -1) {

                            // Replace old damage value
                            $('#blankarmorstand-equipment-' + slot + '-advanced').val(currentNBT.replace(/id:[a-zA-Z0-9:_ ]+/, 'id:' + newItem).replace(/,Damage:[0-9 ]+/, itemDamage).replace(/Damage:[0-9 ]+,/, itemDamage.replace(',', '') + ','));
                        } else {
                            // Add new damage value after item id
                            $('#blankarmorstand-equipment-' + slot + '-advanced').val(currentNBT.replace(/id:[a-zA-Z0-9:_ ]+/, 'id:' + newItem + itemDamage));
                        }
                        
                    } else {
                        // No item id found in the NBT; add it to the beginning
                        $('#blankarmorstand-equipment-' + slot + '-advanced').val(currentNBT.replace('{', '{Count:1b,id:' + newItem + itemDamage));
                    }
                }

                updateBlankArmorstandNBT();
                
            }

            function getItemIdFromNBT(itemNBT) {
                var getItemId = itemNBT.match(/id:([a-zA-Z0-9_: ]+)/);
                var getDamage = itemNBT.match(/Damage:([a-zA-Z0-9_: ]+)/);
                if (getItemId === null)
                    return '';

                if (getDamage === null) {
                    return getItemId[1];
                } else {
                    return getItemId[1] + ' ' + getDamage[1];
                }
            }

            function copyBlankArmorstand(oldBlankArmorstand) {

                models.insert.blankArmorstand(function(newBlankArmorstand) {

                    newBlankArmorstand.position.copy(oldBlankArmorstand.position);


                    // Copy the rotations of each body part
                    for (var i = 0; i < newBlankArmorstand.children.length; i++) {

                        newBlankArmorstand.children[i].children[0].children[0].children[0].rotation.x = oldBlankArmorstand.children[i].children[0].children[0].children[0].rotation.x;
                        newBlankArmorstand.children[i].children[0].children[0].rotation.y = oldBlankArmorstand.children[i].children[0].children[0].rotation.y;
                        newBlankArmorstand.children[i].children[0].rotation.z = oldBlankArmorstand.children[i].children[0].rotation.z;

                    }

                    newBlankArmorstand.rotation.y = oldBlankArmorstand.rotation.y;

                    // Copies the NBT from the old armorstand to the new one without making a reference to it
                    newBlankArmorstand.userData.nbt = $.extend(true, {}, oldBlankArmorstand.userData.nbt);


                    // Select the new armorstand's torso
                    for (var i = 0; i < objects.length; i++) {
                        objects[i].userData.selected = false;
                    }
                    newBlankArmorstand.children[1].children[0].children[0].children[0].children[0].userData.selected = true;
                    selectedobject = newBlankArmorstand.children[1].children[0].children[0].children[0].children[0];

                    editObject(newBlankArmorstand.children[1].children[0].children[0].children[0].children[0]);


                    // Item slot previews
                    displayBlankArmorstandSlotPreview(0, getItemIdFromNBT(newBlankArmorstand.userData.nbt.ArmorItems[3]), function() {
                        //models.resetModelAccumulate();
                        displayBlankArmorstandSlotPreview(2, getItemIdFromNBT(newBlankArmorstand.userData.nbt.HandItems[0]), function() {
                            //models.resetModelAccumulate();
                            displayBlankArmorstandSlotPreview(3, getItemIdFromNBT(newBlankArmorstand.userData.nbt.HandItems[1]), function() {
                                //models.resetModelAccumulate();

                                changeBlankArmorstandSmall(selectedobject.parent.parent.parent.parent.parent.userData.nbt.Small);
                            });
                        });
                    });
                });

            }

            // Saving changes to the equipment
            function updateBlankArmorstandNBT() {

                var blankArmorstandNBT = selectedObject().parent.parent.parent.parent.parent.userData.nbt;

                blankArmorstandNBT.ArmorItems = [$('#blankarmorstand-equipment-feet-advanced').val(),$('#blankarmorstand-equipment-legs-advanced').val(),$('#blankarmorstand-equipment-chest-advanced').val(),$('#blankarmorstand-equipment-head-advanced').val()];

                blankArmorstandNBT.HandItems = [$('#blankarmorstand-equipment-righthand-advanced').val(), $('#blankarmorstand-equipment-lefthand-advanced').val()];

            };

            $('#blankarmorstand-equipment-showadvanced').click(function() {
                $('#blankarmorstand-equipment-advanced').toggle();
            });

            $('.blankarmorstand-equipment-input-advanced').change(function() {
                if ($(this).val().length === 0) {
                    $(this).val('{}');
                }
            });

            // End of equipment inputs

            // End of NBT

            // End of blank armorstand options

            $('#object-list').click(function() {

                updateObjectBrowser();

                $('#object-browser').fadeIn(200);

            });

            // Offsets (relative and absolute)

            $('.options-offset').change(function() {

                settings.offset.x = parseInt($('#options-offset-x').val());
                settings.offset.y = parseInt($('#options-offset-y').val());
                settings.offset.z = parseInt($('#options-offset-z').val());

            });

            $('#options-offset-absolute').change(function() {

                if ($(this).is(':checked')) {
                    settings.relPos = ''
                } else {
                    settings.relPos = '~';
                }

                var curObj = selectedObject();

                if (curObj !== false) {

                    updatePositionInputs(curObj);

                }

            });

            // Multi-directional placement

            $('#generate-settings-reusable-multidirectional-amount').change(function() {

                generateOutput();

            });

            $('#generate-settings-reusable-multidirectional').change(function() {

                updateMultidirectionalContainer();

                generateOutput();

            });

            function updateMultidirectionalContainer() {

                if ($('#generate-settings-reusable-multidirectional').is(':checked')) {

                    $('#generate-settings-reusable-multidirectional-amount-container').show();

                    settings.multiDirEnabled = true;

                } else {

                    $('#generate-settings-reusable-multidirectional-amount-container').hide();

                    settings.multiDirEnabled = false;

                }

                if ($('#animate-settings-enable').is(':checked')) {
                    // If animations are enabled, hide the entire thing (for now at least)
                    
                    $('#generate-settings-reusable-multidirectional-container').hide();

                } else {

                    $('#generate-settings-reusable-multidirectional-container').show();

                }
            }

            function getMultiDirExecutes(regularExecuteCmd) {

                // regularExecuteCmd is the execute command that would have been the only one if the multi-directional option wasn't active

                var amountOfDirs = parseInt($('#generate-settings-reusable-multidirectional-amount').val());

                var executeCmds = [];

                var currentRot = {};

                var eachSegment = Math.floor((1 / amountOfDirs) * 360); // Amount of degrees that are in each rotation command

                for (var i = 0; i < amountOfDirs; i++) {

                    currentRot.min = Math.floor(((i / amountOfDirs) * 360) - 180 - Math.floor(eachSegment / 2));

                    currentRot.max = currentRot.min + eachSegment; // The max is just the min + the amount of degrees in each segment

                    executeCmds[executeCmds.length] = 'execute @a[rym=' + currentRot.min + ',ry=' + currentRot.max + '] ~ ~ ~ ' + regularExecuteCmd;

                }

                return executeCmds;

            }

            // End of multi-directional placement

            $('#options-unique-scoreboard').val(settings.uniquestring);

            settings.navBarVisible = false;

            // $('#nav').slideUp(500);

            // Menu button (opens the navbar)


            // Exporting custom lists

            $('#export-custom-positions').change(function() {

                settings.exportCustom.positions = $(this).is(':checked');

                exportCustomList();

            });

            $('#export-custom-rotations').change(function() {

                settings.exportCustom.rotations = $(this).is(':checked');

                exportCustomList();

            });

            $('#export-custom-ids').change(function() {

                settings.exportCustom.ids = $(this).is(':checked');

                exportCustomList();

            });

            $('#export-custom-armorstandslots').change(function() {

                settings.exportCustom.armorstandslots = $(this).is(':checked');

                exportCustomList();

            });

            $('#export-custom-cc').change(function() {

                settings.exportCustom.cc = $(this).is(':checked');

                exportCustomList();

            });

            function exportCustomList() {

                $('#generate').show();
                generateOutput();
                $('#generate').hide();

                // Save all object positions before modifying them so that they can be reverted afterwards
                saveKeyframeObjectPositions();

                sceneWrapper.updateMatrixWorld();

                for (var j = 0; j < keyframes.length; j++) {

                    animatePlayhead.ontick = keyframes[j].ontick;
                    loadKeyframeFromPlayhead();

                    for (var k = 0; k < objects.length; k++) {
                        objects[k].updateMatrixWorld();
                        objects[k].parent.parent.parent.parent.updateMatrixWorld();
                    }

                    updateSceneWrapperRotation();

                    for (var k = 0; k < keyframes[j].objects.length; k++) {

                        var curObj = getObjectByUUID(keyframes[j].objects[k].uuid);

                        if (keyframes[j].objects[k].objref.userData.rawid !== 'armorstand_torso' && keyframes[j].objects[k].objref.userData.rawid !== 'armorstand_neck') {
                            keyframes[j].objects[k].position = {
                                x: parseFloat(parseFloat(curObj.parent.parent.parent.parent.position.x).toFixed(7)),
                                y: parseFloat(parseFloat(curObj.parent.parent.parent.parent.position.y).toFixed(7)),
                                z: parseFloat(parseFloat(curObj.parent.parent.parent.parent.position.z).toFixed(7))
                            }
                        }

                        keyframes[j].objects[k].rotation = {
                            x: curObj.parent.rotation.x,
                            y: curObj.parent.parent.rotation.y,
                            z: curObj.parent.parent.parent.rotation.z
                        }

                        keyframes[j].objects[k].forcerotated = true;

                    }

                    resetSceneWrapperRotation();

                }

                var exportList = generateAnimationCommands(true); // Generate animation command and return list (that's what the argument, 'true' does)

                removeTempFrames();
                
                restoreKeyframeObjectPositions();

                loadKeyframeFromPlayhead();

                $('#export-custom').val(exportList);

            }

            // Help button

            $('#help-button').click(function() {

                // Secret window
                // if ($('#welcome').is(":visible")) {

                    // $('#welcome').fadeOut(200);
                    // $('#secret-window').fadeIn(200);

                // } else {

                $('#welcome').fadeIn(200);

                // }

            });

            // Change unique scoreboard
            $('#options-unique-scoreboard').change(function() {

                settings.uniquestring = $(this).val();

            });

            // Toggle rotation center

            $('#manipulate-toggle-rotationcenter').change(function() {

                if (!$(this).is(':checked')) {

                    // No rotation center

                    var curObj = selectedObject();

                    for (var i = 0; i < curObj.parent.children.length; i++) {
                        if (curObj.parent.children[i].userData.isRotationOffset) {

                            curObj.position.y = -curObj.parent.children[i].position.y;

                            curObj.parent.children[i].userData.originalPosY = curObj.parent.children[i].position.y;

                            curObj.parent.children[i].position.y -= curObj.parent.children[i].position.y;

                        }
                    }

                    curObj.userData.enableRotCenter = false;

                } else {

                    // Enable rotation center

                    var curObj = selectedObject();

                    curObj.position.y = 0;

                    for (var i = 0; i < curObj.parent.children.length; i++) {
                        if (curObj.parent.children[i].userData.isRotationOffset) {

                            curObj.parent.children[i].position.y = curObj.parent.children[i].userData.originalPosY;

                        }
                    }

                    curObj.userData.enableRotCenter = true;

                }

                window.requestAnimationFrame(render);

            });

            // Custom commands

            $('#customcommands-selectobj-done').click(function() {
                // User has selected an object

                $('.cpbottom').slideDown(100);

                $('#customcommands').slideDown(150);

                $('#animate').fadeIn(100);

                $('#customcommands-selectobj').slideUp(150);

                settings.selectingCCpos = false;

                var selectedObjPos = {
                    x: selectedobject.parent.parent.parent.parent.position.x,
                    y: selectedobject.parent.parent.parent.parent.position.y,
                    z: selectedobject.parent.parent.parent.parent.position.z
                };

                var newCommand = 'execute @e[tag=' + settings.uniquestring + ',name=' + selectedobject.userData.customname + ',score_' + settings.uniquestring + '_min=' + (animatePlayhead.ontick + 1) + ',score_' + settings.uniquestring + '=' + (animatePlayhead.ontick + 1) + '] ~ ~ ~ ' + settings.selectingCCtxtbox.val();

                settings.selectingCCtxtbox.val(newCommand);

                updateCCinKeyframe();

            });

            $('#customcommands-selectobj-objname').hide();

            $('#customcommands-add').click(function() {

                var curKeyframe = keyframes[keyframeAt(animatePlayhead.ontick)];

                curKeyframe.cc.push({

                    command: ""

                });

                updateCustomCommandsList();

            });

            $('#customcommands-selectobj-cancel').click(function() {

                settings.selectingCCpos = false;

                updateCCbutton();

                $('.cpbottom').slideDown(100);

                $('#customcommands').slideDown(150);

                $('#animate').fadeIn(100);

                $('#customcommands-selectobj').slideUp(150);

            });

            window.setTimeout(function() {
                updateCCbutton();
            }, 1000);

            function updateCCbutton() {

                var currentKeyframe = keyframes[keyframeAt(animatePlayhead.ontick)];

                if (currentKeyframe === undefined || settings.selectingCCpos === true) {

                    $('#animate-view-customcommands').css('opacity', '0.5').attr('disabled', true).removeClass('clickable');

                } else {

                    $('#animate-view-customcommands').css('opacity', '1').attr('disabled', false).addClass('clickable');

                }

            }

            var wesleyBentDict = {
                right_arm_bent: 84,
                right_arm_bent2: 85,
                left_arm_bent: 86,
                left_arm_bent2: 87,
                right_leg_bent: 88,
                right_leg_bent2: 89,
                left_leg_bent: 90,
                left_leg_bent2: 91,
                right_arm: 80,
				left_arm: 81,
				right_leg: 82,
				left_leg: 83
            }

            function updateCCinKeyframe() {
                // Updates the custom commands from the current custom command text boxes and inserts them into the currently selected keyframe

                var getKeyframe = keyframes[keyframeAt(animatePlayhead.ontick)];

                getKeyframe.cc = [];

                var currentCommand = '';

                resetWesleyBentModels();

                $('.cc-textbox').each(function() {

                    currentCommand = $(this).val();

                    getKeyframe.cc.push({

                        command: currentCommand

                    });

                    applyWesleyBentModels(currentCommand);

                });
            }

            function applyWesleyBentModels(string) {

                if (string.match(/^[a-zA-Z0-9_ ]+\:[a-zA-Z0-9_]+/)) {

                    // Hidden Wesley feature: Allows the user to preview bent arms or legs

                    var objectToBend = string.match(/^([a-zA-Z0-9_ ]+)\:/)[1];
                    var modelToUse = string.match(/^[a-zA-Z0-9_ ]+\:([a-zA-Z0-9_]+)/)[1];

                    for (var i = 0; i < objects.length; i++) {

                        if (objects[i].userData.name === objectToBend) {

                            // CONTINUE HERE

                            var retainRawID = objects[i].userData.rawid;
                            var retainUUID = objects[i].uuid;

                            if (modelToUse.indexOf('_arm_') > -1) {

                                var retainSelectedObj = selectedObject();

                                for (var j = 0; j < objects.length; j++) {
                                    objects[j].userData.selected = false;
                                }

                                objects[i].userData.selected = true;
                                selectedobject = objects[i];

                                if (modelToUse.indexOf('left_') > -1) {

                                    displayBlankArmorstandSlotPreview(3, 'diamond_hoe:' + wesleyBentDict[modelToUse]);

                                } else {

                                    displayBlankArmorstandSlotPreview(2, 'diamond_hoe:' + wesleyBentDict[modelToUse]);

                                }

                                for (var j = 0; j < objects.length; j++) {
                                    objects[j].userData.selected = false;
                                }

                                retainSelectedObj.userData.selected = true;
                                selectedobject = retainSelectedObj;

                            } else {

                                changeBlockId(objects[i].uuid, 'diamond_hoe:' + wesleyBentDict[modelToUse], true);

                            }

                            var modifiedObject = getObjectByUUID(retainUUID);

                            modifiedObject.userData.wesleyBentOldID = retainRawID;
                            modifiedObject.userData.wesleyBent = true;

                            break;

                        }

                    }

                }

            }

            function resetWesleyBentModels() {

                for (var i = 0; i < objects.length; i++) {

                    if (objects[i].userData.wesleyBent === true) {

                        objects[i].userData.wesleyBent = false;

                        changeBlockId(objects[i].uuid, objects[i].userData.wesleyBentOldID, true);

                    }

                }

            }

            function updateCustomCommandsList() {
                var curKeyframe = keyframes[keyframeAt(animatePlayhead.ontick)];

                resetWesleyBentModels();

                if (curKeyframe !== undefined) {

                    if (curKeyframe.cc === undefined)
                        curKeyframe.cc = [];

                    if (curKeyframe.cc.length === 0) {

                        $('#customcommands-list').html('<div class="alert-yellow">No custom commands have been added to this keyframe yet!</div>')
                        return;

                    } else {
                        // There are custom commands on this keyframe

                        $('#customcommands-list').empty();

                        for (var i = 0; i < curKeyframe.cc.length; i++) {

                            applyWesleyBentModels(curKeyframe.cc[i].command);

                            $('#customcommands-list').append('<div class="cc-item"><input type="text" class="cc-textbox" placeholder="Type any command here!"><i class="fa fa-at cc-pos"></i><i class="fa fa-trash cc-delete"></i></div>');

                            $('.cc-textbox').last().val(curKeyframe.cc[i].command); // Add the command to the text in the input box

                            $('.cc-pos').last().click(function() {
                                // User must select an object to execute the command at (can be a 'dummy' object)

                                $('.dialogbox').slideUp(150);

                                $('.cpbottom').slideUp(100);

                                $('#animate').fadeOut(100);

                                $('#customcommands-selectobj').slideDown(150);

                                settings.selectingCCpos = true;
                                settings.selectingCCtxtbox = $('.cc-textbox').last();

                                updateCCbutton();

                            });

                            $('.cc-delete').last().click(function() {

                                $(this).parent().remove(); // Delete button

                                updateCCinKeyframe();

                                updateCustomCommandsList();

                            });

                            $('.cc-textbox').change(function() {

                                updateCCinKeyframe();

                            });

                        }

                    }

                } else {

                    // No keyframe on the current tick. Find one before it to load the Wesley custom commands from

                    var highestTickBeforePlayhead = -1;
                    var closestKeyframe;

                    for (var i = 0; i < keyframes.length; i++) {

                        if (keyframes[i].ontick > highestTickBeforePlayhead && keyframes[i].ontick <= animatePlayhead.ontick) {
                            closestKeyframe = keyframes[i];
                        }

                    }

                    if (closestKeyframe.cc !== undefined) {

                        for (var i = 0; i < closestKeyframe.cc.length; i++) {

                            applyWesleyBentModels(closestKeyframe.cc[i].command);

                        }

                    }

                }

            }

            $('#animate-view-customcommands').click(function() {
                // Make the dialog box for custom commands visible

                updateCustomCommandsList();

                $('#customcommands').fadeIn(150);

            });


            // Importing and exporting projects below here

            $('#project-export').click(function() {

                var exportString = exportJSON();

                $('.dialogbox').fadeOut(150);

                $('#export-output').val(exportString);
                $('#export').fadeIn(150);

                exportCustomList();

            });

            $('#project-import').click(function() {

                $('.dialogbox').fadeOut(150);
                
                $('#import').fadeIn(150);

            });

            $('#import-input-button').click(function() {

                var input = $('#import-input').val();

                importJSON(input);

                $('#import').fadeOut(150);

                MessageBox.green('The project was successfully loaded!');

            });


            function exportJSON() {

                // Create the objects array for the export json

                var exportObjects = [];

                for (var i = 0; i < objects.length; i++) {

                    if (objects[i].userData.rawid.indexOf('armorstand_') > -1 || objects[i].parent.parent.parent.parent.userData.blankArmorstandPreviewSlot === true)
                        continue; // Skip this object if it is part of a blank armorstand

                    exportObjects[exportObjects.length] = {

                        userData: objects[i].userData,

                        uuid: objects[i].uuid

                    }

                    // Remove armorstand object reference

                    if (exportObjects[exportObjects.length-1].userData.armorStandRef !== undefined) {

                        delete exportObjects[exportObjects.length-1].userData.armorStandRef;

                    }

                }

                // Blank armorstands array for the exported json

                var exportBlankArmorstands = [];

                for (var i = 0; i < blankArmorstands.length; i++) {

                    exportBlankArmorstands[exportBlankArmorstands.length] = {

                        position: {
                            x: blankArmorstands[i].position.x,
                            y: blankArmorstands[i].position.y,
                            z: blankArmorstands[i].position.z
                        },

                        rotation: blankArmorstands[i].rotation.y,

                        nbt: $.extend(true, {}, blankArmorstands[i].userData.nbt),

                        partrotations: [],

                        partUUIDs: [],

                        partNames: []

                    }

                    for (var j = 0; j < blankArmorstands[i].children.length; j++) {

                        exportBlankArmorstands[exportBlankArmorstands.length-1].partrotations.push({x: blankArmorstands[i].children[j].children[0].children[0].children[0].rotation.x, y: blankArmorstands[i].children[j].children[0].children[0].rotation.y, z: blankArmorstands[i].children[j].children[0].rotation.z});

                        exportBlankArmorstands[exportBlankArmorstands.length-1].partUUIDs.push(blankArmorstands[i].children[j].children[0].children[0].children[0].children[0].uuid);

                        exportBlankArmorstands[exportBlankArmorstands.length-1].partNames.push(blankArmorstands[i].children[j].children[0].children[0].children[0].children[0].userData.name);

                    }

                }

                // Create the keyframes array for the export json

                var exportKeyframes = [];

                for (var i = 0; i < keyframes.length; i++) {

                    exportKeyframes[exportKeyframes.length] = {

                        ontick: Math.round(keyframes[i].ontick),

                        objects: [],

                        scenerot: {
                            x: keyframes[i].scenerot.x,
                            y: keyframes[i].scenerot.y,
                            z: keyframes[i].scenerot.z
                        },

                        cc: []

                    }

                    if (keyframes[i].cc !== undefined) {

                        for (var j = 0; j < keyframes[i].cc.length; j++) {

                            exportKeyframes[exportKeyframes.length-1].cc.push({command: keyframes[i].cc[j].command});

                        }

                    }

                    for (var j = 0; j < keyframes[i].objects.length; j++) {

                        exportKeyframes[exportKeyframes.length-1].objects[exportKeyframes[exportKeyframes.length-1].objects.length] = {

                            customname: keyframes[i].objects[j].customname,

                            position: keyframes[i].objects[j].position,

                            rotation: keyframes[i].objects[j].rotation,

                            size: keyframes[i].objects[j].size,

                            uuid: keyframes[i].objects[j].uuid,

                            visible: keyframes[i].objects[j].visible

                        }

                        // Because the object reference cannot be stringified, the load function will have to find the reference after the objects are loaded, based
                        // on the uuid in each keyframe object

                    }

                }

                // Get the tweening array for the export json

                var exportTweening = tweening;

                // Export settings object

                var exportSettings = {

                    options: {
                        showaxis: $('#options-showaxislines').is(':checked'),
                        showmovers: $('#options-showobjectlines').is(':checked'),
                        uniquestr: $('#options-unique-scoreboard').val(),
                        rotation: {
                            x: parseInt($('#options-rotation-x').val()),
                            y: parseInt($('#options-rotation-y').val()),
                            z: parseInt($('#options-rotation-z').val())
                        },
                        offset: {
                            abs: $('#options-offset-absolute').is(':checked'),
                            x: parseInt($('#options-offset-x').val()),
                            y: parseInt($('#options-offset-y').val()),
                            z: parseInt($('#options-offset-z').val())
                        },
                        armswayX: $('#animate-settings-arm-sway-x').val(),
                        armswayY: $('#animate-settings-arm-sway-y').val(),
                        armswayZ: $('#animate-settings-arm-sway-z').val(),
                        armswayTicks: $('#animate-settings-arm-sway-ticks').val()

                    },

                    generate: {

                        placeat: $('#generate-settings-reusable-entity').val(),
                        giveegg: $('#generate-settings-reusable-spawnegg').is(':checked'),
                        attach: $('#generate-settings-reusable-attach').val(),

                        rawcmds: $('#generate-settings-raw-commands').is(':checked')

                    },

                    animation: {

                        enable: $('#animate-settings-enable').is(':checked'),
                        loop: $('#animate-settings-loop').is(':checked'),
                        interpolate: $('#animate-settings-tweening').is(':checked'),
                        ticks: $('#animate-settings-length').val(),
                        strict: $('#animate-settings-hardtp').is(':checked'),
                        armsway: $('#animate-settings-arm-sway').is(':checked'),
                        armswayX: $('#animate-settings-arm-sway-x').val(),
                        armswayY: $('#animate-settings-arm-sway-x').val(),
                        armswayZ: $('#animate-settings-arm-sway-x').val(),
                        armswayTicks: $('#animate-settings-arm-sway-ticks').val()

                    }

                }

                var exportObject = {

                    objects: exportObjects,
                    keyframes: exportKeyframes,
                    tweening: exportTweening,
                    settings: exportSettings,
                    blankarmorstands: exportBlankArmorstands

                };

                return JSON.stringify(exportObject);

            }

            var waiting = 0;

            function importJSON(jsonString) {

                $('#public-project-info').hide();

                settings.selectingCCpos = false;

                // Remove all objects from scene

                for (var i = 0; i < objects.length; i++) {

                    if (objects[i].userData.rawid.indexOf('armorstand_') === -1) {
                        sceneWrapper.remove(objects[i].parent.parent.parent.parent);
                    }

                }

                for (var i = 0; i < blankArmorstands.length; i++) {

                    sceneWrapper.remove(blankArmorstands[i]);

                }

                objects = [];
                objectrotationwrappers = [];
                rotationwrappersparent = [];
                blankArmorstands = [];

                var importObject = JSON.parse(jsonString);

                settings.importing = true;

                // import settings

                if (importObject.settings.options.uniquestr === undefined)
                    importObject.settings.options.uniquestr = randomString(5);

                if (importObject.settings.options.rotation === undefined)
                    importObject.settings.options.rotation = {x: 0, y: 0, z: 0};

                if (importObject.settings.options.offset === undefined)
                    importObject.settings.options.offset = {abs: false, x: 0, y: 0, z: 0};

                $('#options-showaxislines').prop('checked', importObject.settings.options.showaxis);
                $('#options-showobjectlines').prop('checked', importObject.settings.options.showmovers);

                $('#options-unique-scoreboard').val(importObject.settings.options.uniquestr);
                
                $('#options-rotation-x').val(importObject.settings.options.rotation.x);
                $('#options-rotation-y').val(importObject.settings.options.rotation.y);
                $('#options-rotation-z').val(importObject.settings.options.rotation.z);

                $('#options-offset-absolute').prop('checked', importObject.settings.options.offset.abs);

                $('#generate-settings-reusable-entity').val(importObject.settings.generate.placeat);
                $('#generate-settings-reusable-spawnegg').prop('checked', importObject.settings.generate.giveegg);
                $('#generate-settings-reusable-attach').val(importObject.settings.generate.attach);

                $('#generate-settings-raw-commands').prop('checked', importObject.settings.generate.rawcmds);


                $('#animate-settings-enable').prop('checked', importObject.settings.animation.enable).trigger('change');
                $('#animate-settings-enable-2').prop('checked', importObject.settings.animation.enable).trigger('change');
                $('#animate-settings-loop').prop('checked', importObject.settings.animation.loop);
                $('#animate-settings-tweening').prop('checked', importObject.settings.animation.interpolate);

                if (importObject.settings.animation.ticks === true || importObject.settings.animation.ticks === false) {
                    $('#animate-settings-length').val(20).trigger('change');
                } else {
                    $('#animate-settings-length').val(importObject.settings.animation.ticks).trigger('change');
                }
                $('#animate-settings-hardtp').prop('checked', importObject.settings.animation.strict);
                $('#animate-settings-arm-sway').prop('checked', importObject.settings.animation.armsway);

                $('#animate-settings-arm-sway-x').val(importObject.settings.options.armswayX).change();
                $('#animate-settings-arm-sway-y').val(importObject.settings.options.armswayY).change();
                $('#animate-settings-arm-sway-z').val(importObject.settings.options.armswayZ).change();
                $('#animate-settings-arm-sway-ticks').val(importObject.settings.options.armswayTicks).change();

                $('#options-offset-x').val(importObject.settings.options.offset.x).change();
                $('#options-offset-y').val(importObject.settings.options.offset.y).change();
                $('#options-offset-z').val(importObject.settings.options.offset.z).change();

                // end of import settings

                recursiveLoadBlankArmorstands(importObject.blankarmorstands, function() {

                    // Done loading blank armorstands

                    loadObjFromProj({

                        importObject: importObject,
                        i: 0

                    }, function() {
                        // (callback)
                        // All object adding is done

                        var transferKeyframes = JSON.stringify(importObject.keyframes);

                        keyframes = JSON.parse(transferKeyframes);

                        for (var j = 0; j < keyframes.length; j++) {

                            keyframes[j].ontick = Math.round(keyframes[j].ontick); // Fixes weird things like 14.99999999999999 to 15

                            for (var k = 0; k < keyframes[j].objects.length; k++) {

                                // Generate object refs from UUIDs

                                keyframes[j].objects[k].objref = getObjectByUUID(keyframes[j].objects[k].uuid);

                            }

                            if (keyframes[j].scenerot === undefined) {
                                keyframes[j].scenerot = {
                                    x: 0,
                                    y: 0,
                                    z: 0
                                };
                            }

                        }

                        tweening = importObject.tweening;

                        // Load settings

                        window.setTimeout(function() {
                            settings.importing = false; // Done importing

                            loadKeyframeFromPlayhead();
                        }, 50);
                    });

                });

            }

            function recursiveLoadBlankArmorstands(importBlankArmorstands, callback) {

                // A recursive function to load an array of blank armorstands, then runs a callback function when done loading all of them

                if (importBlankArmorstands === undefined || importBlankArmorstands.length === 0) {
                    callback();
                    return;
                }

                models.insert.blankArmorstand(function() {

                    var curBlankArmorstand = importBlankArmorstands[0];

                    blankArmorstands[blankArmorstands.length-1].rotation.y = curBlankArmorstand.rotation;

                    for (var i = 0; i < blankArmorstands[blankArmorstands.length-1].children.length; i++) {

                        blankArmorstands[blankArmorstands.length-1].children[i].children[0].rotation.z = curBlankArmorstand.partrotations[i].z;
                        blankArmorstands[blankArmorstands.length-1].children[i].children[0].children[0].rotation.y = curBlankArmorstand.partrotations[i].y;
                        blankArmorstands[blankArmorstands.length-1].children[i].children[0].children[0].children[0].rotation.x = curBlankArmorstand.partrotations[i].x;

                        blankArmorstands[blankArmorstands.length-1].children[i].children[0].children[0].children[0].children[0].uuid = curBlankArmorstand.partUUIDs[i];

                        if (curBlankArmorstand.partNames !== undefined) // To prevent errors with old projects
                            blankArmorstands[blankArmorstands.length-1].children[i].children[0].children[0].children[0].children[0].userData.name = curBlankArmorstand.partNames[i];

                    }

                    // Apply the stored NBT
                    blankArmorstands[blankArmorstands.length-1].userData.nbt = $.extend(true, {}, curBlankArmorstand.nbt);

                    // Select the new armorstand's torso in order to display the item previews for head and hand slots
                    for (var i = 0; i < objects.length; i++) {
                        objects[i].userData.selected = false;
                    }
                    blankArmorstands[blankArmorstands.length-1].children[1].children[0].children[0].children[0].children[0].userData.selected = true;
                    selectedobject = blankArmorstands[blankArmorstands.length-1].children[1].children[0].children[0].children[0].children[0];


                    // Item slot previews
                    displayBlankArmorstandSlotPreview(0, getItemIdFromNBT(blankArmorstands[blankArmorstands.length-1].userData.nbt.ArmorItems[3]), function() {
                        //models.resetModelAccumulate();
                        displayBlankArmorstandSlotPreview(2, getItemIdFromNBT(blankArmorstands[blankArmorstands.length-1].userData.nbt.HandItems[0]), function() {
                            //models.resetModelAccumulate();
                            displayBlankArmorstandSlotPreview(3, getItemIdFromNBT(blankArmorstands[blankArmorstands.length-1].userData.nbt.HandItems[1]), function() {
                                //models.resetModelAccumulate();

                                importBlankArmorstands.splice(0, 1);

                                recursiveLoadBlankArmorstands(importBlankArmorstands, callback);

                            });
                        });
                    });

                });

            }

            function loadObjFromProj(args, callback) {
                // Recursive function to load all objects in a project

                var importObject = args.importObject;

                var i = args.i;

                if (importObject.objects.length === 0) {
                    callback();
                    return;
                }

                models.createObj(importObject.objects[i].userData.rawid, {

                    importObj: importObject.objects[i]

                }, function(data) {

                    sceneWrapper.add(data.topparent);

                    // Don't add to objects arrays here because that has already been done in the createObj function

                    var retained = data.retain;

                    // data.topparent.position.copy(retained.importObj.position);

                    // data.obj.rotation.x = retained.importObj.rotation.x;
                    // data.obj.parent.rotation.y = retained.importObj.rotation.y;
                    // data.obj.parent.parent.rotation.z = retained.importObj.rotation.z;

                    data.obj.userData = retained.importObj.userData;
                    data.obj.userData.justAdded = true;

                    data.obj.uuid = retained.importObj.uuid;

                    // Load correct size
                    changeObjSize(data.obj, data.obj.userData.size);


                    editObject(false);

                    if (i >= importObject.objects.length-1) {
                        // Done

                        callback();

                    } else {

                        // Recursive

                        loadObjFromProj({

                            importObject: args.importObject,
                            i: i+1

                        }, callback);

                    }

                });
            }


            // Message boxes

            MessageBox = {
                red: function(text) {
                    $('#messagebox-red').html(text).parent().fadeIn(200);
                },
                green: function(text) {
                    $('#messagebox-green').html(text).parent().fadeIn(200);
                },
                yellow: function(text) {
                    $('#messagebox-yellow').html(text).parent().fadeIn(200);
                },
                blue: function(text) {
                    $('#messagebox-blue').html(text).parent().fadeIn(200);
                }
            }

            function QuestionBox(text, title, choice1, choice2, callback) {

                $('#questionbox').fadeIn(200);

                $('#questionbox-title').html(title);

                $('#questionbox-text').html(text);

                $('#questionbox-button-1').html(choice1);
                $('#questionbox-button-2').html(choice2);

                $('#questionbox-button-1').unbind('click').click(function() {
                    $('#questionbox').fadeOut(150);
                    callback(0);
                });

                $('#questionbox-button-2').unbind('click').click(function() {
                    $('#questionbox').fadeOut(150);
                    callback(1);
                });

            }

            // Clicking the x button in a messagebox
            $('.messagebox-close').click(function() {

                $(this).parent().fadeOut(200);

            });


            // Loading resource packs

            // Check for the various File API support.
            if (window.File && window.FileReader && window.FileList && window.Blob) {
                // Success! All of the File APIs are supported.

            } else {
                console.log('The File APIs are not fully supported in this browser.');
            }


            function handleFileSelect(evt) {
                var files = evt.target.files; // FileList object

                if (files.length === 0) {
                    return false;
                }

                for (var i = 0, f; f = files[i]; i++) {

                    // f is the current file

                    var reader = new FileReader();

                    // Onload function for the reader

                    reader.onload = (function (ev) {

                        return function(e) {

                            if (ev.name.indexOf('.json') >= 0) {
                                // Is a json file (could be blockstate or model; or could be something like a sounds file, but it won't do anything with it in that case)

                                models.addToIndex(e.target.result, ev.name);

                            } else if (ev.name.indexOf('.png') >= 0) {
                                // Is a png file which will be added to some kind of memory/storage in JS

                                // var storageElement = document.getElementById('rp-image-storage');

                                var newImageObj = new Image();
                                newImageObj.src = e.target.result;

                                // storageElement.appendChild(newImageElement);

                                // Add file name to the storage array so that it can be easily detected whether it was included in the resource pack or not
                                // when an object is added to the scene and textures are being loaded

                                models.customStorageJSON.textures[ev.webkitRelativePath.replace('.png', '').replace(/.+\/assets\/minecraft\/textures\//, '')] = {image: newImageObj, base64: e.target.result};

                            } else {

                                console.log(ev.name + ' not processed');

                            }

                        }

                    })(f);

                    // Read differently if file is a png
                    if (f.name.indexOf('.png') >= 0) {

                        reader.readAsDataURL(f);

                    } else {

                        reader.readAsText(f, "UTF-8");

                    }

                    reader.onerror = function (ev) {
                        MessageBox.red('There was an error loading that resource pack! Are you sure you selected the correct directory?');
                    }

                }
            }

            // Upload files button
            document.getElementById('options-load-rp-button').addEventListener('change', handleFileSelect, false);


            // Tooltips
            $('.hastooltip').mouseover(function() {
                // Mouse enter
                var tooltiptext = $(this).attr('tooltip');

                if (tooltiptext === undefined) {
                    return;
                }

                $('body').append('<div class="tooltip">' + tooltiptext + '</div>');
                var tooltipElement = $('.tooltip').last();

                var offset = $(this).offset();
                var size = {
                    width: $(this).width(),
                    height: $(this).height()
                }

                var tipPos = {
                    x: (offset.left + (size.width / 2)) - (tooltipElement.width() / 2),
                    y: offset.top - tooltipElement.height() - 10
                };

                tooltipElement.css('left', tipPos.x + 'px');
                tooltipElement.css('top', tipPos.y + 'px');

                tooltipElement.fadeIn(100);

                $(this).mouseleave(function() {
                    tooltipElement.fadeOut(100).remove();
                });
            });

            

            function randomString(length) {
                var charList = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_";

                var randString = "";
                var randomIndex = 0;

                for (var i = 0; i < length; i++) {

                    randomIndex = Math.floor(Math.random() * charList.length);
                    randString = randString + charList.substring(randomIndex, randomIndex + 1);

                }

                return randString;
            }

            // Item loader canvas
            var itemLoaderCanvas = document.getElementById('itemloader');
            var itemLoaderCtx = itemLoaderCanvas.getContext('2d');

            function componentToHex(c) {
                var hex = c.toString(16);
                return hex.length == 1 ? "0" + hex : hex;
            }

            function rgbToHex(r, g, b) {
                return componentToHex(r) + componentToHex(g) + componentToHex(b);
            }

            $('#manipulate-input-nbt').change(function() {

                var newInputNBT = $(this).val();

                selectedObject().userData.customnbt = newInputNBT;

            });

            $('#manipulate-input-item-nbt').change(function() {

                var newInputNBT = $(this).val();

                selectedObject().userData.customItemNBT = newInputNBT;

            });

            $('#selectedobj-animation-manipulation').click(function() {
                // Show the manipulation dialog box

                $('#manipulate').fadeIn(200);

                $('#manipulate-input-nbt').val(selectedObject().userData.customnbt);

            });

            // Raw commands
            $('#generate-settings-raw-commands').change(function() {
                if ($('#generate-settings-raw-commands').is(':checked')) {
                    $('#generate-section-output').html('');
                } else {
                    $('#generate-section-output').html('<textarea id="output-text" onclick="this.focus();this.select()" readonly></textarea>');
                }
                generateOutput();
            });

            $('#generate-cat-single').css('background-color', '#B7C8F7');

            // Single and reusable mode switching
            $('.generate-category').click(function() {
                settings.selected.mode = $(this).children('.generate-cat-text').html().toLowerCase();
                if (settings.selected.mode === 'single' && $('#animate-settings-enable').is(':checked')) {
                    settings.selected.mode = 'reusable';
                    return;
                }
                $('.generate-category').css('background-color', '#DEDEDE');
                $('.generate-category').not('#generate-cat-' + settings.selected.mode).hover(function() {
                    if ($(this).children('.generate-cat-text').html().toLowerCase() !== settings.selected.mode)
                        $(this).css('background-color', '#C1D9EA');
                }, function() {
                    if ($(this).children('.generate-cat-text').html().toLowerCase() !== settings.selected.mode)
                        $(this).css('background-color', '#DEDEDE');
                });
                $('#generate-cat-' + settings.selected.mode).css('background-color', '#B7C8F7');
                generateOutput();
                if (settings.selected.mode == 'reusable') {
                    $('#generate-settings-reusable').slideDown(150);
                    $('#generate-settings-single').slideUp(150);
                } else {
                    $('#generate-settings-reusable').slideUp(150);
                    $('#generate-settings-single').slideDown(150);
                }
            });

            // Object visibility toggle button
            $('#selectedobj-visible').click(function() {
                var curObj = selectedObject();
                curObj.userData.visible = false;

                setObjOpacity(curObj, 0.5);

                updateObjectAt({
                    uuid: curObj.uuid,
                    ontick: animatePlayhead.ontick,
                    objref: curObj
                }); // Update current object in current keyframe

                render(); // Force render

                // Object becomes invisible

                $(this).hide();
                $('#selectedobj-invisible').show();
            });

            $('#selectedobj-invisible').click(function() {
                var curObj = selectedObject();
                curObj.userData.visible = true;

                setObjOpacity(curObj, 1);

                updateObjectAt({
                    uuid: curObj.uuid,
                    ontick: animatePlayhead.ontick,
                    objref: curObj
                }); // Update current object in current keyframe

                render(); // Force render

                // Object becomes visible

                $(this).hide();
                $('#selectedobj-visible').show();
            });

            function setObjOpacity(object, opacity) {
                // Set the opacity of the object which is referenced by the first argument

                for (var i = 0; i < object.children.length; i++) {

                    // Don't affect rotation offset objects

                    if (object.children[i].material.materials !== undefined) {
                        // Has an array of materials inside the material

                        for (var j = 0; j < object.children[i].material.materials.length; j++) {

                            object.children[i].material.materials[j].opacity = opacity;

                        }

                    } else {

                        object.children[i].material.opacity = opacity;

                    }

                }
            }

            function updateObjectVisibility(objectref) {

                var curObj = objectref;

                if (curObj.userData.visible) {

                    // Setup for being visible

                    $('#selectedobj-visible').show();
                    $('#selectedobj-invisible').hide();

                    setObjOpacity(curObj, 1);

                } else {

                    // Setup for being invisible

                    $('#selectedobj-visible').hide();
                    $('#selectedobj-invisible').show();

                    setObjOpacity(curObj, 0.5);

                }

            }

            // Animating -> MOVED TO animate.js

            // Options

            $('#options-showaxislines').change(function() {
                if ($(this).is(':checked')) {
                    for (var i = 0; i < axisLines.length; i++) {
                        axisLines[i].visible = true;
                    }
                } else {
                    for (var i = 0; i < axisLines.length; i++) {
                        axisLines[i].visible = false;
                    }
                }
                window.requestAnimationFrame(render);
            });

            $('#options-showobjectlines').change(function() {
                if ($(this).is(':checked')) {
                    settings.showobjectlines = true;
                } else {
                    settings.showobjectlines = false;
                }
                updateObjectMoverLines();
            });

            // Shortcut keys

            // Temporarily hide control panel
            $(document).bind('keydown', 'ctrl+i', function(e) {
                e.preventDefault();
                $('#controlpanel').toggle();
            });

            // Delete object
            $(document).bind('keydown', 'del', function(e) {
                e.preventDefault();
                $('#selectedobj-remove').click();
            });

            $(document).bind('keydown', 'ctrl+d', function(e) {
                e.preventDefault();
                $('#selectedobj-duplicate').click();
            });

            // Size changing

            $('.selectedobj-sizechange').click(function() {
                $('.selectedobj-sizechange').css({
                    'border': '',
                    'border-radius': ''
                });

                $(this).css({
                    'border': '1px solid #8A8A8A',
                    'border-radius': '2px'
                });
            });

            // function updateObjectTranslation(obj) {

            //  if (obj.userData.translation === undefined) {
            //      obj.userData.translation = {x: 0, y:0, z:0};
            //  }

            // }

            function changeObjSize(obj, size) {

                // Change 'obj's size to 'size'

                if (size === 'small') {

                    var newScale = 0.28125;
                    obj.parent.parent.parent.parent.position.y += (newScale - obj.parent.scale.y) / 2;
                    obj.parent.scale.x = newScale;
                    obj.parent.scale.y = newScale;
                    obj.parent.scale.z = newScale;
                    obj.userData.size = 'small';
                    obj.parent.parent.parent.rotation.z = 0;
                    window.requestAnimationFrame(render);


                    // Update rotational center object
                    for (var i = 0; i < obj.parent.children.length; i++) {
                        // Change to selectedobject after it works
                        if (obj.parent.children[i].userData.isRotationOffset == true) {
                            obj.parent.children[i].position.y = -0.5 + (-1.25 / 16);

                            if (obj.userData.isItem) {
                                obj.parent.children[i].position.y -= (12 / 16);
                            }
                        }
                    }

                    updateObjectMoverLines();

                } else if (size === 'medium') {

                    var newScale = 0.4375;
                    obj.parent.parent.parent.parent.position.y += (newScale - obj.parent.scale.y) / 2;
                    obj.parent.scale.x = newScale;
                    obj.parent.scale.y = newScale;
                    obj.parent.scale.z = newScale;
                    obj.userData.size = 'medium';
                    window.requestAnimationFrame(render);

                    // Update rotational center object
                    for (var i = 0; i < obj.parent.children.length; i++) {
                        // Change to selectedobject after it works
                        if (obj.parent.children[i].userData.isRotationOffset == true) {
                            obj.parent.children[i].position.y = -0.5 + (1.6 / 16);

                            if (obj.userData.isItem) {
                                obj.parent.children[i].position.y -= (12 / 16);
                            }
                        }
                    }

                    updateObjectMoverLines();

                } else if (size === 'large') {

                    var newScale = 0.625;
                    obj.parent.parent.parent.parent.position.y += (newScale - obj.parent.scale.y) / 2;
                    obj.parent.scale.x = newScale;
                    obj.parent.scale.y = newScale;
                    obj.parent.scale.z = newScale;
                    obj.userData.size = 'large';
                    window.requestAnimationFrame(render);

                    // Update rotational center object
                    for (var i = 0; i < obj.parent.children.length; i++) {
                        // Change to selectedobject after it works
                        if (obj.parent.children[i].userData.isRotationOffset == true) {
                            obj.parent.children[i].position.y = -0.5 + (1.6 / 16);

                            if (obj.userData.isItem) {
                                obj.parent.children[i].position.y -= (12 / 16);
                            }
                        }
                    }

                    updateObjectMoverLines();

                } else if (size === 'solid') {

                    var newScale = 1;
                    obj.parent.parent.parent.parent.position.y += (newScale - obj.parent.scale.y) / 2;
                    obj.parent.scale.x = newScale;
                    obj.parent.scale.y = newScale;
                    obj.parent.scale.z = newScale;
                    obj.parent.rotation.x = 0;
                    // Double check to make sure that the following 3 lines actually need the ".parent" parts
                    obj.parent.parent.rotation.y = 0;
                    obj.parent.parent.parent.rotation.z = 0;
                    obj.userData.size = 'solid';
                    window.requestAnimationFrame(render);

                    // Doesn't need rotation center object moved since it can't rotate

                    updateObjectMoverLines();

                }

                console.log(obj.userData.name + '\'s size has been changed to: ' + size);

                // updateObjectTranslation(obj); // Update the translation to fit along with the new scale (only matters on custom models)

            }

            $('#selectedobj-small').click(function() {
                // Make selected object small

                var curObj = selectedObject();

                changeObjSize(curObj, 'small');

                $('.selectedobj-properties-rotation').show();
                $('#z-rotation-input').css('display', 'none');
                updatePosChanger();

                updateObjectAt({
                    uuid: curObj.uuid,
                    ontick: animatePlayhead.ontick,
                    objref: curObj
                });

            });

            $('#selectedobj-medium').click(function() {
                // Make selected object medium

                var curObj = selectedObject();

                changeObjSize(curObj, 'medium');

                $('.selectedobj-properties-rotation').show();
                $('#z-rotation-input').css('display', 'block');
                updatePosChanger();

                updateObjectAt({
                    uuid: curObj.uuid,
                    ontick: animatePlayhead.ontick,
                    objref: curObj
                });
                
            });

            $('#selectedobj-large').click(function() {
                // Make selected object large

                var curObj = selectedObject();

                changeObjSize(curObj, 'large');

                $('.selectedobj-properties-rotation').show();
                $('#z-rotation-input').css('display', 'block');
                updatePosChanger();

                updateObjectAt({
                    uuid: curObj.uuid,
                    ontick: animatePlayhead.ontick,
                    objref: curObj
                });
                
            });

            $('#selectedobj-solid').click(function() {
                // Make selected object solid

                var curObj = selectedObject();

                changeObjSize(curObj, 'solid');

                $('.selectedobj-properties-rotation').hide();
                $('#z-rotation-input').css('display', 'block');
                updatePosChanger();

                updateObjectAt({
                    uuid: curObj.uuid,
                    ontick: animatePlayhead.ontick,
                    objref: curObj
                });
                
            });

            function updateRotators(size) {

                $('.selectedobj-properties-rotation').show();

                if (size === 'small') {
                    $('#z-rotation-input').css('display', 'none');
                } else if (size === 'medium' || size === 'large') {
                    $('#z-rotation-input').css('display', 'block');
                } else if (size === 'solid') {
                    $('.selectedobj-properties-rotation').hide();
                }
            }

            // Selected object rotation

            var pi = Math.PI;

            $('.selectedobj-rotation-x').on('input', function() {
                if ($(this).val() === '')
                    return;

                var thisExact = $(this);
                $('.selectedobj-rotation-x').each(function() {
                    if ($(this).val() != thisExact.val())
                        $(this).val(thisExact.val());
                });
                selectedobject.parent.rotation.x = eval($(this).val()) * (pi/180);
                window.requestAnimationFrame(render);
            });

            $('.selectedobj-rotation-y').on('input', function() {
                if ($(this).val() === '')
                    return;
                var thisExact = $(this);
                $('.selectedobj-rotation-y').each(function() {
                    if ($(this).val() != thisExact.val())
                        $(this).val(thisExact.val());
                });
                var selectedObj = selectedobject;
                if (selectedObj.userData.rawid.indexOf('armorstand_') > -1) {
                    // The user is selecting part of an armorstand, so the Y and Z rotations should be negated
                    selectedObj.parent.parent.rotation.y = -eval($(this).val()) * (pi/180);
                } else {
                    selectedObj.parent.parent.rotation.y = -eval($(this).val()) * (pi/180);
                }
                window.requestAnimationFrame(render);
            });

            $('.selectedobj-rotation-z').on('input', function() {
                if ($(this).val() === '')
                    return;
                var thisExact = $(this);
                $('.selectedobj-rotation-z').each(function() {
                    if ($(this).val() != thisExact.val())
                        $(this).val(thisExact.val());
                });
                var selectedObj = selectedobject;
                if (selectedObj.userData.rawid.indexOf('armorstand_') > -1) {
                    // The user is selecting part of an armorstand, so the Y and Z rotations should be negated
                    selectedObj.parent.parent.parent.rotation.z = -eval($(this).val()) * (pi/180);
                } else {
                    selectedObj.parent.parent.parent.rotation.z = -eval($(this).val()) * (pi/180);
                }
                window.requestAnimationFrame(render);
            });

            // Whole-body armorstand rotation input
            $('#selectedobj-armorstand-bodyrotation').on('input', function() {
                selectedobject.parent.parent.parent.parent.parent.rotation.y = eval($(this).val()) * (pi / 180);
                window.requestAnimationFrame(render);
            });

            // Round to nearest multiple
            function roundToMultiple(number, multipleof) {
                return Math.round(number / multipleof) * multipleof;
            }

            // Generate the output

            // Modes for generating the output

            function generateOutput() {

                // Secretly force 'animation enabled' if an attached entity is specified
                var attachEntity = $('#generate-settings-reusable-attach').val();

                var originalAnimateEnable = $('#animate-settings-enable-2').is(':checked');

                if (attachEntity.length > 0) {
                    // Force animation enabled

                    $('.animate-settings-enable').prop('checked', true);

                }

                removeDuplicateKeyframes(); // Removes all duplicate keyframes before even starting to generate anything

                // Remove instance command
                var removeInstanceCmd = 'execute @e[type=armor_stand,name=' + settings.uniquestring + '_M] ~ ~ ~ kill @e[tag=' + settings.uniquestring + ',c=' + (objects.length + 1) + ']'; // Must add 1 to the objects.length because it also includes the _M armorstand

                $('.generate-settings-remove-command').val(removeInstanceCmd);

                if ($('#generate').is(':visible') === false) {

                    return;

                    // Don't waste time generating if the generate dialog box is not open
                    // When the generate dialog box launcher button is pressed, the generate dialogbox should become visible before this function runs
                }

                var firstKeyframe = 0;

                for (var i = 0; i < keyframes.length; i++) {

                    if (keyframes[i].ontick === 0) {

                        firstKeyframe = i;

                    }

                }

                if ($('#generate-settings-reusable-multidirectional').is(':checked') === false && ($('#options-rotation-x').val() != '0' || $('#options-rotation-y').val() != '0' || $('#options-rotation-z').val() != '0')) {

                    scene.updateMatrixWorld();
                    sceneWrapper.updateMatrixWorld();

                    // Update keyframes[0] with new rotation

                    var sceneWrapperBeforeRot = {
                        x: sceneWrapper.rotation.x,
                        y: sceneWrapper.rotation.y,
                        z: sceneWrapper.rotation.z
                    }

                    animatePlayhead.ontick = 0;
                    loadKeyframeFromPlayhead();

                    sceneWrapper.rotation.set(sceneWrapperBeforeRot.x, sceneWrapperBeforeRot.y, sceneWrapperBeforeRot.z);

                    // Has to set the rotation each time a keyframe is loaded since keyframes can have their own sceneWrapper rotation values

                    for (var k = 0; k < objects.length; k++) {
                        objects[k].updateMatrixWorld();
                        objects[k].parent.parent.parent.parent.updateMatrixWorld();
                    }

                    updateSceneWrapperRotation();

                    saveKeyframeObjectPositions();

                    for (var k = 0; k < keyframes[firstKeyframe].objects.length; k++) {

                        var curObj = getObjectByUUID(keyframes[firstKeyframe].objects[k].uuid);

                        keyframes[firstKeyframe].objects[k].position = {
                            x: parseFloat(parseFloat(curObj.parent.parent.parent.parent.position.x).toFixed(7)),
                            y: parseFloat(parseFloat(curObj.parent.parent.parent.parent.position.y).toFixed(7)),
                            z: parseFloat(parseFloat(curObj.parent.parent.parent.parent.position.z).toFixed(7))
                        }

                        keyframes[firstKeyframe].objects[k].rotation = {
                            x: curObj.parent.rotation.x,
                            y: curObj.parent.parent.rotation.y,
                            z: curObj.parent.parent.parent.rotation.z
                        }

                        keyframes[firstKeyframe].objects[k].forcerotated = true;

                    }

                    resetSceneWrapperRotation();

                }

                // Trigger global animation command
                $('#generate-settings-reusable-trigger-animation').val('scoreboard players set @e[type=armor_stand,name=' + settings.uniquestring + '_M] ' + settings.uniquestring + ' 2');

                armorStands = [];
                var amountX, amountY, amountZ;
                for (var o = 0; o < objects.length; o++) {

                    if (objects[o].userData.rawid.indexOf('armorstand_') > -1 || objects[o].parent.parent.parent.parent.userData.blankArmorstandPreviewSlot) {
                        continue;
                    }

                    if (getPosAtKeyframe(objects[o].uuid, 0) === undefined) {
                        objects[o].justAdded = true;
                        models.updateKeyframesAfterAddObj();
                    }

                    var curArmorstandPos = getPosAtKeyframe(objects[o].uuid, 0);
                    var curArmorstandRot = getRotAtKeyframe(objects[o].uuid, 0);

                    armorStands[armorStands.length] = {
                        x: curArmorstandPos.x + settings.offset.x,
                        y: fixFloat(curArmorstandPos.y - ((1 - objects[o].parent.scale.y) / 2) - ((1.25 / 16) * objects[o].parent.scale.y)) + settings.offset.y - 0.02,
                        z: curArmorstandPos.z + settings.offset.z,
                        rotation: {
                            x: curArmorstandRot.x,
                            y: curArmorstandRot.y,
                            z: curArmorstandRot.z
                        },
                        block: objects[o].userData.blockid,
                        extraNBT: '',
                        itemNBTLoc: ',ArmorItems:[{},{},{},{Count:1b,*^}]',
                        entity: 'armor_stand',
                        pose: '',
                        solid: false,
                        objuuid: objects[o].uuid,
                        customnbt: objects[o].userData.customnbt,
                        solidblock: {
                            id: objects[o].userData.blockid.replace('id:', '').replace(/,Damage:[0-9]+/, ''),
                            damage: objects[o].userData.blockid.replace(/id:[a-zA-Z_]+/, '').replace(',Damage:', ''),
                        }
                    }

                    var customItemNBT = objects[o].userData.customItemNBT;
                    if (customItemNBT === undefined)
                        customItemNBT = '';

                    if (customItemNBT.length > 0) {

                        if (customItemNBT.substring(0, 1) === '{') {
                            customItemNBT = customItemNBT.substring(1, customItemNBT.length-1);
                        }

                        armorStands[armorStands.length-1].itemNBTLoc = armorStands[armorStands.length-1].itemNBTLoc.replace('^', ',' + customItemNBT);
                    } else {
                        armorStands[armorStands.length-1].itemNBTLoc = armorStands[armorStands.length-1].itemNBTLoc.replace('^', '');
                    }

                    

                    for (var i = 0; i < itemDurs.length; i++) {
                        if (armorStands[armorStands.length-1].block.indexOf(itemDurs[i].name) >= 0) {
                            armorStands[armorStands.length-1].block += ',tag:{Unbreakable:1}';
                        }
                    }

                    objects[o].userData.armorStandRef = armorStands[armorStands.length-1]; // Save the newly created object in the armorStands array as a reference in the object,
                    // so that you can now access this armorstand object from an object in a keyframe w/ keyframes[#].objects[#].objref.userData.armorStandRef

                    armorStands[armorStands.length-1].customname = objects[o].userData.customname;

                    if (objects[o].userData.size == 'large') {
                        armorStands[armorStands.length-1].y -= 1.56;
                    }
                    if (objects[o].userData.size == 'medium') {
                        armorStands[armorStands.length-1].extraNBT += 'Small:1b,';
                        armorStands[armorStands.length-1].y -= 0.66;
                    }
                    if (objects[o].userData.size == 'small') {
                        armorStands[armorStands.length-1].itemNBTLoc = ',ArmorItems:[{},{},{},{*,Count:1b}]';
                        armorStands[armorStands.length-1].entity = 'villager';
                        armorStands[armorStands.length-1].extraNBT += 'Age:-1000000,';

                        armorStands[armorStands.length-1].y -= 0.5075;

                        // armorStands[armorStands.length-1].rotation.y = armorStands[armorStands.length-1].rotation.y// * (75 / (armorStands[armorStands.length-1].rotation.y / (pi / 180))); // This is needed because of the bug with baby villagers riding armor stands

                        // 'Small' blocks need to have a completely different method for calculating position
                        // THANKS, MOJANG! :( - https://www.reddit.com/r/Minecraft/comments/3zo2eo/why_are_my_blocks_on_baby_villager_heads_not/
                        // Update *instead of snapping to some weird unnecessary grid, I just made small objects 0.28125 (a multiple of 0.03125, which is 1/32) blocks wide in this
                    }
                    if (objects[o].userData.size == 'solid') {
                        armorStands[armorStands.length-1].solid = true;
                    }

                    if (armorStands[armorStands.length-1].entity == 'armor_stand') {
                        armorStands[armorStands.length-1].extraNBT += 'DisabledSlots:4096,Invisible:1b,NoGravity:1b,';
                    }
                    if (armorStands[armorStands.length-1].entity == 'villager') {
                        armorStands[armorStands.length-1].extraNBT += 'NoGravity:1b,Team:noCol' + settings.uniquestring + ',Invulnerable:1,NoAI:1,Silent:1,ActiveEffects:[{Id:14,Duration:9999999,ShowParticles:false}],';
                    }
 

                    if (settings.relPos === '~') {

                        if (settings.selected.mode == 'single') {
						//weird orignal offset of -3 changed to += 0.7425 to make output y 0
                            armorStands[armorStands.length-1].y += 0.7425;
                        }
                        if (settings.selected.mode == 'reusable') {
                            armorStands[armorStands.length-1].y += 0.0625;
                        }

                    }

                    armorStands[armorStands.length-1].armorstandOnlyNBT = '';

                    if ($('#generate-settings-reusable-multidirectional').is(':checked')) {
                     var extraTagDir = ',"AM_d1"';
                    } else {
                     var extraTagDir = '';
                    }

                    if ($('#animate-settings-enable').is(':checked') || $('#generate-settings-reusable-multidirectional').is(':checked')) {
                        if (armorStands[armorStands.length-1].entity === 'villager') {

                            // armorStands[armorStands.length-1].armorstandOnlyNBT += ',CustomName:' + objects[o].userData.customname;
                            // armorStands[armorStands.length-1].armorstandOnlyNBT += ',Tags:["' + settings.uniquestring + '"' + extraTagDir + ']';
                            armorStands[armorStands.length-1].extraNBT += 'CustomName:"' + objects[o].userData.customname + '",';
                            armorStands[armorStands.length-1].extraNBT += 'Tags:["' + settings.uniquestring + '"],'; // also give it to the villager for rotatin

                        } else {

                            // Not a villager

                            armorStands[armorStands.length-1].extraNBT += 'CustomName:"' + objects[o].userData.customname + '",';
                            armorStands[armorStands.length-1].extraNBT += 'Tags:["' + settings.uniquestring + '"],';

                        }
                    }

                    armorStands[armorStands.length-1].rawY = armorStands[armorStands.length-1].y; // Save the current Y position before the rotation offset is applied, so that it can be used for animations

                    // Rotation
                    if (armorStands[armorStands.length-1].rotation.x != 0 || armorStands[armorStands.length-1].rotation.y != 0 || armorStands[armorStands.length-1].rotation.z != 0) {
                        var thisRotation = {
                            x: fixFloat(armorStands[armorStands.length-1].rotation.x / (pi/180)),
                            y: fixFloat(armorStands[armorStands.length-1].rotation.y / (pi/180)),
                            z: fixFloat(armorStands[armorStands.length-1].rotation.z / (pi/180))
                        }

                        if (armorStands[armorStands.length-1].entity == 'villager') {
                            armorStands[armorStands.length-1].extraNBT += 'Rotation:[' + -thisRotation.y + 'f,' + thisRotation.x + 'f],';
                        } else {
                            armorStands[armorStands.length-1].pose += ',Head:[' + Math.floor(thisRotation.x) + 'f,' + -(Math.floor(thisRotation.y)) + 'f,' + -Math.floor(thisRotation.z) + 'f]';
                        }
                    }

                    // Moving the armorstand slightly so that the rotation center in minecraft is actually in the center of the block; not the wierd place it is normally

                    var thisRotationOffset;

                    for (var i = 0; i < objects[o].parent.children.length; i++) {
                        if (objects[o].parent.children[i].userData.isRotationOffset == true) {
                            thisRotationOffset = objects[o].parent.children[i];

                            if (objects[o].userData.size === 'small') {
                            	var previousSmallYRot = objects[o].parent.parent.rotation.y;
                            	objects[o].parent.parent.rotation.y = objects[o].parent.parent.rotation.y;
                            	objects[o].updateMatrixWorld();
                            	objects[o].parent.parent.updateMatrixWorld();
                            	scene.updateMatrixWorld();
                            	sceneWrapper.updateMatrixWorld();
                            }
                        }
                    }

                    var getOffsets = getRotOffset({
                        x: objects[o].parent.parent.parent.parent.position.x,
                        y: objects[o].parent.parent.parent.parent.position.y,
                        z: objects[o].parent.parent.parent.parent.position.z,
                        size: objects[o].parent.scale.y
                    }, thisRotationOffset);

                    if (objects[o].userData.size === 'small') {
                    	objects[o].parent.parent.rotation.y = previousSmallYRot; // Restore y rot if small
                    }

                    armorStands[armorStands.length-1].x += getOffsets.x;
                    armorStands[armorStands.length-1].y += getOffsets.y;
                    armorStands[armorStands.length-1].z += getOffsets.z;

                    // End of rotation center adjustments

                    // Y axis goes down -1.875 if being placed by a command block, or
                    // -1.425 if placed by a minecart command block

                    // The 'block' will be similar to 'id:stone', or 'id:dirt,Damage:2', etc..

                    if (armorStands[armorStands.length-1].pose.length > 0) {
                        armorStands[armorStands.length-1].pose = ('Pose:{' + armorStands[armorStands.length-1].pose + '},').replace('{,', '{');
                    }
                    
                }

                // Blank armorstand generation

                for (var i = 0; i < blankArmorstands.length; i++) {

                    armorStands[armorStands.length] = {
                        x: blankArmorstands[i].position.x + settings.offset.x,
                        y: fixFloat(blankArmorstands[i].position.y + settings.offset.y) - 0.07,
                        z: blankArmorstands[i].position.z + settings.offset.z,
                        rotation: {
                            x: 1,
                            y: 2,
                            z: 3
                        },
                        isBlankArmorstand: true,
                        block: null,
                        itemNBTLoc: '',
                        extraNBT: '',
                        entity: 'armor_stand',
                        pose: '',
                        solid: false,
                        objuuid: blankArmorstands[i].uuid,
                        customnbt: '',
                        solidblock: {
                            id: '',
                            damage: '',
                        }
                    };

                    if (settings.relPos === '~') {

                        if (settings.selected.mode == 'single') {
                            armorStands[armorStands.length-1].y -= 3;
                        }
                        if (settings.selected.mode == 'reusable') {
                            armorStands[armorStands.length-1].y += 0.0625;
                        }

                    }

                    // Armorstand options

                    armorStands[armorStands.length-1].extraNBT += ',Tags:["' + settings.uniquestring + '"]';

                    var wholeArmorstandRot = parseFloat((blankArmorstands[i].rotation.y / (pi / 180)).toFixed(5));
                    if (wholeArmorstandRot !== 0) {
                        armorStands[armorStands.length-1].extraNBT += ',Rotation:[' + wholeArmorstandRot + 'f]';
                    }

                    var equipmentAltered = false; // Only include HandItems and ArmorItems if one of the parts have been altered by the user

                    for (var key in blankArmorstands[i].userData.nbt) {

                        if (blankArmorstands[i].userData.nbt[key] === true) {
                            armorStands[armorStands.length-1].extraNBT += ',' + key + ':1';
                        }

                        if (key == 'CustomName') {
                            // Add the CustomName tag to blank armorstands
                            armorStands[armorStands.length-1].extraNBT += ',' + key + ':"' + blankArmorstands[i].userData.nbt[key] + '"';
                        }

                        if (key === 'ArmorItems' || key === 'HandItems' ) {

                            equipmentAltered = false;

                            for (var j = 0; j < blankArmorstands[i].userData.nbt[key].length; j++) {

                                if (blankArmorstands[i].userData.nbt[key][j] !== '{}' && blankArmorstands[i].userData.nbt[key][j] !== '') {
                                    equipmentAltered = true;
                                }

                            }

                            if (equipmentAltered) {

                                armorStands[armorStands.length-1].extraNBT += ',' + key + ':[';

                                for (var j = 0; j < blankArmorstands[i].userData.nbt[key].length; j++) {
                                    armorStands[armorStands.length-1].extraNBT += blankArmorstands[i].userData.nbt[key][j];

                                    if (j < blankArmorstands[i].userData.nbt[key].length - 1) {
                                        armorStands[armorStands.length-1].extraNBT += ',';
                                    }
                                }

                                armorStands[armorStands.length-1].extraNBT += ']';

                            }
                        }

                    }

                    armorStands[armorStands.length-1].extraNBT = armorStands[armorStands.length-1].extraNBT.replace(',', '');

                    // Armorstand parts rotations
                    var curArmorstandPart = '';
                    var leftOrRightArm = 'Right';
                    var leftOrRightLeg = 'Right';

                    for (var j = 0; j < blankArmorstands[i].children.length; j++) {
                        switch (blankArmorstands[i].children[j].children[0].children[0].children[0].children[0].userData.rawid) {
                            case 'armorstand_neck':
                                curArmorstandPart = 'Head';
                                break;
                            case 'armorstand_torso':
                                curArmorstandPart = 'Body';
                                break;
                            case 'armorstand_arm':
                                curArmorstandPart = leftOrRightArm + 'Arm';
                                leftOrRightArm = 'Left'; // This makes it so that the second time this runs, it will be the RightArm
                                break;
                            case 'armorstand_leg':
                                curArmorstandPart = leftOrRightLeg + 'Leg';
                                leftOrRightLeg = 'Left'; // This makes it so that the second time this runs, it will be the RightLeg
                                break;
                        }

                        // Setup the armorStand[] reference in each child of the blank armorstand
                        blankArmorstands[i].children[j].children[0].children[0].children[0].children[0].userData.armorStandRef = armorStands[armorStands.length-1];

                        if (parseFloat((blankArmorstands[i].children[j].children[0].children[0].children[0].rotation.x / (pi / 180)).toFixed(5)) + ',' + (-(parseFloat((blankArmorstands[i].children[j].children[0].children[0].rotation.y / (pi / 180)).toFixed(5)))) + ',' + (-parseFloat((blankArmorstands[i].children[j].children[0].rotation.z / (pi / 180)).toFixed(5))) !== '0,0,0' || curArmorstandPart === 'LeftArm' || curArmorstandPart === 'RightArm') {
                            // Only add to the Pose:{} tag if any of the values are different that default (0)
                            armorStands[armorStands.length-1].pose += ',' + curArmorstandPart + ':[' + parseFloat((blankArmorstands[i].children[j].children[0].children[0].children[0].rotation.x / (pi / 180)).toFixed(5)) + 'f,' + (-(parseFloat((blankArmorstands[i].children[j].children[0].children[0].rotation.y / (pi / 180)).toFixed(5)))) + 'f,' + (-parseFloat((blankArmorstands[i].children[j].children[0].rotation.z / (pi / 180)).toFixed(5))) + 'f]';
                        }

                    }

                    // Remove first comma from the .pose property and encase it in the "Pose:{}" tag
                    if (armorStands[armorStands.length-1].pose.length > 0) {
                        armorStands[armorStands.length-1].pose = ('Pose:{' + armorStands[armorStands.length-1].pose + '},').replace('{,', '{');
                    }

                }

                var output;

                switch (settings.selected.mode) {
                    case 'single':
                        output = createFinalCommandSingle(armorStands);
                        break;
                    case 'reusable':
                        output = createFinalCommandReusable(armorStands);
                        break;
                }

                if ($('#generate-settings-reusable-multidirectional').is(':checked') === false && ($('#options-rotation-x').val() != '0' || $('#options-rotation-y').val() != '0' || $('#options-rotation-z').val() != '0')) {

                    resetSceneWrapperRotation(); // Might (most likely) doesn't need this any more

                    restoreKeyframeObjectPositions();
                }

                if (output.length == 0) {
                    $('#generate-section-output').html('<div class="alert-yellow">You have not added any objects to this model yet! Type a block id into the "Block/item id" box and click "Add" to start!</div>');
                } else {
                    if (typeof output == 'string') {
                        // Clean up the output command
                        output = output.replace(/ ~([0-9]+) /g, ' ~$1.0 ');

                        $('#generate-section-output').html('<textarea id="output-text" onclick="this.focus();this.select()" readonly=""></textarea>');
                        $('#output-text').val(output);
                    } else {
                        $('#generate-section-output').html('<div id="output-raw-info">These commands must be exceuted in the same command block or execute a ShowFile - If executing in a command block with Showfile make sure under options, CommandBlockPosition is set  <br><input type="checkbox" id="output-raw-single-box" style="margin-top:8px"> <label for="output-raw-single-box">Format for <a target="_blank">ShowFile - YAML</a></label></div>');

                        $('#output-raw-single-box').unbind('change');
                        $('#output-raw-single-box').change(function() {
                            if ($(this).is(':checked')) {
                                settings.formatforcmdcombiner = true;
                            } else {
                                settings.formatforcmdcombiner = false;
                            }
                            generateOutput();
                            $('#output-raw-single-box').prop('checked', settings.formatforcmdcombiner);
                        });

                        var formatForCmdCombiner = settings.formatforcmdcombiner;
                        if (formatForCmdCombiner) {
                            $('#generate-section-output').append('<textarea id="output-text" onclick="this.focus();this.select()" readonly=""></textarea>');
                        }
                        var formatForCmdCombinerText = '';
                        for (var i = 0; i < output.length; i++) {
                            output[i] = output[i].replace(/ ~([0-9]) /g, ' ~$1.0 ');
                            if (formatForCmdCombiner) {
                                formatForCmdCombinerText += 'time:'+ i*5 + '\n' + "  - item: 'cmd'\n" + '    cmd: ' + output[i] + '\n';
                            } else {
                                $('#generate-section-output').append('<textarea class="output-text" onclick="this.focus();this.select()" readonly=""></textarea>');
                                $('.output-text').last().val(output[i]);

                                // Make every other one slightly darker
                                if ((i+1) % 2 == 0) {
                                    $('.output-text').last().css('background-color', '#EAEAEA');
                                }
                            }
                        }
                        if (formatForCmdCombiner) {
                            $('#output-text').val(formatForCmdCombinerText.substring(0, formatForCmdCombinerText.length - 1));
                        }
                    }

                    if ($('#output-text').val() !== undefined) {

                        var outputStringLength = $('#output-text').val().length;

                        if (outputStringLength > 32500) {
                            // The command is too long to fit in a single command block. Prompt the user to use the command combiner to split the command

                            MessageBox.blue("The command is " + (outputStringLength - 32500) + " characters over the command block's character limit. <div id='command-combiner-auto-button'>Click here to use the command combiner generator to automatically split the command for you</div>You must have pop-ups enabled for this page in order to use the button above.");

                            $('#command-combiner-auto-button').click(function() {
                                openInCommandCombiner();
                            });

                        }

                    }

                    console.log('Done displaying output text');
                }

                // Reset the value of 'enable animation' to false if that's what it originally was

                $('.animate-settings-enable').prop('checked', originalAnimateEnable);
            }

            function getRotOffset(object, rotationcenter) {
                // This is as close as it can get, thanks to minecrafts annoying 1/32 entity grid limitation
                var rotationOffset = object.size / 2.54;

                // Get rotation offset tracker's position, relative to the center of the actual object

                var rotVector = new THREE.Vector3();
                rotVector.setFromMatrixPosition(rotationcenter.matrixWorld);

                var rotPos = {
                    x: rotVector.x - object.x,
                    y: rotVector.y - (object.y - (object.size / 2)),
                    z: rotVector.z - object.z,
                }

                var amountX = parseFloat(rotPos.x.toFixed(6));

                var amountY = parseFloat(rotPos.y.toFixed(6));

                var amountZ = parseFloat(rotPos.z.toFixed(6));

                return {
                    x: amountX,
                    y: amountY,
                    z: amountZ
                }
            }

            Math.radians = function(degrees) {
                return degrees * Math.PI / 180;
            };

            function createFinalCommandSingle(armorStands) {

                if (armorStands.length == 0) {
                    return '';
                }

                var useRawCommands = $('#generate-settings-raw-commands').is(':checked');
                
                var rawCommands = [];
                var initCmdString = '';

                var useHardMovement = $('#animate-settings-hardtp').is(':checked');

                var needsNoColTeam = false;

                for (var i = 0; i < objects.length; i++) {

                	if (objects[i].userData.size === 'small') {
                		needsNoColTeam = true;
                	}

                }

                if (needsNoColTeam) {
                	if (useRawCommands) {
                		rawCommands[rawCommands.length] = 'scoreboard teams add noCol' + settings.uniquestring;
                		rawCommands[rawCommands.length] = 'scoreboard teams option noCol' + settings.uniquestring + ' collisionRule never';
                	} else {
                		initCmdString += ',{id:commandblock_minecart,Command:"scoreboard teams add noCol' + settings.uniquestring + '"}';
                		initCmdString += ',{id:commandblock_minecart,Command:"scoreboard teams option noCol' + settings.uniquestring + ' collisionRule never"}';
                	}
                }

                // Doesn't need to check if animations are enabled because if they are, then the 'reusable' mode should be forced

                for (i = 0; i < armorStands.length; i++) {

                    var customnbt = armorStands[i].customnbt;
					
                    if (customnbt.length > 0) {
                        customnbt += ',';
                    }

                    if (armorStands[i].solid) {
                        if (useRawCommands) {
                            // Raw commands
                            rawCommands[rawCommands.length] = 'setblock ' + settings.relPos + Math.floor(armorStands[i].x) + ' ' + settings.relPos + Math.floor(fixFloat(armorStands[i].y)) + ' ' + settings.relPos + Math.floor(armorStands[i].z) + ' ' + armorStands[i].solidblock.id + ' ' + armorStands[i].solidblock.damage;
                        } else {
                            // Compacted command
                            initCmdString = initCmdString + ',{id:commandblock_minecart,Command:"' +  escapeQuotes('setblock ' + settings.relPos + Math.floor(armorStands[i].x) + ' ' + settings.relPos + Math.floor(fixFloat(armorStands[i].y)) + ' ' + settings.relPos + Math.floor(armorStands[i].z) + ' ' + armorStands[i].solidblock.id + ' ' + armorStands[i].solidblock.damage) + '"}';
                        }
                    } else {
                        if (!useHardMovement) {

                            // The armorstands only need to be summoned initially if hard movement is off
                            // If hard movement is enabled, then the armorstands will be resummoned every tick, so there is no need for initial summoning

                            if (useRawCommands) {
                                rawCommands[rawCommands.length] ='summon ' + armorStands[i].entity + ' ' + settings.relPos + armorStands[i].x + ' ' + settings.relPos + fixFloat(armorStands[i].y) + ' ' + settings.relPos + armorStands[i].z + ' {' + customnbt + armorStands[i].pose + (armorStands[i].extraNBT + armorStands[i].itemNBTLoc.replace(/\*/g, armorStands[i].block)).replace(/,,/g, ',') + '}';
                            } else {
                                initCmdString = initCmdString + ',{id:commandblock_minecart,Command:"' + escapeQuotes('summon ' + armorStands[i].entity + ' ' + settings.relPos + armorStands[i].x + ' ' + settings.relPos + fixFloat(armorStands[i].y) + ' ' + settings.relPos + armorStands[i].z + ' {' + customnbt + armorStands[i].pose + (armorStands[i].extraNBT + armorStands[i].itemNBTLoc.replace(/\*/g, armorStands[i].block)).replace(/,,/g, ',') + '}') + '"}';
                            }

                        }
                    }
                }

                if (useRawCommands) {
                    return rawCommands;
                } else {
                    var outputCommand = 'summon falling_block ~ ~1 ~ {Block:stone,Time:1,Passengers:[{id:falling_block,Block:redstone_block,Time:1,Passengers:[{id:falling_block,Block:activator_rail,Time:1,Passengers:[{id:commandblock_minecart,Command:"gamerule commandBlockOutput false"}' + initCmdString + ',{id:commandblock_minecart,Command:"setblock ~ ~ ~1 command_block 0 replace {Command:\\"fill ~ ~-3 ~-1 ~ ~ ~ air\\"}"},{id:commandblock_minecart,Command:"setblock ~ ~-1 ~1 redstone_block"},{id:commandblock_minecart,Command:"kill @e[type=commandblock_minecart,r=1]"}]}]}]}';

                    return outputCommand;
                }
            }

            $('.settings-inputchange').change(function() {
                generateOutput();
            });

            function saveKeyframeObjectPositions() {

                for (var i = 0; i < keyframes.length; i++) {

                    for (var j = 0; j < keyframes[i].objects.length; j++) {

                        keyframes[i].objects[j].oldpos = {
                            x: keyframes[i].objects[j].position.x,
                            y: keyframes[i].objects[j].position.y,
                            z: keyframes[i].objects[j].position.z
                        }

                        keyframes[i].objects[j].oldrot = {
                            x: keyframes[i].objects[j].rotation.x,
                            y: keyframes[i].objects[j].rotation.y,
                            z: keyframes[i].objects[j].rotation.z
                        }

                    }

                }

            }

            function restoreKeyframeObjectPositions() {

                // Resets all positions and rotations of objects to their oldpos and oldrot properties

                for (var i = 0; i < keyframes.length; i++) {

                    for (var j = 0; j < keyframes[i].objects.length; j++) {

                        if (keyframes[i].objects[j].oldpos === undefined) {

                            keyframes[i].objects[j] = undefined;

                        } else {

                            keyframes[i].objects[j].position = {
                                x: keyframes[i].objects[j].oldpos.x,
                                y: keyframes[i].objects[j].oldpos.y,
                                z: keyframes[i].objects[j].oldpos.z
                            }

                            keyframes[i].objects[j].rotation = {
                                x: keyframes[i].objects[j].oldrot.x,
                                y: keyframes[i].objects[j].oldrot.y,
                                z: keyframes[i].objects[j].oldrot.z
                            }

                            delete keyframes[i].objects[j].oldpos;
                            delete keyframes[i].objects[j].oldrot;

                        }

                    }

                }
            }

            function createFinalCommandReusable(armorStands) {

                if (armorStands.length == 0) {
                    return '';
                }

                var commands = [];
                var setblockCommands = []; // Along with a separate init array, also put init commands in this one in case raw commands is not activated
                var initCommands = []; // Copies in here in case raw commands is activated
                var initCmdString = '';

                var placeAtEntity = $('#generate-settings-reusable-entity').val();
                var placeAtEntityID = '';
                var placeAtEntityName = '';

                var useRawCommands = $('#generate-settings-raw-commands').is(':checked');

                var needsNoColTeam = false;

                for (var i = 0; i < objects.length; i++) {

                	if (objects[i].userData.size === 'small') {
                		needsNoColTeam = true;
                	}

                }

                if (needsNoColTeam) {
                	setblockCommands[setblockCommands.length] = initCommands[initCommands.length] = 'scoreboard teams add noCol' + settings.uniquestring; // Add to both arrays
                	setblockCommands[setblockCommands.length] = initCommands[initCommands.length] = 'scoreboard teams option noCol' + settings.uniquestring + ' collisionRule never'; // Add to both arrays
                }

                // Trigger entire animation command
                commands[commands.length] = 'execute @e[type=armor_stand,name=' + settings.uniquestring + '_M,score_' + settings.uniquestring + '_min=2] ~ ~ ~ scoreboard players set @e[tag=' + settings.uniquestring + ',c=' + objects.length + '] ' + settings.uniquestring + ' 1'; // This uses objects.length so that the c= selector only targets the correct objects
                if ($('#animate-settings-hardtp').is(':checked') === false) {
                    commands[commands.length] = 'scoreboard players reset @e[name=' + settings.uniquestring + '_M,score_' + settings.uniquestring + '_min=2] ' + settings.uniquestring;

                }

                var playOnce = $('#animate-settings-play-once').is(':checked');

                var enableMultiDirPlacement = $('#generate-settings-reusable-multidirectional').is(':checked');

                // Add all commands to the 'commands' array

                var animationEnabled = $('#animate-settings-enable').is(':checked');

                if (enableMultiDirPlacement) {
                    var executeAtEntity = 'execute ' + placeAtEntity.replace('[', '[c=1,r=6,') + ' ~ ~ ~ ';
                } else {
                    var executeAtEntity = 'execute ' + placeAtEntity + ' ~ ~ ~ ';
                }


                var multiDirPlacementNum = parseInt($('#generate-settings-reusable-multidirectional-amount').val());

                if (enableMultiDirPlacement) {

                    setblockCommands[setblockCommands.length] = initCommands[initCommands.length] = 'scoreboard objectives add AM_dir dummy';

                    commands[commands.length] = 'scoreboard players add @e[tag=' + settings.uniquestring + '] AM_dir 0';

                }

                var multiDirExecutes = getMultiDirExecutes(executeAtEntity);

                // Get animation commands and run it multiple times if there are multiple directions that it needs to generate

                var animationCommands = [];

                if (enableMultiDirPlacement) {

                    // Will have to run generateAnimationCommands multiple times to get all directions

                    var sceneWrapperBeforeRot = {
                        x: sceneWrapper.rotation.x,
                        y: sceneWrapper.rotation.y,
                        z: sceneWrapper.rotation.z
                    }

                    for (var i = 0; i < objects.length; i++) {

                        objects[i].userData.beforeDirProcessing = {
                            x: objects[i].parent.parent.parent.parent.position.x,
                            y: objects[i].parent.parent.parent.parent.position.y,
                            z: objects[i].parent.parent.parent.parent.position.z
                        }

                        objects[i].userData.beforeDirProcessingRot = {
                            x: objects[i].parent.rotation.x,
                            y: objects[i].parent.parent.rotation.y,
                            z: objects[i].parent.parent.parent.rotation.z
                        }

                    }

                    for (var i = 0; i < multiDirPlacementNum; i++) {

                        // Rotate the sceneWrapper in accordance with the current direction for this loop

                        // Save all object positions before modifying them so that they can be reverted afterwards
                        saveKeyframeObjectPositions();

                        sceneWrapper.updateMatrixWorld();

                        for (var j = 0; j < keyframes.length; j++) {

                            animatePlayhead.ontick = keyframes[j].ontick;
                            loadKeyframeFromPlayhead();

                            sceneWrapper.rotation.set(0, (((i / multiDirPlacementNum) * 360) - 180) * (pi / 180), 0);

                            console.log(((i / multiDirPlacementNum) * 360));
                            // Has to set the rotation each time a keyframe is loaded since keyframes can have their own sceneWrapper rotation values

                            for (var k = 0; k < objects.length; k++) {
                                objects[k].updateMatrixWorld();
                                objects[k].parent.parent.parent.parent.updateMatrixWorld();
                            }

                            updateSceneWrapperRotation();

                            for (var k = 0; k < keyframes[j].objects.length; k++) {

                                var curObj = getObjectByUUID(keyframes[j].objects[k].uuid);

                                keyframes[j].objects[k].position = {
                                    x: parseFloat(parseFloat(curObj.parent.parent.parent.parent.position.x).toFixed(7)),
                                    y: parseFloat(parseFloat(curObj.parent.parent.parent.parent.position.y).toFixed(7)),
                                    z: parseFloat(parseFloat(curObj.parent.parent.parent.parent.position.z).toFixed(7))
                                }

                                keyframes[j].objects[k].rotation = {
                                    x: curObj.parent.rotation.x,
                                    y: curObj.parent.parent.rotation.y,
                                    z: curObj.parent.parent.parent.rotation.z
                                }

                                keyframes[j].objects[k].forcerotated = true;

                            }

                            resetSceneWrapperRotation();

                        }

                        var curAnimationCmds = generateAnimationCommands(false, i);

                        for (var j = 0; j < curAnimationCmds.length; j++) {

                            animationCommands[animationCommands.length] = curAnimationCmds[j];

                        }

                        restoreKeyframeObjectPositions(); // Had to be moved inside of this loop so that the positions and rotations aren't additative (if that's even a word)

                    }

                    // Revert scene wrapper rotation
                    sceneWrapper.rotation.set(sceneWrapperBeforeRot.x, sceneWrapperBeforeRot.y, sceneWrapperBeforeRot.z);

                    // Revert object positions and rotations
                    for (var i = 0; i < objects.length; i++) {

                        objects[i].parent.parent.parent.parent.position.set(objects[i].userData.beforeDirProcessing.x, objects[i].userData.beforeDirProcessing.y, objects[i].userData.beforeDirProcessing.z);

                        objects[i].parent.rotation.x = objects[i].userData.beforeDirProcessingRot.x;
                        objects[i].parent.parent.rotation.y = objects[i].userData.beforeDirProcessingRot.y;
                        objects[i].parent.parent.parent.rotation.z = objects[i].userData.beforeDirProcessingRot.z;

                    }

                } else {

                    animationCommands = generateAnimationCommands(); // Only generating for a single direction

                }


                if (animationEnabled || $('#generate-settings-reusable-multidirectional').is(':checked')) {

                    commands[commands.length] = 'execute ' + placeAtEntity + ' ~ ~ ~ summon armor_stand ~ ~ ~ {CustomName:"' + settings.uniquestring + '_M",Invisible:1b,Marker:1,NoGravity:1b' +'}'; // The main armorstand, which isn't visible but marks the location of the center of the animated scene

                    // Only add the scoreboard objective if the animation is actually enabled
                    setblockCommands[setblockCommands.length] = initCommands[initCommands.length] = 'scoreboard objectives add ' + settings.uniquestring + ' dummy'; // Add to both arrays
                }



                for (var i = 0; i < armorStands.length; i++) {

                    if (armorStands[i].solid) {

                        commands[commands.length] = 'execute ' + placeAtEntity + ' ~ ~ ~ setblock ' + settings.relPos + Math.floor(armorStands[i].x) + ' ' + settings.relPos + Math.floor(fixFloat(armorStands[i].y)) + ' ' + settings.relPos + Math.floor(armorStands[i].z) + ' ' + armorStands[i].solidblock.id + ' ' + armorStands[i].solidblock.damage;

                    } else {

                        // Custom NBT

                        var customnbt = armorStands[i].customnbt;

                        if (customnbt.length > 0) {
                            customnbt += ',';
                        }

                        commands[commands.length] = 'execute ' + placeAtEntity + ' ~ ~ ~ summon ' + armorStands[i].entity + ' ' + settings.relPos + armorStands[i].x + ' ' + settings.relPos + fixFloat(armorStands[i].y) + ' ' + settings.relPos + armorStands[i].z + ' {' + customnbt + armorStands[i].pose + (armorStands[i].extraNBT + armorStands[i].itemNBTLoc.replace(/\*/g, armorStands[i].block)).replace(/,,/g, ',') + '}';

                    }
                    
                }


                // This is where the animation commands are added to the 'commands' array

                console.log('Preparing to generate animation commands...');
                
                for (var i = 0; i < animationCommands.length; i++) {
                    commands.splice(i, 0, animationCommands[i]); // Add the animation commands to the beginning of the commands array
                }

                console.log('Done generating animation commands');
                // End of adding animation commands

                // multiDirExecutes
                if ($('#generate-settings-reusable-multidirectional-autodirection').is(':checked')) {
                    for (var i = 0; i < multiDirExecutes.length; i++) {
                        commands[commands.length] = multiDirExecutes[multiDirExecutes.length - 1 - i] + 'scoreboard players set @e[type=armor_stand,tag=' + settings.uniquestring + ',c=' + (objects.length) + '] AM_dir ' + i;
                    }
                }

                // This had to be moved down so that the multiDirExecutes (above) would work
                if (commands.length > 0) {
                    if (placeAtEntity.indexOf('type=armor_stand') >= 0) {
                        commands[commands.length] = 'kill ' + placeAtEntity;
                    } else {
                        commands[commands.length] = 'tp ' + placeAtEntity + ' ~ ~-999 ~';
                    }
                }

                // Create the commands that setblock the commands from the 'commands' array

                var commandBlockType = 'repeating_command_block';

                for (var i = 0; i < commands.length; i++) {
                    if (i == 1) {
                        // Make all of the command blocks chain command blocks after the first one
                        commandBlockType = 'chain_command_block';
                    }

                    setblockCommands[setblockCommands.length] = 'setblock ~' + (i + 2) + ' ~-2 ~ ' + commandBlockType + ' 5 replace {Command:"' + escapeQuotes(commands[i]) + '",auto:1}';
                }

                if ($('#generate-settings-reusable-spawnegg').is(':checked')) {
                    var re = /type\=([a-zA-Z_]+)/; 
                    var m;
                    if ((m = re.exec(placeAtEntity)) !== null) {
                        if (m.index === re.lastIndex) {
                            re.lastIndex++;
                        }
                        placeAtEntityID = m[1];
                    }

                    re = /name\=([a-zA-Z_0-9]+)/; 
                    m;
                    if ((m = re.exec(placeAtEntity)) !== null) {
                        if (m.index === re.lastIndex) {
                            re.lastIndex++;
                        }

                        placeAtEntityName = ',CustomName:"' + m[1] + '"';
                    }

                    var itemid = 'spawn_egg';
                    if (placeAtEntityID == 'armor_stand')
                        itemid = 'armor_stand';

                    setblockCommands[setblockCommands.length] = initCommands[initCommands.length] = 'give @p ' + itemid + ' 1 0 {EntityTag:{id:' + placeAtEntityID + placeAtEntityName + '}}';
                }

                // Make the final init command string if useRawCommands is not true

                for (var i = 0; i < initCommands.length; i++) {
                    initCommands[i] = 'INIT:' + initCommands[i];
                }

                console.log('Generating output text for reusable setting');
                if (useRawCommands) {
                    return commands.concat(initCommands);
                } else {
                    for (var i = 0; i < setblockCommands.length; i++) {
                        initCmdString = initCmdString + ',{id:commandblock_minecart,Command:"' + escapeQuotes(setblockCommands[i]) + '"}';
                    }

                    outputCommand = '/summon falling_block ~ ~1 ~ {Block:stone,Time:1,Passengers:[{id:falling_block,Block:redstone_block,Time:1,Passengers:[{id:falling_block,Block:activator_rail,Time:1,Passengers:[{id:commandblock_minecart,Command:"gamerule commandBlockOutput false"}' + initCmdString + ',{id:commandblock_minecart,Command:"setblock ~ ~ ~1 command_block 0 replace {Command:\\"fill ~ ~-3 ~-1 ~ ~ ~ air\\"}"},{id:commandblock_minecart,Command:"setblock ~ ~-1 ~1 redstone_block"},{id:commandblock_minecart,Command:"kill @e[type=commandblock_minecart,r=1]"}]}]}]}';

                    return outputCommand;
                }
            }

            var toolTypes = ['axe', 'hoe', 'pickaxe', 'shovel', 'sword'];
            var toolMaterials = [{material: 'golden', durability: 33}, {material: 'wooden', durability: 60}, {material: 'stone', durability: 132}, {material: 'iron', durability: 251}, {material: 'diamond', durability: 1562}];

            var itemDurs = [
                {name: 'leather_helmet', durability: 55},
                {name: 'leather_chestplate', durability: 81},
                {name: 'leather_leggings', durability: 75},
                {name: 'leather_boots', durability: 65},

                {name: 'golden_helmet', durability: 77},
                {name: 'golden_chestplate', durability: 113},
                {name: 'golden_leggings', durability: 105},
                {name: 'golden_boots', durability: 91},

                {name: 'chainmail_helmet', durability: 77},
                {name: 'chainmail_chestplate', durability: 113},
                {name: 'chainmail_leggings', durability: 105},
                {name: 'chainmail_boots', durability: 91},

                {name: 'iron_helmet', durability: 165},
                {name: 'iron_chestplate', durability: 241},
                {name: 'iron_leggings', durability: 225},
                {name: 'iron_boots', durability: 195},

                {name: 'diamond_helmet', durability: 363},
                {name: 'diamond_chestplate', durability: 528},
                {name: 'diamond_leggings', durability: 495},
                {name: 'diamond_boots', durability: 429},

                {name: 'fishing_rod', durability: 65},
                {name: 'carrot_on_a_stick', durability: 26},
                {name: 'flint_and_steel', durability: 65},
                {name: 'shears', durability: 238},
                {name: 'bow', durability: 385}
            ];

            for (var i = 0; i < toolMaterials.length; i++) {
                for (var j = 0; j < toolTypes.length; j++) {
                    itemDurs[itemDurs.length] = {
                        name: toolMaterials[i].material + '_' + toolTypes[j],
                        durability: toolMaterials[i].durability
                    }
                }
            }

            function getMaxDurability(blockid) {
                // Returns the max durability of an item that has a durability
                for (var i = 0; i < itemDurs.length; i++) {
                    if (itemDurs[i].name === blockid) {
                        return itemDurs[i].durability;
                    }
                }
            }


            $('#generate-button').click(function() {
                closeAllDialogBoxes();
                $('#generate').fadeIn(250);
                generateOutput();
            });

            $('#animate-settings-button').click(function() {
                closeAllDialogBoxes();
                $('#animate-settings').fadeIn(250);
            })

            $('.dialogbox-close').click(function() {
                $(this).parent().parent().fadeOut(200);
            });

            function closeAllDialogBoxes() {
                $('.dialogbox').fadeOut(200);
            }

            $('#options-button').click(function() {
                closeAllDialogBoxes();
                $('#options').fadeIn(250);
            });

            $("#createblock-button").click(function() {
                var blockID = $('#createblock-text').val();

                if (blockID.length === 0 || blockID === 'armorstand') {
                    // If the textbox is empty, insert a blank armorstand
                    models.insert.blankArmorstand();
                } else {
                    models.createObj(blockID, {}, function(data) {

                    data.obj.userData.justAdded = true;

                    sceneWrapper.add(data.topparent);

                    models.updateKeyframesAfterAddObj();

                });
                }
                
                // Make a new keyframe at the current position on the timeline (or update one if it's already there)
                updateKeyframeAt(animatePlayhead.ontick);

                // Also update the first keyframe on the timeline so that the new object starts at (0, 0, 0) on the first keyframe (*deprecated)
                // updateKeyframeAt(0);

                generateOutput();
            });

            $('#createblock-text').keydown(function(e) {
                if (e.keyCode == 13) {
                    $("#createblock-button").click();
                } else if (e.keyCode == 9) {
                    e.preventDefault();
                    $(this).val($(this).val());
                }
            });

            $('#selectedobj-changeid').keydown(function(e) {
                if (e.keyCode == 13) {
                    changeBlockId(); // Run the function to update the id of the selected block
                } else if (e.keyCode == 9) {
                    e.preventDefault();
                    $(this).val($(this).val());
                }
            });

            var alphakeys = ['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','_',':'];
            var objectidlist = [];
            for (var id in blockIds) {
                objectidlist[objectidlist.length] = id;
            }

            function suggestBlockId(elementid, event) {
                setTimeout(function() {
                    if (event.ctrlKey === false && $.inArray(String.fromCharCode(event.which).toUpperCase(), alphakeys) !== -1) {
                        var inputText = $('#' + elementid).val();
                        var currentResultLen = 99;
                        for (var i = objectidlist.length - 1; i >= 0; i--) {
                            if (inputText.length > 0 && inputText === objectidlist[i].substring(0, inputText.length) && objectidlist[i].length <= currentResultLen) {
                                currentResultLen = objectidlist[i].length;
                                $('#' + elementid).val(objectidlist[i]);
                                createSelection(document.getElementById(elementid), inputText.length, objectidlist[i].length);
                            }
                        }
                    }
                }, 1);
            }

            $('#createblock-text').keypress(function(e) {
                suggestBlockId('createblock-text', e);
            });

            $('#selectedobj-changeid').keypress(function(e) {
                suggestBlockId('selectedobj-changeid', e);
            });

            function createSelection(field, start, end) {
                if( field.createTextRange ) {
                    var selRange = field.createTextRange();
                    selRange.collapse(true);
                    selRange.moveStart('character', start);
                    selRange.moveEnd('character', end);
                    selRange.select();
                } else if( field.setSelectionRange ) {
                    field.setSelectionRange(start, end);
                } else if( field.selectionStart ) {
                    field.selectionStart = start;
                    field.selectionEnd = end;
                }
                field.focus();
            }

            $('#selectedobj-remove').click(function() {
                for (var i = 0; i < objects.length; i++) {
                    if (objects[i].userData.selected) {
                        if (objects[i].userData.rawid.indexOf('armorstand_') === -1) {
                            // Selected object is not part of a blank armorstand
                            // Remove this object from all keyframes
                            removeObjFromKeyframes(objects[i].uuid);
                            sceneWrapper.remove(objects[i].parent.parent.parent.parent);
                            objects.splice(i, 1);
                            objectrotationwrappers.splice(i, 1);
                            $('.selectedobj-properties').hide();
                            $('#project').show();
                            $('#project-list').show();
                            window.requestAnimationFrame(render);
                        } else {
                            // Selected object is part of a blank armorstand
                            removeObjFromKeyframes(objects[i].uuid);
                            var blankArmorstandIndex = 0;
                            for (var j = 0; j < blankArmorstands.length; j++) {
                                if (blankArmorstands[j].uuid === objects[i].parent.parent.parent.parent.parent.uuid) {
                                    blankArmorstandIndex = j;
                                }
                            }

                            var objTopParent = objects[i].parent.parent.parent.parent.parent;

                            var objIndexesToSplice = [];

                            // Remove all armorstand part objects from the objects[] array
                            for (var j = objects.length - 1; j >= 0; j--) {
                                for (var k = objects[i].parent.parent.parent.parent.parent.children.length - 1; k >= 0; k--) {
                                    if (objects[j].userData.customname === objects[i].parent.parent.parent.parent.parent.children[k].children[0].children[0].children[0].children[0].userData.customname) {
                                        objIndexesToSplice[objIndexesToSplice.length] = j;
                                    }
                                }
                            }

                            for (var j = 0; j < objIndexesToSplice.length; j++) {
                                objects.splice(objIndexesToSplice[j], 1);
                            }

                            blankArmorstands.splice(blankArmorstandIndex, 1);
                            sceneWrapper.remove(objTopParent);

                            objectrotationwrappers.splice(i, 1);
                            $('.selectedobj-properties').hide();
                            $('#project').show();
                            $('#project-list').show();
                            window.requestAnimationFrame(render);
                        }
                    }
                }
                selectedobject = null;
                updateObjectMoverLines();
                generateOutput();

                updateObjectBrowser();
            });

            $('#selectedobj-duplicate').click(function() {

                var fromObj = selectedObject();

                if (fromObj.userData.rawid.indexOf('armorstand_') > -1) {

                    // Duplicate a blank armorstand

                    var oldBlankArmorstand = fromObj.parent.parent.parent.parent.parent;

                    copyBlankArmorstand(oldBlankArmorstand);

                } else {

                    // Duplicate a regular object

                    var dupe = duplicateObject(fromObj);
                    sceneWrapper.add(dupe.parent.parent.parent.parent); // Duplicate the selected object

                    dupe.userData.justAdded = true;

                    models.updateKeyframesAfterAddObj();

                    // Select newly duplicated object
                    fromObj.userData.selected = false;
                    dupe.userData.selected = true;
                    selectedobject = dupe;
                    editObject(dupe);

                }

            });

            function duplicateObject(object) {
                fromObj = object;

                objects[objects.length] = fromObj.clone();
                objectrotationwrappers[objectrotationwrappers.length] = fromObj.parent.clone();
                objectrotationwrappers[objectrotationwrappers.length-1].rotation.copy(fromObj.parent.rotation);
                objectrotationwrappers[objectrotationwrappers.length-1].children = [];

                for (var i = 0; i < fromObj.parent.children.length; i++) {
                    if (fromObj.parent.children[i].userData.isRotationOffset === true) {
                        var newArmorstandTip = new THREE.Mesh(fromObj.parent.children[i].geometry.clone(), fromObj.parent.children[i].material.clone());
                        newArmorstandTip.userData.armorStandTip = true;
                        newArmorstandTip.userData.isRotationOffset = true;
                        newArmorstandTip.position.copy(fromObj.parent.children[i].position);
                        newArmorstandTip.visible = false;

                        objectrotationwrappers[objectrotationwrappers.length-1].add(newArmorstandTip);
                    }
                }

                var secondParent = fromObj.parent.parent.clone();
                secondParent.rotation.copy(fromObj.parent.parent.rotation);
                secondParent.children = [];
                secondParent.add(objectrotationwrappers[objectrotationwrappers.length-1]);

                var newobjectwrapperouter = fromObj.parent.parent.parent.clone();
                newobjectwrapperouter.rotation.copy(fromObj.parent.parent.parent.rotation);
                newobjectwrapperouter.children = [];
                newobjectwrapperouter.add(secondParent);

                var newtopparent = fromObj.parent.parent.parent.parent.clone();
                newtopparent.rotation.copy(fromObj.parent.parent.parent.parent.rotation);
                newtopparent.children = [];
                newtopparent.add(newobjectwrapperouter);

                // Duplicate the material on all of the children objects so that the duplicated object
                // can be selected independently from the original object
                for (var c = 0; c < objects[objects.length-1].children.length; c++) {
                    // Don't run on the rotational center object since it is in the parent.children now instead
                    objects[objects.length-1].children[c].material = fromObj.children[c].material.clone();
                }

                // Add "(Copy #) to the end of the new objects name"
                if (objects[objects.length-1].userData.name.indexOf('(Copy') >= 0) {
                    var newCopyNum = parseInt(objects[objects.length-1].userData.name.match(/\(Copy [0-9]+\)/g)[0].match(/[0-9]+/g)[0]) + 1;
                    objects[objects.length-1].userData.name = objects[objects.length-1].userData.name.replace(/\(Copy ([0-9])+\)/g, "\(Copy " + newCopyNum + "\)");
                } else {
                    objects[objects.length-1].userData.name = objects[objects.length-1].userData.name + ' (Copy 1)';
                }

                objectrotationwrappers[objectrotationwrappers.length-1].add(objects[objects.length-1]);
                

                // New random custom name
                objects[objects.length-1].userData.customname = randomString(5);

                
                
                return objects[objects.length-1];

            }

            function selectedObject() {
                for (var o = 0; o < objects.length; o++) {
                    if (objects[o].userData.selected) {
                        return objects[o];
                    }
                }
                return false;

                // if (selectedobject !== undefined && selectedobject !== null) {
                //     return selectedobject;
                // } else {
                //     return false;
                // }
            }

            $("#selectedobj-name").focusout(function() {
                for (var i = 0; i < objects.length; i++) {
                    if (objects[i].userData.selected) {
                        objects[i].userData.name = $('#selectedobj-name').val();
                    }
                }
            });

            $('.selectedobj-pos-changer').on('change', function() {

                $('.selectedobj-pos-changer').each(function() {
                    if (isNaN(this.value) || (this.value.length == 0)) {
                        $(this).css('background-color', '#FFB3B3');
                    } else {
                        $(this).css('background-color', '#FFFFFF');
                    }
                });

                var curObj = selectedObject();

                if (curObj.userData.size === 'solid') {
                    var setSelectedObjPos = {
                        x: parseFloat(Math.round($('#selectedobj-x').val())),
                        y: fixFloat(parseFloat(Math.round($('#selectedobj-y').val())) + (curObj.parent.parent.scale.y / 2)),
                        z: parseFloat(Math.round($('#selectedobj-z').val()))
                    }

                    $('#selectedobj-x').val(Math.round($('#selectedobj-x').val()));
                    $('#selectedobj-y').val(Math.round($('#selectedobj-y').val()));
                    $('#selectedobj-z').val(Math.round($('#selectedobj-z').val()));
                } else {
                    var setSelectedObjPos = {
                        x: parseFloat($('#selectedobj-x').val()),
                        y: fixFloat(parseFloat($('#selectedobj-y').val()) + (curObj.parent.scale.y / 2)),
                        z: parseFloat($('#selectedobj-z').val())
                    }
                }

                setSelectedObjPos.x -= settings.offset.x;
                setSelectedObjPos.y -= settings.offset.y;
                setSelectedObjPos.z -= settings.offset.z;

                var cObjX = parseFloat($('#selectedobj-x').val());
                var cObjY = parseFloat($('#selectedobj-y').val());
                var cObjZ = parseFloat($('#selectedobj-z').val());

                if (decimalPlaces(cObjX) == 0)
                	$('#selectedobj-x').val(cObjX.toFixed(1));
                else
                	$('#selectedobj-x').val(cObjX);

                if (decimalPlaces(cObjY) == 0)
                	$('#selectedobj-y').val(cObjY.toFixed(1));
               	else
               		$('#selectedobj-y').val(cObjY);

                if (decimalPlaces(cObjZ) == 0)
                	$('#selectedobj-z').val(cObjZ.toFixed(1));
                else
                	$('#selectedobj-z').val(cObjZ);

                if (curObj.userData.rawid.indexOf('armorstand_') === -1) {
                    curObj.parent.parent.parent.parent.position.set(setSelectedObjPos.x, setSelectedObjPos.y, setSelectedObjPos.z);
                } else {
                    curObj.parent.parent.parent.parent.parent.position.set(setSelectedObjPos.x, setSelectedObjPos.y, setSelectedObjPos.z);
                }

                render();
            });

            // On change object item/block id input
            function changeBlockId(objectUUID, newID, dontCreateKeyframe) {

                var newID = newID ? newID : $('#selectedobj-changeid').val();
                var changeObjUUID = objectUUID ? objectUUID : selectedObject().uuid;

                if ($.inArray(newID, objectidlist) !== -1 || $.inArray(newID + ':0', objectidlist) !== -1 || $.inArray(newID.replace(/\:[0-9]+/, ''), objectidlist) !== -1  || $.inArray(newID.replace(/\:[0-9]+/, ':0'), objectidlist) !== -1) {
                    $('#selectedobj-changeid').css('border', '1px solid #C5C5C5');
                    $('#selectedobj-changeid').css('background-color', 'white');

                    if (objectUUID) {
                        settings.dontSelect = true;
                    }

                    models.createObj(newID, {

                        curObjUUID: changeObjUUID,

                        dontCreateKeyframe: dontCreateKeyframe

                    }, function(data) {

                        // Transfer segments from the new object to the one that should be changed

                        var curObjUUID = data.retain.curObjUUID; // Is the previous version of the object

                        // Remove old objects from the objects[] array

                        for (var i = 0; i < objects.length; i++) {
                            if (objects[i].uuid == curObjUUID) {
                                var curObj = objects[i];
                                var curObjIndex = i;
                            }
                        }

                        sceneWrapper.remove(objects[curObjIndex].parent.parent.parent.parent); // Remove the old object from the scene

                        sceneWrapper.add(data.topparent); // Adds the new version of the object to the scene

                        data.obj.uuid = curObj.uuid; // Copy the id from the old obj to the new one, so all previously-made keyframes are still attached to it

                        data.obj.userData.name = curObj.userData.name; // Copy the id from the old obj to the new one, so all previously-made keyframes are still attached to it

                        objects.splice(curObjIndex, 1);

                        // Load keyframe from playhead so that the object's position and rotation are fixed
                        loadKeyframeFromPlayhead();

                        settings.dontSelect = false;

                    });

                } else {
                    // Show that it isn't valid by making the textbox flash red then reverting the value
                    $('#selectedobj-changeid').css('border', '1px solid red');
                    $('#selectedobj-changeid').css('background-color', '#ff9999');
                }
            };

            $('.update-object-mover-lines').on('change', function() {
                updateObjectMoverLines();
            });

            // Scene wrapper rotation

            var sceneWrapperRotStore;


            function updateSceneWrapperRotation() {
                // Moves the objects based on their absolute positions because of the rotation of the scene wrapper object
                // Will only be called before generating stuff: not every time the textbox is changed

                // Stop the function right now if no scene rotations are active in the scene currently
                if (scene.rotation.x === 0 && scene.rotation.y === 0 && scene.rotation.z === 0)
                    return;

                // nextCombination();

                scene.updateMatrixWorld();

                for (var i = 0; i < objects.length; i++) {

                    // Save the initial positions

                    for (var j = 0; j < objects[i].parent.children.length; j++) {

                        if (objects[i].parent.children[j].userData.isRotationOffset === true) {

                            var rotOffset = objects[i].parent.children[j];

                        }

                    }

                    var beforePos = new THREE.Vector3();
                    beforePos.setFromMatrixPosition(rotOffset.matrixWorld);

                    // Absolute before pos
                    objects[i].userData.sceneBeforePosAbs = {
                        x: beforePos.x,
                        y: beforePos.y,
                        z: beforePos.z
                    };

                    // Relative before pos
                    objects[i].userData.sceneBeforePos = {
                        x: objects[i].parent.parent.parent.parent.position.x,
                        y: objects[i].parent.parent.parent.parent.position.y,
                        z: objects[i].parent.parent.parent.parent.position.z
                    };


                    // Save the initial rotations

                    if (objects[i].userData.special === true) {
                        debugger;
                    }

                    var beforeRotForX = new THREE.Euler();
                    beforeRotForX.setFromRotationMatrix(objects[i].parent.matrixWorld, "ZYX");

                    var beforeRotForY = new THREE.Euler(); // Had to be a separate one for some reason...
                    beforeRotForY.setFromRotationMatrix(objects[i].parent.parent.matrixWorld, "ZYX");

                    var beforeRotForZ = new THREE.Euler(); // And apparently this one has to be separate too
                    beforeRotForZ.setFromRotationMatrix(objects[i].parent.parent.parent.matrixWorld, "ZYX");

                    // Absolute before rot
                    objects[i].userData.sceneBeforeRotAbs = {
                        x: beforeRotForX.x,
                        y: beforeRotForY.y,
                        z: beforeRotForZ.z
                    };

                    // Relative before rot
                    objects[i].userData.sceneBeforeRot = {
                        x: objects[i].parent.rotation.x,
                        y: objects[i].parent.parent.rotation.y,
                        z: objects[i].parent.parent.parent.rotation.z
                    };

                }

                sceneWrapperRotStore = {
                    x: sceneWrapper.rotation.x,
                    y: sceneWrapper.rotation.y,
                    z: sceneWrapper.rotation.z
                }

                sceneWrapper.rotation.set(0, 0, 0);
                sceneWrapper.updateMatrixWorld();

                for (var i = 0; i < objects.length; i++) {

                    for (var j = 0; j < objects[i].parent.children.length; j++) {

                        if (objects[i].parent.children[j].userData.isRotationOffset === true) {

                            var rotOffset = objects[i].parent.children[j];

                        }

                    }

                    rotOffset.updateMatrixWorld();

                    // Update position based on changes in the rotated scene wrapper

                    var scenePos = new THREE.Vector3();
                    scenePos.setFromMatrixPosition(rotOffset.matrixWorld);

                    if (objects[i].userData.special === true) {
                        debugger;
                    }

                    objects[i].parent.parent.parent.parent.position.x -= parseFloat((scenePos.x - objects[i].userData.sceneBeforePosAbs.x).toFixed(6));
                    objects[i].parent.parent.parent.parent.position.y -= parseFloat((scenePos.y - objects[i].userData.sceneBeforePosAbs.y).toFixed(6));
                    objects[i].parent.parent.parent.parent.position.z -= parseFloat((scenePos.z - objects[i].userData.sceneBeforePosAbs.z).toFixed(6));
                    // objects[i].parent.parent.parent.parent.position.x += scenePos.x - objects[i].userData.sceneBeforePosAbs.x;
                    // objects[i].parent.parent.parent.parent.position.y += scenePos.y - objects[i].userData.sceneBeforePosAbs.y;
                    // objects[i].parent.parent.parent.parent.position.z += scenePos.z - objects[i].userData.sceneBeforePosAbs.z;

                    // Update rotations based on changes in the rotated scene wrapper

                    // var sceneRot = new THREE.Euler();
                    // sceneRot.setFromRotationMatrix(rotOffset.parent.matrixWorld);

                    if (settings.selected.mode === 'reusable') {
                        rotOffset.updateMatrixWorld();
                        scene.updateMatrixWorld();

                        var beforeApplyRot = new THREE.Vector3();
                        beforeApplyRot.setFromMatrixPosition(rotOffset.matrixWorld);
                    }

                    objects[i].parent.rotation.x = parseFloat((objects[i].userData.sceneBeforeRotAbs.x).toFixed(6));
                    objects[i].parent.parent.rotation.y = parseFloat((objects[i].userData.sceneBeforeRotAbs.y).toFixed(6));
                    objects[i].parent.parent.parent.rotation.z = parseFloat((objects[i].userData.sceneBeforeRotAbs.z).toFixed(6));

                    if (settings.selected.mode === 'reusable') {

                        rotOffset.updateMatrixWorld();
                        scene.updateMatrixWorld();

                        var afterApplyRot = new THREE.Vector3();
                        afterApplyRot.setFromMatrixPosition(rotOffset.matrixWorld);

                        objects[i].parent.parent.parent.parent.position.x -= parseFloat((afterApplyRot.x - beforeApplyRot.x).toFixed(6));
                        objects[i].parent.parent.parent.parent.position.y -= parseFloat((afterApplyRot.y - beforeApplyRot.y).toFixed(6));
                        objects[i].parent.parent.parent.parent.position.z -= parseFloat((afterApplyRot.z - beforeApplyRot.z).toFixed(6));

                    }

                }

            }

            function resetSceneWrapperRotation() {
                // Moves objects back to their original locations which were recorded in the userData

                if (scene.rotation.x === 0 && scene.rotation.y === 0 && scene.rotation.z === 0)
                    return;

                sceneWrapper.rotation.set(sceneWrapperRotStore.x, sceneWrapperRotStore.y, sceneWrapperRotStore.z);

                for (var i = 0; i < objects.length; i++) {

                    objects[i].parent.parent.parent.parent.position.set(objects[i].userData.sceneBeforePos.x, objects[i].userData.sceneBeforePos.y, objects[i].userData.sceneBeforePos.z);
                    
                    objects[i].parent.rotation.x = objects[i].userData.sceneBeforeRot.x;
                    objects[i].parent.parent.rotation.y = objects[i].userData.sceneBeforeRot.y;
                    objects[i].parent.parent.parent.rotation.z = objects[i].userData.sceneBeforeRot.z;

                }

            }

            $('.options-rotation').change(function() {

                var xRot = parseInt($('#options-rotation-x').val()) * (pi / 180);
                var yRot = parseInt($('#options-rotation-y').val()) * (pi / 180);
                var zRot = parseInt($('#options-rotation-z').val()) * (pi / 180);

                sceneWrapper.rotation.set(xRot, yRot, zRot);

                if ($('#options-rotation-only-current-frame').is(':checked')) {
                    // Only apply scene rotation to this keyframe

                    keyframes[keyframeUsedAt(animatePlayhead.ontick)].scenerot = {
                        x: xRot,
                        y: yRot,
                        z: zRot
                    }

                } else {
                    // Apply scene rotation to all keyframes

                    for (var i = 0; i < keyframes.length; i++) {
                        keyframes[i].scenerot = {
                            x: xRot,
                            y: yRot,
                            z: zRot
                        }
                    }

                }

                render();

            });

            // Init() function

            var scene, camera, renderer, mouse, raycaster, objectMoverLines, objectMover, plane, selectedobject, sceneWrapper;

            var targetList, objects = [], objectrotationwrappers = [], rotationwrappersparent = [], axisLines = [];
            var projector, mouse = { x: 0, y: 0 };
            var offset = new THREE.Vector3();

            var clickobj = false;

            init();
            render();

            function init() {
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 0.1, 1000 );

                // Setup renderer
                var canvas = document.getElementById("canvas3d");
                renderer = new THREE.WebGLRenderer({antialias: true, alpha: true, canvas: canvas});
                renderer.setClearColor(0x000, 0);
                renderer.setSize( window.innerWidth, window.innerHeight );
                document.body.appendChild( renderer.domElement );
                document.getElementById('canvas3d').addEventListener('mousedown', onDocumentMouseDown, false);
                document.getElementById('canvas3d').addEventListener('mouseup', onDocumentMouseUp, false);
                window.addEventListener('resize', function() {
                    renderer.setSize( window.innerWidth, window.innerHeight );
                    camera.apsect = window.innerWidth / window.innerHeight;
                });

                // Object container (holds all objects so that they can all be rotated together for "entire scene rotation")

                sceneWrapper = new THREE.Object3D();
                sceneWrapper.eulerOrder = 'YZX';
                scene.add(sceneWrapper);

                // Grid

                var grid = new THREE.GridHelper( 9.5, 1 );
                grid.setColors( 0xffffff, 0xffffff );
                scene.add(grid);
                grid.position.set(-0.5, 0, -0.5);

                // Axis lines

                var geometry = new THREE.Geometry();
                geometry.vertices.push(
                    new THREE.Vector3( 0, 0, 0 ),
                    new THREE.Vector3( 9.5, 0, 0 )
                );

                var material = new THREE.LineBasicMaterial({
                    color: 0xe60000
                });

                axisLines[0] = new THREE.Line( geometry, material );
                scene.add( axisLines[0] );

                var geometry = new THREE.Geometry();
                geometry.vertices.push(
                    new THREE.Vector3( 0, 0, 0 ),
                    new THREE.Vector3( 0, 0, 9.5 )
                );

                var material = new THREE.LineBasicMaterial({
                    color: 0x0000e6
                });

                axisLines[1] = new THREE.Line( geometry, material );
                scene.add( axisLines[1] );

                var geometry = new THREE.Geometry();
                geometry.vertices.push(
                    new THREE.Vector3( 0, 0, 0 ),
                    new THREE.Vector3( 0, 9.5, 0 )
                );

                var material = new THREE.LineBasicMaterial({
                    color: 0x2eb82e
                });

                axisLines[2] = new THREE.Line( geometry, material );
                scene.add( axisLines[2] );

                // Make them invisible by default
                for (var i = 0; i < axisLines.length; i++) {
                    axisLines[i].visible = false;
                }

                // End of axis lines

                // Object position mover lines

                objectMoverLines = [];
                objectMover = new THREE.Object3D();
                objectMoverLength = 1;
                var objectMoverWidth = 0.03;

                var geometry = new THREE.BoxGeometry(objectMoverLength, objectMoverWidth, objectMoverWidth);

                var material = new THREE.MeshBasicMaterial({
                    color: 0xe60000
                });

                objectMoverLines[0] = new THREE.Mesh( geometry, material );
                objectMoverLines[0].position.x = objectMoverLength / 2;
                objectMoverLines[0].userData.axis = 'x';
                objectMover.add( objectMoverLines[0] );


                var geometry = new THREE.BoxGeometry(objectMoverWidth, objectMoverLength, objectMoverWidth);

                var material = new THREE.MeshBasicMaterial({
                    color: 0x2eb82e
                });

                objectMoverLines[1] = new THREE.Mesh( geometry, material );
                objectMoverLines[1].position.y = objectMoverLength / 2;
                objectMoverLines[1].userData.axis = 'y';
                objectMover.add( objectMoverLines[1] );


                var geometry = new THREE.BoxGeometry(objectMoverWidth, objectMoverWidth, objectMoverLength);

                var material = new THREE.MeshBasicMaterial({
                    color: 0x0033cc
                });

                objectMoverLines[2] = new THREE.Mesh( geometry, material );
                objectMoverLines[2].position.z = objectMoverLength / 2;
                objectMoverLines[2].userData.axis = 'z';
                objectMover.add( objectMoverLines[2] );

                for (var i = 0; i < objectMoverLines.length; i++) {
                    objectMoverLines[i].material.opacity = 0.5;
                    objectMoverLines[i].material.transparent = true;
                    objectMoverLines[i].userData.isMoverLine = true;
                }


                objectMover.visible = false;

                sceneWrapper.add(objectMover);

                // End of object position mover lines

                // Object position mover plane

                plane = new THREE.Mesh(new THREE.PlaneBufferGeometry(500, 500, 8, 8), new THREE.MeshBasicMaterial({color: 0x248f24, alphaTest: 0, visible: false}));
                scene.add(plane);


                // End of object position mover plane

                // This loop adds all objects that were in the array when init() ran.
                for (i = 0; i < objects.length; i++) {
                    sceneWrapper.add(objects[i]);
                }

                // Light sources
                var dirLight = new THREE.DirectionalLight(0xffffff, 0.7);
                scene.add(camera);
                camera.add(dirLight);
                
                var hemLight = new THREE.HemisphereLight(0xffffff, 0xfffffff, 0.5);
                scene.add(hemLight);

                // Move camera away a little so you can see the objects
                camera.position.z = 8;
                camera.position.y = 4;
                projector = new THREE.Projector();

                raycaster = new THREE.Raycaster();
                document.getElementById('canvas3d').addEventListener('mousemove', onDocumentMouseMove, false);
                document.addEventListener('mousemove', fullDocumentMouseMove, false);

                // Setup OrbitControls
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.addEventListener('change', render);
            }

            // Render loop
            function render() {
                // controls.update();

                // Mouse selecting
                if (!clickobj) {
                    raycaster.setFromCamera(mouse, camera);
                    var intersects = raycaster.intersectObjects(objects, true);
                } else {
                    var intersects = clickobjstore;

                    if (intersects.length === 0 && settings.selectingCCpos) {
                        $('#customcommands-selectobj-done').hide(); // Only matters when selecting an object for a custom command (or actually UN-selecting)
                        $('#customcommands-selectobj-objname').hide(); // Only matters when selecting an object for a custom command (or actually UN-selecting)
                        $('#customcommands-selectobj-objname').empty(); // Only matters when selecting an object for a custom command (or actually UN-selecting)
                    }
                }

                if (selectedObject() !== false) {
                    var selectedobjecttesting = selectedObject();
                }

                for (var i = 0; i < objects.length; i++) {
                    if (objects[i].userData.selected && !clickobj) {
                        // Run the following code on the selected object
                        setObjColor(i, 0x1A75FF);
                    } else {
                        if (objects[i].children[0].userData.color !== undefined) {
                            for (var j = 0; j < objects[i].children.length; j++) {
                                objects[i].children[j].material.color = objects[i].children[j].userData.color;
                            }
                        } else {
                            setObjColor(i, 0xffffff);
                        }
                    }

                    if (objects[i].userData.highlight === true)
                        setObjColor(i, 0x66b2ff);
                }

                if (intersects.length > 0) {
                    if (clickobj) {
                        // Clicked an object
                        setObjColor(0, 0x1A75FF, intersects);
                        
                        intersects[0].object.parent.userData.selected = true;
                        selectedobject = intersects[0].object.parent;
                    } else {
                        // Just hovered over an object
                        if (!intersects[0].object.parent.userData.selected) {
                            setObjColor(0, 0x66b2ff, intersects);
                        }

                    }
                }

                renderer.render( scene, camera );
            }

            function editObject(object) {
                if (object === false) {

                    $('.selectedobj-properties').hide();
                    $('#manipulate').hide();
                    $('#project').show();
                    $('#project-list').show();

                    selectedobject = null;

                    updateObjectMoverLines();

                    $('#armorstand-options').hide();

                    return;
                }

                if (settings.importing || settings.dontSelect || object.parent.parent.parent.parent.userData.blankArmorstandPreviewSlot) {
                    return;
                }

                if (object.userData.isDynamic !== true) {
                    return;
                }

                selectedobject = object;

                // If the user is selecting for a custom command, then stop here and revert the selection
                if (settings.selectingCCpos) {

                    settings.selectingCCkeyframe

                    $('#customcommands-selectobj-done').show();
                    $('#customcommands-selectobj-objname').show();
                    $('#customcommands-selectobj-objname').html(object.userData.name);

                    editObject(false); // Act like nothing happened

                    return;

                }

                $('.selectedobj-properties').show();
                $('#project').hide();
                $('#project-list').hide();
                $('#selectedobj-name').val(object.userData.name);

                // Fill in position textboxes
                updatePositionInputs(object);

                if (object.userData.enableRotCenter === undefined) {
                    object.userData.enableRotCenter = true;
                }

                if (object.userData.enableRotCenter) {
                    $('#manipulate-toggle-rotationcenter').prop('checked', true);
                } else {
                    $('#manipulate-toggle-rotationcenter').prop('checked', false);
                }

                // Object id changing
                $('#selectedobj-changeid').val(object.userData.blockid.replace('id:', '').replace(',Damage', ''));
                $('#selectedobj-changeid').css({'border': '1px solid #C5C5C5','background-color': 'white'});

                // Rotation inputs for small, medium, and large
                updateRotators(object.userData.size);

                // Size button
                selectSizeButtonCSS(object.userData.size);

                // Change step for position changing
                updatePosChanger();

                // Update rotation inputs (the manual number inputs)
                updateRotationInputs();

                // Object mover lines
                updateObjectMoverLines();

                // Manipulate button
                updateManipulateButton();

                // Blank armorstand parts selection
                // if (object.parent.parent.parent.parent.userData.blankArmorstandPart !== undefined) {
                //  $('.selectedobj-pos-changer').hide();
                // } else {
                //  $('.selectedobj-pos-changer').show();
                // }

                if (object.parent.parent.parent.parent.userData.blankArmorstandPart !== undefined) {
                    // Selected part of a blank armorstand
                    $('#armorstand-bodyrotation-container').show();
                    $('#selectedobj-small').hide();
                    $('#selectedobj-medium').hide();
                    $('#selectedobj-large').hide();
                    $('#selectedobj-solid').hide();
                    $('#selectedobj-armorstand-options').show();
                    $('#selectedobj-changeid').attr('disabled', true);
                    $('#selectedobj-visible').hide();
                    $('#selectedobj-invisible').hide();

                    var blankArmorstandNBT = object.parent.parent.parent.parent.parent.userData.nbt;

                    // Load armorstand NBT into the armorstand options
                    $('#armorstand-options-invisible').prop('checked', blankArmorstandNBT.Invisible);
                    $('#armorstand-options-showarms').prop('checked', blankArmorstandNBT.ShowArms);
                    $('#armorstand-options-invulnerable').prop('checked', blankArmorstandNBT.Invulnerable);
                    $('#armorstand-options-nobaseplate').prop('checked', blankArmorstandNBT.NoBasePlate);
                    $('#armorstand-options-nogravity').prop('checked', blankArmorstandNBT.NoGravity);

                    $('#blankarmorstand-equipment-head-advanced').val(blankArmorstandNBT.ArmorItems[3]);
                    $('#blankarmorstand-equipment-chest-advanced').val(blankArmorstandNBT.ArmorItems[2]);
                    $('#blankarmorstand-equipment-legs-advanced').val(blankArmorstandNBT.ArmorItems[1]);
                    $('#blankarmorstand-equipment-feet-advanced').val(blankArmorstandNBT.ArmorItems[0]);
                    $('#blankarmorstand-equipment-lefthand-advanced').val(blankArmorstandNBT.HandItems[1]);
                    $('#blankarmorstand-equipment-righthand-advanced').val(blankArmorstandNBT.HandItems[0]);

                    $('#blankarmorstand-equipment-head').val(getItemIdFromNBT(blankArmorstandNBT.ArmorItems[3]));
                    $('#blankarmorstand-equipment-chest').val(getItemIdFromNBT(blankArmorstandNBT.ArmorItems[2]));
                    $('#blankarmorstand-equipment-legs').val(getItemIdFromNBT(blankArmorstandNBT.ArmorItems[1]));
                    $('#blankarmorstand-equipment-feet').val(getItemIdFromNBT(blankArmorstandNBT.ArmorItems[0]));
                    $('#blankarmorstand-equipment-lefthand').val(getItemIdFromNBT(blankArmorstandNBT.HandItems[1]));
                    $('#blankarmorstand-equipment-righthand').val(getItemIdFromNBT(blankArmorstandNBT.HandItems[0]));

                } else {
                    // Selected a normal object
                    $('#armorstand-bodyrotation-container').hide();
                    $('#selectedobj-small').show();
                    $('#selectedobj-medium').show();
                    $('#selectedobj-large').show();
                    $('#selectedobj-solid').show();
                    $('#selectedobj-armorstand-options').hide();
                    $('#armorstand-options').hide();
                    $('#selectedobj-changeid').attr('disabled', false);
                    $('#selectedobj-visible').show();
                    $('#selectedobj-invisible').show();
                }

                // Update the 'trigger animation' textarea so that it matches this object
                $('#manipulate-trigger-animation').val( 'scoreboard players set @e[tag=' + settings.uniquestring + ',name=' + object.userData.customname + '] ' + settings.uniquestring + ' 1' );
            }

            function updateManipulateButton() {
                // if ($('#animate-settings-loop').is(':checked')) {

                //  $('#selectedobj-animation-manipulation').hide();

                // } else {

                //  $('#selectedobj-animation-manipulation').show();

                // }
            }

            function decimalPlaces(num) {
			  var match = (''+num).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);
			  if (!match) { return 0; }
			  return Math.max(
			       0,
			       // Number of digits right of decimal point.
			       (match[1] ? match[1].length : 0)
			       // Adjust for scientific notation.
			       - (match[2] ? +match[2] : 0));
			}

            function updatePositionInputs(object) {

                if (object.userData.rawid.indexOf('armorstand_') === -1) {
                    var objToUse = object.parent.parent.parent.parent;
                } else {
                    var objToUse = object.parent.parent.parent.parent.parent;
                }

                var curObjPos = {
                    x: objToUse.position.x,
                    y: fixFloat(objToUse.position.y - (object.parent.scale.y / 2)),
                    z: objToUse.position.z
                }

                if ($('#options-offset-absolute').is(':checked')) {

                    curObjPos.x += settings.offset.x;
                    curObjPos.y += settings.offset.y;
                    curObjPos.z += settings.offset.z;

                }

                if (decimalPlaces(curObjPos.x) == 0)
                	$('#selectedobj-x').val(curObjPos.x.toFixed(1));
                else
                	$('#selectedobj-x').val(curObjPos.x);

                if (decimalPlaces(curObjPos.y) == 0)
                	$('#selectedobj-y').val(curObjPos.y.toFixed(1));
               	else
               		$('#selectedobj-y').val(curObjPos.y);

                if (decimalPlaces(curObjPos.z) == 0)
                	$('#selectedobj-z').val(curObjPos.z.toFixed(1));
                else
                	$('#selectedobj-z').val(curObjPos.z);
            }

            function updateObjectMoverLines() {
                var curObj = selectedObject();

                if (settings.showobjectlines && curObj !== false) {
                    var moveToObj;

                    if (curObj.userData.rawid.indexOf('armorstand_') > -1) {
                        // Move the entire armorstand together if an armorstand part is selected
                        moveToObj = curObj.parent.parent.parent.parent.parent;
                    } else {
                        // Otherwise, move this object individually
                        moveToObj = curObj.parent.parent.parent.parent;
                    }

                    if (moveToObj !== null) {
                        objectMover.visible = true;
                        objectMover.position.set(moveToObj.position.x, moveToObj.position.y, moveToObj.position.z);
                    }
                    
                } else {
                    objectMover.visible = false;
                    objectMover.position.y = -999;
                }
                window.requestAnimationFrame(render);
            }

            function moveObjectToMoverLines(clickedobjectmover) {

                var needsUpdate = false;
                var curObj = selectedObject();
                var objectToMove;
                var objectsNeedingUpdates = []; // An array of the objects which have moved (only used when multiple objects are selected)

                if (curObj.userData.rawid.indexOf('armorstand_') > -1) {
                    // Move the entire armorstand together if an armorstand part is selected
                    objectToMove = curObj.parent.parent.parent.parent.parent;
                } else {
                    // Otherwise, move this object individually
                    objectToMove = curObj.parent.parent.parent.parent;
                }

                if (settings.showobjectlines) {

                    // If there are objects in the selectedobjects[] array, then calculate the amount that the first selected object (The one with the mover lines)
                    // has moved since the last frame. Move all other objects in the array by that same amount. This allows users to move multiple objects at once

                    if (selectedobjects.length === 0) {

                        // Only selecting a single object
                        if (clickedobjectmover.userData.axis == 'x') {
                            if (objectToMove.position.x !== roundToMultiple(objectMover.position.x, 0.03125)) {
                                needsUpdate = true;
                                objectToMove.position.x = roundToMultiple(objectMover.position.x, 0.03125);
                            }
                        }

                        if (clickedobjectmover.userData.axis == 'y') {
                            if (objectToMove.position.y !== roundToMultiple(objectMover.position.y, 0.03125)) {
                                needsUpdate = true;
                                objectToMove.position.y = roundToMultiple(objectMover.position.y, 0.03125);
                            }
                        }

                        if (clickedobjectmover.userData.axis == 'z') {
                            if (objectToMove.position.z !== roundToMultiple(objectMover.position.z, 0.03125)) {
                                needsUpdate = true;
                                objectToMove.position.z = roundToMultiple(objectMover.position.z, 0.03125);
                            }
                        }

                    } else {

                        // Selecting multiple objects

                        var moveDistance = 0;

                        if (objectToMove.position[clickedobjectmover.userData.axis] !== roundToMultiple(objectMover.position[clickedobjectmover.userData.axis], 0.03125)) {
                            needsUpdate = true;

                            moveDistance = roundToMultiple(objectMover.position[clickedobjectmover.userData.axis], 0.03125) - objectToMove.position[clickedobjectmover.userData.axis];

                            for (var i = 0; i < selectedobjects.length; i++) {

                                if (selectedobjects[i].userData.rawid.indexOf('armorstand_') > -1) {
                                    // Part of an armorstand

                                    selectedobjects[i].parent.parent.parent.parent.parent.position[clickedobjectmover.userData.axis] += moveDistance;

                                } else {
                                    // Regular object

                                    selectedobjects[i].parent.parent.parent.parent.position[clickedobjectmover.userData.axis] += moveDistance;

                                }

                            }
                        }

                    }


                    if (curObj.userData.size === 'solid') {
                        // Round to nearest full block if the object is a solid block

                        curObj.parent.parent.parent.parent.position.set(Math.round(curObj.parent.parent.parent.parent.position.x), Math.round(curObj.parent.parent.parent.parent.position.y) - 0.5, Math.round(curObj.parent.parent.parent.parent.position.z));
                    }

                }

                updatePositionInputs(curObj);

                if (needsUpdate) {
                    updateObjectAt({
                        uuid: curObj.uuid,
                        ontick: animatePlayhead.ontick,
                        objref: curObj
                    }); // Update if the object's position has changed
                }
            }

            function fixFloat(number) {
                return parseFloat((number).toFixed(5));
            }

            function updatePosChanger() {
                $('.selectedobj-pos-changer').attr('step', selectedObject().parent.scale.x);
            }

            function updateRotationInputs() {
                var selectedObj = selectedObject();

                if (selectedObj.userData.rawid.indexOf('armorstand_') > -1) {
                    // The user is selecting part of a blank armorstand

                    $('.selectedobj-rotation-x').val(fixFloat(selectedObj.parent.rotation.x / (pi/180)));
                    $('.selectedobj-rotation-y').val(fixFloat(-(selectedObj.parent.parent.rotation.y / (pi/180))));
                    $('.selectedobj-rotation-z').val(fixFloat(-(selectedObj.parent.parent.parent.rotation.z / (pi/180))));
                } else {
                    // The user is selecting a regular object

                    $('.selectedobj-rotation-x').val(fixFloat(selectedObj.parent.rotation.x / (pi/180)));
                    $('.selectedobj-rotation-y').val(-fixFloat(selectedObj.parent.parent.rotation.y / (pi/180)));
                    $('.selectedobj-rotation-z').val(-fixFloat(selectedObj.parent.parent.parent.rotation.z / (pi/180)));
                }

                // Don't show the rotation inputs if it is a solid block
                if (selectedObj.userData.size == 'solid') {
                    $('.selectedobj-properties-rotation').hide();
                }
            }

            function selectSizeButtonCSS(size) {
                $('.selectedobj-sizechange').css({
                    'border': '',
                    'border-radius': ''
                });

                $('#selectedobj-' + size).css({
                    'border': '1px solid #8A8A8A',
                    'border-radius': '2px'
                });
            }

            function setObjColor(objectID, color, intersects) {
                if (typeof intersects === 'undefined') { intersects = false; }
                if (intersects !== false && intersects[0].object.parent.userData.isDynamic == true) {
                    for (j = 0; j < intersects[0].object.parent.children.length; j++) {
                        if (intersects[0].object.parent.children[j].material.color !== undefined) {
                            if (intersects[0].object.parent.children[0].userData.color !== undefined && intersects[0].object.parent.children[j].userData.rgb !== undefined) {
                                intersects[0].object.parent.children[j].material.color = new THREE.Color("rgb(" + Math.floor(intersects[0].object.parent.children[j].userData.rgb.r / 1.5) + ", " + Math.floor(intersects[0].object.parent.children[j].userData.rgb.g) + ", " + Math.floor(((255-intersects[0].object.parent.children[j].userData.rgb.b)/4)+intersects[0].object.parent.children[j].userData.rgb.b) + ")");
                            } else {
                                intersects[0].object.parent.children[j].material.color.setHex(color);
                            }
                        } else {
                            var materials = intersects[0].object.parent.children[j].material.materials;
                            for (var k=0, l=materials.length; k < l; k++) {
                                materials[k].color.setHex(color);
                            }
                        }
                    }
                } else {
                    for (j = 0; j < objects[objectID].children.length; j++) {
                        if (objects[objectID].children[j].material.color !== undefined) {
                            if (objects[objectID].children[0].userData.color !== undefined && objects[objectID].children[j].userData.rgb !== undefined) {
                                objects[objectID].children[j].material.color = new THREE.Color("rgb(" + Math.floor(objects[objectID].children[j].userData.rgb.r / 3) + ", " + Math.floor(objects[objectID].children[j].userData.rgb.g / 3) + ", " + Math.floor(((255-objects[objectID].children[j].userData.rgb.b)/4)+objects[objectID].children[j].userData.rgb.b) + ")");
                            } else {
                                objects[objectID].children[j].material.color.setHex(color);
                            }
                        } else {
                            var materials = objects[objectID].children[j].material.materials;
                            for (var k=0, l=materials.length; k < l; k++) {
                                materials[k].color.setHex(color);
                            }
                        }
                    }
                }
            }

            var objmoverselection, intersectsobjmovers, moverstartpos, intersectsobj;

            var selectedobjects = [];

            var pressingCtrl = false;

            $(document).bind('keydown', 'ctrl', function(e) {
                pressingCtrl = true;
            });
            $(document).bind('keyup', 'ctrl', function(e) {
                pressingCtrl = false;
            });

            function onDocumentMouseDown(event) {
                // Object position movers
                var vector = new THREE.Vector3(mouse.x, mouse.y, 1);
                vector.unproject(camera);

                raycaster.setFromCamera( mouse, camera );
                intersectsobj = raycaster.intersectObjects( objects.concat(objectMoverLines), true );

                // if (pressingCtrl) {
                //     // Add to array of selected objects and then end this function

                //     selectedobject = null;

                //     $('.selectedobj-properties').hide();
                //     $('#project').show();
                //     $('#project-list').show();

                //     if (intersectsobj.length === 0) {
                //         // Reset selected objects and the regular single selected object

                //         for (var i = 0; i < selectedobjects.length; i++) {

                //             selectedobjects[i].userData.selected = false;

                //         }

                //         selectedobjects = [];

                //     } else {
                //         // Otherwise, add to the array if clicking one

                //         selectedobjects[selectedobjects.length] = intersectsobj[0].object.parent;

                //         intersectsobj[0].object.parent.userData.selected = true;

                //     }

                //     return;
                // }

                raycaster.set( camera.position, vector.sub( camera.position ).normalize() );
                if (intersectsobj.length > 0 && intersectsobj[0].object.userData.isMoverLine == true) {
                    // console.log('clicking an object mover');

                    moverstartpos = {
                        x: intersectsobj[0].object.parent.position.x,
                        y: intersectsobj[0].object.parent.position.y,
                        z: intersectsobj[0].object.parent.position.z
                    }
                    // console.log(moverstartpos.x + ' ' + moverstartpos.y + '' + moverstartpos.z)

                    // Disable the controls
                    controls.enabled = false;
                    // Set the selection - first intersected object
                    objmoverselection = intersectsobj[0].object;
                    // Calculate the offset
                    var intersectsobj = raycaster.intersectObject(plane);
                    offset.copy(intersectsobj[0].point).sub(plane.position);
                } else {
                    // Unselect the previously selected object
                    // console.log('unselected');
                    for (i = 0; i < objects.length; i++) {
                        objects[i].userData.selected = false;
                    }
                    selectedobject = null;
                    selectedobjects = [];
                    $('.selectedobj-properties').hide();
                    $('#manipulate').hide();
                    $('#project').show();
                    $('#project-list').show();

                    controls.enabled = true;
                }

                updateObjectMoverLines();

                clickobjstore = intersectsobj;
                clickobj = true;
                if (intersectsobj.length > 0 && intersectsobj[0].object.parent.userData.isDynamic == true) {
                    // Delay so that all things are set by the time it is edited
                    render();
                    editObject(intersectsobj[0].object.parent);
                }
                requestAnimationFrame( render );
            }

            function onDocumentMouseUp(event) {
                clickobj = false;

                // Enable the controls
                controls.enabled = true;
                if (settings.showobjectlines) {
                    // if (objmoverselection) {
                    //     console.log('let go of an object mover');
                    // }
                    objmoverselection = null;
                }
                updateObjectMoverLines();

                intersectsobj = null;

                window.setTimeout(function() {
                    for (var i = 0; i < objects.length; i++) {
                        if (objects[i].userData.selected) {
                            selectedobject = objects[i];
                        }
                    }
                }, 2);

                // Blank armorstand item slot preview selections
                if (selectedobject !== null && selectedobject.parent !== null && selectedobject.parent.parent.parent.parent.userData.blankArmorstandPreviewSlot === true) {
                    selectedobject = selectedobject.parent.parent.parent.parent.parent.parent.children[0].children[0];

                    // Unselect all objects
                    for (var i = 0; i < objects.length; i++) {
                        objects[i].userData.selected = false;
                    }
                    // Select the blank armorstand part connected to the slot preview object
                    selectedobject.userData.selected = true;

                    editObject(selectedobject);
                }

                if (selectedobject === null) {
                    $('#armorstand-options').hide();
                }

                requestAnimationFrame(render);
            }

            var mouseAbsolute = {};

            function fullDocumentMouseMove(event) {
                mouseAbsolute.x = event.clientX;
                mouseAbsolute.y = event.clientY;
            }

            function onDocumentMouseMove(event) {
                event.preventDefault();

                mouse.x = ( event.clientX / renderer.domElement.clientWidth ) * 2 - 1;
                mouse.y = - ( event.clientY / renderer.domElement.clientHeight ) * 2 + 1;

                // Get 3D vector from 3D mouse position using 'unproject' function
                var vector = new THREE.Vector3(mouse.x, mouse.y, 1);
                vector.unproject(camera);

                // Set the raycaster position
                raycaster.set( camera.position, vector.sub( camera.position ).normalize() );

                if (objmoverselection) {
                    // Check the position where the plane is intersected
                    var intersectsobjmovers = raycaster.intersectObject(plane);
                    // Reposition the object based on the intersection point with the plane
                    switch (objmoverselection.userData.axis) {
                        case 'x':
                            objectMover.position.x = roundToMultiple(intersectsobjmovers[0].point.sub(offset).x + moverstartpos.x - (objectMoverLength / 2), 0.03125);
                            break;
                        case 'y':
                            objectMover.position.y = roundToMultiple(intersectsobjmovers[0].point.sub(offset).y + moverstartpos.y - (objectMoverLength / 2), 0.03125);
                            break;
                        case 'z':
                            objectMover.position.z = roundToMultiple(intersectsobjmovers[0].point.sub(offset).z + moverstartpos.z - (objectMoverLength / 2), 0.03125);
                            break;
                    }

                    if (selectedobject.userData.size === 'solid') {
                        objectMover.position.set(Math.round(objectMover.position.x), Math.round(objectMover.position.y), Math.round(objectMover.position.z));
                    }

                    //objmoverselection.position.copy(intersectsobjmovers[0].point.sub(offset));
                    // Update the position of the selected object and the rest of the object movers
                    moveObjectToMoverLines(objmoverselection);
                } else {
                    // Update position of the plane if need
                    var intersectsobjmovers = raycaster.intersectObjects(objectMoverLines);
                    if (intersectsobjmovers.length > 0) {
                        // var lookAtVector = new THREE.Vector3(0,0, -1);
                        // lookAtVector.applyQuaternion(camera.quaternion);
                        plane.position.copy(intersectsobjmovers[0].object.position);
                        plane.lookAt(camera.position);
                    }
                }

                requestAnimationFrame( render );
            }
        </script>

        <script src='animate.js'></script>
    </body>
</html>